<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="LegalMech Fit">
    <meta name="theme-color" content="#000000">

    <title>LegalMech Fit</title>

    <style>
        /* --- MODERN iOS DEƒûƒ∞≈ûKENLERƒ∞ --- */
        :root {
            --bg: #000000;
            --card-bg: #1c1c1e;
            --text-main: #ffffff;
            --text-muted: #8e8e93;
            --accent: #0a84ff; /* iOS Blue */
            --accent-glow: rgba(10, 132, 255, 0.3);
            --danger: #ff453a;
            --success: #30d158;
            --border: #38383a;
            --glass: rgba(28, 28, 30, 0.85);
            --radius: 16px;
        }

        /* --- TEMEL YAPILANDIRMA --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        
        body {
            margin: 0; padding: 0;
            background-color: var(--bg); color: var(--text-main);
            /* iPhone √áentik ve Alt √áubuk Ayarlarƒ± */
            padding-top: env(safe-area-inset-top);
            padding-bottom: calc(100px + env(safe-area-inset-bottom));
            min-height: 100vh;
            -webkit-user-select: none; user-select: none; /* Uygulama hissi i√ßin se√ßimi kapat */
        }

        /* --- HEADER (Glassmorphism) --- */
        header {
            position: sticky; top: 0; z-index: 100;
            background: var(--glass); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-bottom: 0.5px solid var(--border);
            padding: 10px 20px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .app-title { font-size: 1.2rem; font-weight: 700; letter-spacing: -0.5px; }
        .app-title span { color: var(--accent); }
        .streak-pill { 
            background: rgba(255, 159, 10, 0.15); color: #ff9f0a; 
            padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; 
            display: flex; align-items: center; gap: 4px;
        }

        /* --- IKONLAR (SVG) --- */
        .icon-btn { background: none; border: none; cursor: pointer; padding: 8px; border-radius: 50%; transition: background 0.2s; }
        .icon-btn:active { background: rgba(255,255,255,0.1); }
        svg { width: 24px; height: 24px; fill: var(--text-main); }
        .icon-danger svg { fill: var(--danger); }
        .icon-accent svg { fill: var(--accent); }

        /* --- DATE NAV --- */
        .date-strip {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 20px; background: var(--bg);
        }
        .date-main { font-size: 1.1rem; font-weight: 600; text-align: center; }
        .nav-arrow { font-size: 1.5rem; color: var(--accent); padding: 0 15px; cursor: pointer; }

        /* --- CARDS & LIST --- */
        .container { padding: 0 16px; max-width: 600px; margin: 0 auto; }
        .card {
            background: var(--card-bg); border-radius: var(--radius);
            padding: 20px; margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
            position: relative; overflow: hidden;
        }

        /* Progress Ring (CSS Draw) */
        .header-row { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; }
        .prog-ring {
            width: 40px; height: 40px; border-radius: 50%;
            background: conic-gradient(var(--accent) var(--deg, 0deg), #333 0deg);
            display: flex; align-items: center; justify-content: center;
            position: relative;
        }
        .prog-ring::after {
            content: ''; position: absolute; width: 34px; height: 34px;
            background: var(--card-bg); border-radius: 50%;
        }
        .prog-text { position: absolute; z-index: 2; font-size: 0.65rem; font-weight: bold; color: var(--text-muted); }

        /* List Items */
        .task-item {
            display: flex; flex-direction: column; gap: 8px;
            padding: 16px 0; border-bottom: 0.5px solid var(--border);
        }
        .task-top { display: flex; align-items: center; justify-content: space-between; }
        
        /* Modern Checkbox */
        .check-group { display: flex; align-items: center; gap: 12px; flex: 1; cursor: pointer; }
        .circle-check {
            width: 24px; height: 24px; border: 2px solid var(--border); border-radius: 50%;
            display: flex; align-items: center; justify-content: center; transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .checked .circle-check { border-color: var(--success); background: var(--success); }
        .circle-check svg { width: 14px; height: 14px; fill: #000; opacity: 0; transform: scale(0.5); transition: 0.2s; }
        .checked .circle-check svg { opacity: 1; transform: scale(1); }
        
        .task-name { font-size: 1rem; font-weight: 500; transition: 0.3s; }
        .checked .task-name { color: var(--text-muted); text-decoration: line-through; }

        /* YouTube Button */
        .yt-btn {
            background: rgba(255, 59, 48, 0.15); border-radius: 8px;
            padding: 6px 10px; display: flex; align-items: center; justify-content: center;
            text-decoration: none; transition: 0.2s;
        }
        .yt-btn svg { width: 18px; height: 18px; fill: var(--danger); }
        .yt-btn:active { background: rgba(255, 59, 48, 0.3); transform: scale(0.95); }

        /* Inputs */
        .task-inputs { display: flex; gap: 10px; padding-left: 36px; margin-top: 4px; }
        .data-pill {
            background: #000; border: 1px solid var(--border); border-radius: 8px;
            display: flex; flex-direction: column; padding: 4px 8px; min-width: 60px;
        }
        .data-label { font-size: 0.6rem; color: var(--text-muted); text-transform: uppercase; }
        .data-input {
            background: none; border: none; color: #fff; font-size: 1rem; width: 100%;
            outline: none; padding: 2px 0; font-weight: 600;
        }
        .prev-data { font-size: 0.75rem; color: var(--accent); margin-top: 8px; padding-left: 36px; opacity: 0.8; }

        /* --- BOTTOM BAR --- */
        .bottom-bar {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: var(--glass); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-top: 0.5px solid var(--border);
            padding: 10px 30px; padding-bottom: calc(10px + env(safe-area-inset-bottom));
            display: flex; justify-content: space-between; align-items: center; z-index: 200;
        }
        .tab-item { display: flex; flex-direction: column; align-items: center; gap: 4px; opacity: 0.6; font-size: 0.7rem; cursor: pointer; }
        .tab-item.active { opacity: 1; color: var(--accent); }
        .tab-item.active svg { fill: var(--accent); }
        .tab-center {
            background: var(--accent); width: 50px; height: 50px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            margin-top: -30px; box-shadow: 0 4px 15px var(--accent-glow);
        }
        .tab-center svg { fill: #fff; width: 28px; height: 28px; }

        /* --- TIMER OVERLAY --- */
        .timer-overlay {
            position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%);
            background: #2c2c2e; padding: 10px 20px; border-radius: 30px;
            border: 1px solid var(--border); box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            display: none; align-items: center; gap: 15px; z-index: 150;
        }
        .timer-overlay.active { display: flex; animation: slideUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes slideUp { from { transform: translate(-50%, 20px); opacity: 0; } to { transform: translate(-50%, 0); opacity: 1; } }

        /* --- MODALS --- */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); z-index: 300;
            align-items: flex-end; /* Sheet style */
        }
        .modal.active { display: flex; }
        .modal-sheet {
            background: var(--card-bg); width: 100%; border-radius: 20px 20px 0 0;
            padding: 25px; max-height: 85vh; overflow-y: auto;
            animation: slideUpSheet 0.3s ease-out;
        }
        @keyframes slideUpSheet { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        .btn-block { width: 100%; padding: 15px; background: #333; color: #fff; border: none; border-radius: 12px; font-size: 1rem; margin-top: 10px; font-weight: 600; }
        .btn-primary { background: var(--accent); color: #fff; }
        .btn-danger { background: rgba(255, 69, 58, 0.15); color: var(--danger); }

        /* Canvas Chart */
        #weightCanvas { width: 100%; height: 200px; margin-top: 20px; }
        #confetti { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 999; }
    </style>
</head>
<body>

    <canvas id="confetti"></canvas>

    <header>
        <div class="app-title">LegalMech<span>Fit</span></div>
        <div class="streak-pill" id="streakBadge">
            <svg style="width:14px; height:14px; fill:#ff9f0a" viewBox="0 0 24 24"><path d="M17.66 11.2C17.43 10.9 17.15 10.64 16.89 10.38C16.22 9.78 15.46 9.35 14.82 8.72C13.33 7.26 13 4.85 13.95 3C13.08 3.23 12.17 3.75 11.46 4.32C8.96 6.35 7.97 9.8 9.18 12.87C9.33 13.24 9.55 13.63 9.79 13.97C10 14.33 10.28 14.7 10.45 15C10.63 15.35 10.74 15.82 10.65 16.23C10.56 16.63 10.3 16.97 10 17.22C9.28 17.81 8.27 17.83 7.42 17.44C7.03 17.25 6.67 16.92 6.4 16.5C6.11 16.03 5.92 15.5 5.86 14.95C5.84 14.75 5.56 14.72 5.5 14.91C4.46 18.23 5.83 21.84 8.79 23.36C10.45 24.21 12.42 24.21 14.08 23.36C18.67 21.03 19.9 15.19 17.66 11.2Z"/></svg>
            <span id="streakCount">0</span>
        </div>
    </header>

    <div class="date-strip">
        <div class="nav-arrow" onclick="changeDate(-1)">‚ùÆ</div>
        <div class="date-main" id="dateDisplay">Bug√ºn</div>
        <div class="nav-arrow" onclick="changeDate(1)">‚ùØ</div>
    </div>

    <div class="container">
        
        <div id="warningArea"></div>

        <div class="card">
            <div class="header-row">
                <div>
                    <h2 style="margin:0; font-size:1.3rem;" id="programName">Program</h2>
                    <p style="margin:5px 0 0 0; color:var(--text-muted); font-size:0.85rem;" id="programSub">...</p>
                </div>
                <div class="prog-ring" id="progressRing">
                    <span class="prog-text" id="progressText">0%</span>
                </div>
            </div>

            <div id="workoutList">
                </div>
        </div>

        <div class="card">
            <h3 style="margin:0 0 15px 0;">G√ºnl√ºk</h3>
            <div style="display:flex; gap:10px; margin-bottom:10px;">
                 <div class="data-pill" style="width:100px;">
                    <span class="data-label">Kilo (Kg)</span>
                    <input type="number" id="weightInput" class="data-input" onchange="saveWeight()">
                 </div>
            </div>
            <textarea id="journalInput" style="width:100%; background:#111; color:#fff; border:1px solid var(--border); border-radius:12px; padding:12px; min-height:80px; resize:none;" placeholder="Antrenman notlarƒ±..." oninput="saveJournal()"></textarea>
        </div>
        
        <div style="height:20px;"></div>
    </div>

    <div class="timer-overlay" id="timerOverlay">
        <svg viewBox="0 0 24 24"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm0 18c-4.4 0-8-3.6-8-8s3.6-8 8-8 8 3.6 8 8-3.6 8-8 8zm.5-13H11v6l5.2 3.2.8-1.3-4.5-2.7V7z" fill="var(--accent)"/></svg>
        <span style="font-family:monospace; font-size:1.4rem; font-weight:bold; width:60px;" id="timerDisplay">00:00</span>
        <div style="display:flex; gap:10px;">
            <button class="icon-btn" onclick="addTime(10)">+10</button>
            <button class="icon-btn icon-danger" onclick="stopTimer()">
                <svg viewBox="0 0 24 24"><path d="M6 6h12v12H6z"/></svg>
            </button>
        </div>
    </div>

    <div class="bottom-bar">
        <div class="tab-item" onclick="togglePanic()">
            <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
            <span>Ev Modu</span>
        </div>
        <div class="tab-center" onclick="startTimer()">
            <svg viewBox="0 0 24 24"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/></svg>
        </div>
        <div class="tab-item" onclick="openModal('statsModal')">
            <svg viewBox="0 0 24 24"><path d="M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z"/></svg>
            <span>Veriler</span>
        </div>
    </div>

    <div class="modal" id="statsModal">
        <div class="modal-sheet">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h2>ƒ∞statistikler</h2>
                <button class="icon-btn" onclick="closeModal('statsModal')">‚úï</button>
            </div>
            <p style="font-size:0.9rem; color:var(--text-muted)">Son 14 g√ºn Kilo Takibi</p>
            <canvas id="weightCanvas"></canvas>
            
            <h3 style="margin-top:20px;">Ara√ßlar</h3>
            <button class="btn-block" onclick="exportData()">üì§ Verileri Yedekle</button>
            <button class="btn-block btn-danger" onclick="resetApp()">üóë Verileri Sƒ±fƒ±rla</button>
            <input type="file" id="importFile" style="display:none" onchange="importData(this)">
            <button class="btn-block" onclick="document.getElementById('importFile').click()">üì• Yedek Y√ºkle</button>
        </div>
    </div>

    <script>
        /* --- JS LOGIC --- */
        const templates = {
            0: { title: "Dinlenme", sub: "Pazar: Aktif Toparlanma", items: ["45 Dk Y√ºr√ºy√º≈ü", "Foam Rolling", "Meal Prep"] },
            1: { title: "Chest & Back", sub: "Pazartesi: Hipertrofi", items: ["Bench Press (4x8)", "Bent Over Row (4x10)", "Incline DB Press (3x10)", "Lat Pulldown (3x12)", "Face Pull (3x15)"] },
            2: { title: "Legs & Core", sub: "Salƒ±: Kuvvet", items: ["Squat (4x6)", "RDL (3x10)", "Leg Extension (3x15)", "Calf Raise (4x20)", "Plank (3x1 dk)"] },
            3: { title: "Ma√ß G√ºn√º", sub: "√áar≈üamba: Basketbol", items: ["Ma√ß (21:45)", "Karbonhidrat Y√ºklemesi", "Magnezyum"], warning: "Ma√ß i√ßin enerjini koru." },
            4: { title: "Shoulders & Arms", sub: "Per≈üembe: Pump", items: ["Overhead Press (4x8)", "Lateral Raise (4x15)", "Barbell Curl (3x10)", "Tricep Pushdown (3x12)"] },
            5: { title: "Mobility", sub: "Cuma: Pilates", items: ["Pilates (19:00)", "Kal√ßa Mobilite", "Omurga Esnetme"] },
            6: { title: "Upper Body", sub: "Cumartesi: Hacim", items: ["Pull Up (3xMax)", "Dips (3x10)", "DB Shoulder Press (3x12)", "Cable Fly (3x15)"] },
            panic: { title: "Ev Modu", sub: "Ekipmansƒ±z Antrenman", items: ["50x ≈ûƒ±nav", "50x Squat", "50x Mekik", "Burpees (3x10)", "Esneme"], warning: "Bahane yok!" }
        };

        let currentDate = new Date();
        let appData = JSON.parse(localStorage.getItem('legalMechApp')) || {};
        let timerInt = null;
        let timerSec = 0;

        const formatDate = d => d.toISOString().split('T')[0];
        
        function init() {
            // Touch delay fix for iOS
            document.addEventListener('touchstart', function() {}, false);
            render();
            drawChart();
            calcStreak();
        }

        function render() {
            // Date UI
            const dStr = currentDate.toLocaleDateString('tr-TR', { weekday: 'long', day: 'numeric', month: 'short' });
            document.getElementById('dateDisplay').innerText = dStr;

            const key = formatDate(currentDate);
            const dayIdx = currentDate.getDay();
            
            if (!appData[key]) appData[key] = { checked: [], sets: {}, weights: {}, notes: "", weight: "", isPanic: false };
            const data = appData[key];
            const tpl = data.isPanic ? templates['panic'] : templates[dayIdx];

            document.getElementById('programName').innerText = tpl.title;
            document.getElementById('programSub').innerText = tpl.sub;
            document.getElementById('warningArea').innerHTML = tpl.warning ? `<div style="background:rgba(255,165,0,0.15); color:#ffa500; padding:10px; border-radius:8px; margin-bottom:15px; font-size:0.9rem;">‚ö†Ô∏è ${tpl.warning}</div>` : '';
            document.getElementById('journalInput').value = data.notes || "";
            document.getElementById('weightInput').value = data.weight || "";

            const list = document.getElementById('workoutList');
            list.innerHTML = '';
            
            tpl.items.forEach((item, idx) => {
                const isChecked = data.checked.includes(idx);
                const prev = getPrev(dayIdx, idx, data.isPanic);
                
                const div = document.createElement('div');
                div.className = `task-item ${isChecked ? 'checked' : ''}`;
                
                // YouTube link logic
                const ytUrl = `https://www.youtube.com/results?search_query=${encodeURIComponent(item + " exercise form")}`;
                
                div.innerHTML = `
                    <div class="task-top">
                        <div class="check-group" onclick="toggle(${idx})">
                            <div class="circle-check">
                                <svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
                            </div>
                            <span class="task-name">${item}</span>
                        </div>
                        <a href="${ytUrl}" target="_blank" class="yt-btn">
                            <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                        </a>
                    </div>
                    <div class="task-inputs">
                        <div class="data-pill">
                            <span class="data-label">Set</span>
                            <input type="text" class="data-input" value="${data.sets[idx]||''}" onchange="saveSub('sets', ${idx}, this.value)">
                        </div>
                        <div class="data-pill">
                            <span class="data-label">Kg</span>
                            <input type="number" class="data-input" value="${data.weights[idx]||''}" onchange="saveSub('weights', ${idx}, this.value)">
                        </div>
                    </div>
                    ${prev ? `<div class="prev-data">√ñnceki: ${prev}kg</div>` : ''}
                `;
                list.appendChild(div);
            });

            // Progress Ring Logic
            const total = tpl.items.length;
            const done = data.checked.length;
            const pct = total ? Math.round((done/total)*100) : 0;
            document.getElementById('progressText').innerText = `${pct}%`;
            document.getElementById('progressRing').style.setProperty('--deg', `${pct * 3.6}deg`);
        }

        function toggle(idx) {
            const key = formatDate(currentDate);
            const arr = appData[key].checked;
            const pos = arr.indexOf(idx);
            if(pos > -1) arr.splice(pos, 1); else arr.push(idx);
            
            // Konfeti (Sadece %100 olduƒüunda)
            const dayIdx = currentDate.getDay();
            const tpl = appData[key].isPanic ? templates['panic'] : templates[dayIdx];
            if(arr.length === tpl.items.length) doConfetti();

            save(); render(); calcStreak();
        }

        function saveSub(type, idx, val) {
            appData[formatDate(currentDate)][type][idx] = val; save();
        }
        function saveWeight() {
            appData[formatDate(currentDate)].weight = document.getElementById('weightInput').value; save(); drawChart();
        }
        function saveJournal() {
            appData[formatDate(currentDate)].notes = document.getElementById('journalInput').value; save();
        }
        function changeDate(d) { currentDate.setDate(currentDate.getDate()+d); render(); }
        
        function getPrev(dIdx, iIdx, panic) {
            let d = new Date(currentDate);
            for(let i=1;i<45;i++){
                d.setDate(d.getDate()-1);
                const k = formatDate(d);
                if(appData[k] && d.getDay()===dIdx && appData[k].isPanic===panic && appData[k].weights[iIdx]) return appData[k].weights[iIdx];
            }
            return null;
        }

        function togglePanic() {
            const k = formatDate(currentDate);
            appData[k].isPanic = !appData[k].isPanic;
            appData[k].checked = [];
            save(); render();
        }

        function calcStreak() {
            let s=0, d=new Date();
            for(let i=0;i<365;i++){
                const k=formatDate(d);
                if(appData[k] && (appData[k].checked.length>0 || appData[k].notes)) s++;
                else if(k !== formatDate(new Date())) break;
                d.setDate(d.getDate()-1);
            }
            document.getElementById('streakCount').innerText = s;
        }

        /* --- TIMER --- */
        function startTimer() {
            document.getElementById('timerOverlay').classList.add('active');
            if(timerInt) clearInterval(timerInt);
            timerSec = 90; updateTimer();
            timerInt = setInterval(()=>{
                timerSec--; updateTimer();
                if(timerSec<=0) { stopTimer(); alert("S√ºre bitti!"); }
            },1000);
        }
        function addTime(s) { timerSec+=s; updateTimer(); }
        function stopTimer() { clearInterval(timerInt); document.getElementById('timerOverlay').classList.remove('active'); }
        function updateTimer() {
            const m=Math.floor(timerSec/60), s=timerSec%60;
            document.getElementById('timerDisplay').innerText = `${m}:${s<10?'0'+s:s}`;
        }

        /* --- CHART (Canvas) --- */
        function drawChart() {
            const ctx = document.getElementById('weightCanvas').getContext('2d');
            const w=ctx.canvas.width=ctx.canvas.clientWidth, h=ctx.canvas.height=ctx.canvas.clientHeight;
            
            let pts=[]; let d=new Date();
            for(let i=13;i>=0;i--){
                let temp=new Date(); temp.setDate(d.getDate()-i);
                let val = appData[formatDate(temp)]?.weight;
                if(val) pts.push({x:i, y:parseFloat(val)});
            }

            ctx.clearRect(0,0,w,h);
            if(pts.length<2) { ctx.fillStyle="#555"; ctx.fillText("Veri girildik√ße grafik olu≈üur.", 20, h/2); return; }

            const min = Math.min(...pts.map(p=>p.y))-1, max = Math.max(...pts.map(p=>p.y))+1;
            
            // Draw Gradient Line
            const grad = ctx.createLinearGradient(0,0,0,h);
            grad.addColorStop(0, "rgba(10,132,255,0.5)"); grad.addColorStop(1, "transparent");

            ctx.beginPath();
            pts.forEach((p,i)=>{
                const x=(i/(pts.length-1))*(w-20)+10;
                const y=h - ((p.y-min)/(max-min))*(h-40)-20;
                if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
            });
            ctx.strokeStyle="#0a84ff"; ctx.lineWidth=3; ctx.stroke();
            
            // Fill
            ctx.lineTo(w-10, h); ctx.lineTo(10,h); ctx.fill();
        }

        /* --- UTILS --- */
        function save(){ localStorage.setItem('legalMechApp', JSON.stringify(appData)); }
        function openModal(id){ document.getElementById(id).classList.add('active'); if(id==='statsModal') drawChart(); }
        function closeModal(id){ document.getElementById(id).classList.remove('active'); }
        function resetApp(){ if(confirm('Silinsin mi?')) { localStorage.clear(); location.reload(); } }
        function exportData(){
            const a=document.createElement('a');
            a.href="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(appData));
            a.download="backup.json"; a.click();
        }
        function importData(inp){
            const r=new FileReader(); r.onload=e=>{ appData=JSON.parse(e.target.result); save(); location.reload(); };
            if(inp.files[0]) r.readAsText(inp.files[0]);
        }
        function doConfetti() {
            const c=document.getElementById('confetti'); const x=c.getContext('2d');
            c.width=window.innerWidth; c.height=window.innerHeight;
            let p=[]; for(let i=0;i<60;i++)p.push({x:Math.random()*c.width,y:-10,v:Math.random()*5+2,c:`hsl(${Math.random()*360},100%,50%)`});
            function anim(){ x.clearRect(0,0,c.width,c.height); let act=false;
            p.forEach(o=>{o.y+=o.v; if(o.y<c.height){act=true;x.fillStyle=o.c;x.fillRect(o.x,o.y,6,6)}});
            if(act)requestAnimationFrame(anim); else x.clearRect(0,0,c.width,c.height); }
            anim();
        }

        init();
    </script>
</body>
</html>

