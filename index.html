<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <title>PRIME v23.0 Coach Pack</title>

    <style>
        :root {
            --bg: #000000;
            --card: #161618;
            --text: #ffffff;
            --muted: #8e8e93;
            --accent: #32d74b;
            --blue: #0a84ff;
            --danger: #ff453a;
            --warn: #ff9f0a;
            --purple: #bf5af2;
            --gold: #ffd60a;
            --glass: rgba(22, 22, 24, 0.95);
            --radius: 18px;
        }
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
        }
        body {
            margin: 0;
            background: var(--bg);
            color: var(--text);
            padding-top: env(safe-area-inset-top);
            padding-bottom: 120px;
            user-select: none;
        }

        #confetti {
            position: fixed;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 0;
        }
        header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: var(--glass);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid #333;
            padding: 10px 20px;
        }
        .container {
            position: relative;
            z-index: 10;
            padding: 0 16px;
            max-width: 600px;
            margin: 0 auto;
        }
        .bottom-bar {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: var(--glass);
            backdrop-filter: blur(20px);
            border-top: 0.5px solid #333;
            display: flex;
            justify-content: space-around;
            padding: 12px;
            padding-bottom: calc(15px + env(safe-area-inset-bottom));
            z-index: 200;
        }

        .header-top { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
        .app-title { font-size:1.4rem; font-weight:900; font-style:italic; letter-spacing:-1px; }
        .xp-container { width:100%; height:6px; background:#333; border-radius:3px; overflow:hidden; }
        .xp-fill { height:100%; background:linear-gradient(90deg,var(--accent),var(--blue)); width:0%; transition:width .5s ease; }
        .level-badge { font-size:.7rem; color:var(--blue); font-weight:bold; display:flex; justify-content:space-between; margin-top:4px; }
        .icon-btn { background:none; border:none; color:var(--text); font-size:1.2rem; cursor:pointer; opacity:.8; position:relative; z-index:101; }
        .challenge-badge { background:linear-gradient(90deg,#ff9f0a,#ff3b30); color:#fff; padding:4px 10px; border-radius:12px; font-size:.7rem; font-weight:bold; display:flex; align-items:center; gap:5px; box-shadow:0 0 10px rgba(255,159,10,.3); cursor:pointer; }

        .alert-box { padding:15px; border-radius:12px; margin:15px 16px; font-size:.9rem; display:flex; align-items:center; gap:15px; animation:fadeIn .5s; border:1px solid transparent; position:relative; z-index:15; }
        .alert-low { background:rgba(10,132,255,.15); border-color:var(--blue); color:var(--blue); }
        .alert-high { background:rgba(255,214,10,.15); border-color:var(--gold); color:var(--gold); }
        .alert-deload { background:rgba(255,69,58,.15); border-color:var(--danger); color:var(--danger); }
        .alert-imbalance { background:rgba(255,159,10,.15); border-color:var(--warn); color:var(--warn); display:none; }

        .card { background:var(--card); border-radius:var(--radius); padding:20px; margin-bottom:20px; position:relative; border:1px solid #2c2c2e; box-shadow:0 10px 30px rgba(0,0,0,.3); }
        .box-header { font-weight:bold; font-size:.85rem; text-transform:uppercase; margin-bottom:8px; display:flex; align-items:center; gap:8px; }
        .prehab-box { background:rgba(10,132,255,.1); border:1px solid rgba(10,132,255,.3); padding:15px; margin-bottom:15px; border-radius:12px; }
        .prehab-item { display:flex; justify-content:space-between; align-items:center; padding:8px 0; border-bottom:1px solid rgba(10,132,255,.2); font-size:.9rem; }
        .prehab-item:last-child { border-bottom:none; }
        .prehab-desc { font-size:.75rem; color:#aaa; display:block; margin-top:2px; }

        .task-item { padding:16px 0; border-bottom:1px solid #2a2a2a; position:relative; }
        .task-top { display:flex; align-items:center; gap:12px; }
        .task-visual { width:50px; height:50px; background:#252527; border-radius:10px; display:flex; align-items:center; justify-content:center; flex-shrink:0; border:1px solid #333; cursor:pointer; }
        .task-visual svg { width:30px; height:30px; fill:#fff; }
        .checked .task-visual svg { fill:var(--accent); }
        .check-group { display:flex; align-items:center; gap:12px; flex:1; cursor:pointer; }
        .circle-check { width:24px; height:24px; border:2px solid #444; border-radius:50%; display:flex; align-items:center; justify-content:center; flex-shrink:0; transition:.2s; }
        .checked .circle-check { background:var(--accent); border-color:var(--accent); }
        .task-name { font-size:1rem; font-weight:600; transition:.2s; line-height:1.3; }
        .checked .task-name { color:var(--muted); text-decoration:line-through; }
        .guide-text { font-size:.8rem; color:var(--blue); margin-top:5px; display:none; background:rgba(10,132,255,.1); padding:8px; border-radius:6px; }
        .task-item.show-guide .guide-text { display:block; animation:fadeIn .3s; }
        .yt-btn { background:#222; color:var(--text); padding:8px 12px; border-radius:6px; text-decoration:none; font-size:.7rem; font-weight:bold; border:1px solid #333; display:flex; align-items:center; gap:5px; flex-shrink:0; cursor:pointer; position:relative; z-index:20; }

        .input-row { display:flex; gap:8px; margin-top:12px; padding-left:66px; align-items:center; flex-wrap:wrap; position:relative; z-index:20; }
        .mini-input { background:#000; border:1px solid #333; color:#fff; width:65px; padding:10px; border-radius:8px; text-align:center; font-size:.9rem; font-weight:600; -webkit-appearance:none; }
        .tool-btn { background:#222; border:1px solid #333; color:var(--muted); width:34px; height:34px; border-radius:8px; display:flex; align-items:center; justify-content:center; cursor:pointer; }
        .pr-active { border-color:var(--gold) !important; color:var(--gold) !important; box-shadow:0 0 10px rgba(255,214,10,.3); }

        .rpe-container { width:100%; display:flex; align-items:center; gap:10px; margin-top:8px; padding-left:66px; opacity:.6; transition:.3s; position:relative; z-index:20; }
        .rpe-container:hover,.rpe-container.active { opacity:1; }
        .rpe-slider { -webkit-appearance:none; width:100%; height:4px; border-radius:5px; background:#333; outline:none; }
        .rpe-slider::-webkit-slider-thumb { -webkit-appearance:none; appearance:none; width:15px; height:15px; border-radius:50%; background:var(--blue); cursor:pointer; }

        .toggle-row { display:flex; justify-content:space-between; align-items:center; background:#000; padding:15px; border-radius:12px; border:1px solid #333; margin-bottom:15px; }
        .switch { position:relative; display:inline-block; width:50px; height:28px; }
        .switch input { opacity:0; width:0; height:0; }
        .slider { position:absolute; cursor:pointer; top:0; left:0; right:0; bottom:0; background-color:#333; transition:.4s; border-radius:34px; }
        .slider:before { position:absolute; content:""; height:20px; width:20px; left:4px; bottom:4px; background-color:white; transition:.4s; border-radius:50%; }
        input:checked + .slider { background-color:var(--blue); }
        input:checked + .slider:before { transform:translateX(22px); }

        .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,.85); z-index:300; align-items:flex-end; backdrop-filter:blur(5px); }
        .modal.open { display:flex; }
        .sheet { background:#1c1c1e; width:100%; border-radius:24px 24px 0 0; padding:30px 25px; max-height:90vh; overflow-y:auto; animation:slideUp .3s; border-top:1px solid #333; position:relative; z-index:301; }
        .full-modal { align-items:center; justify-content:center; }
        .full-modal .sheet { border-radius:0; width:100%; height:100%; max-height:100%; max-width:100%; padding-top:env(safe-area-inset-top); }
        .close-sticky { position:fixed; top:20px; right:20px; z-index:999; background:rgba(0,0,0,.5); width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:1.5rem; color:#fff; backdrop-filter:blur(10px); border:1px solid #444; cursor:pointer; }

        .tab-btn { font-size:1.7rem; opacity:.5; transition:.2s; cursor:pointer; }
        .tab-btn.active { opacity:1; transform:scale(1.1); color:var(--accent); }

        .timer-float { position:fixed; bottom:90px; left:50%; transform:translateX(-50%) translateY(150px); background:#1c1c1e; border:1px solid var(--accent); padding:12px 24px; border-radius:40px; display:flex; align-items:center; gap:15px; z-index:250; box-shadow:0 10px 40px rgba(0,0,0,.8); transition:.4s; }
        .timer-float.active { transform:translateX(-50%) translateY(0); }

        .grid-3 { display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px; margin-bottom:15px; }
        .track-box { background:#111; padding:15px; border-radius:14px; text-align:center; cursor:pointer; border:1px solid #333; }
        .track-val { font-size:1.2rem; font-weight:800; color:#fff; }

        .nutri-container { padding-top:20px; padding-bottom:80px; }
        .nutri-tabs { display:flex; background:#111; padding:4px; border-radius:12px; margin:15px 0; border:1px solid #333; }
        .n-tab { flex:1; text-align:center; padding:12px; border-radius:10px; font-size:.9rem; color:#777; transition:.2s; font-weight:bold; cursor:pointer; }
        .n-tab.active { background:#222; color:#fff; box-shadow:0 2px 10px rgba(0,0,0,.2); }

        .macro-bar-container { margin-bottom:20px; background:#111; padding:15px; border-radius:12px; border:1px solid #333; }
        .macro-label { display:flex; justify-content:space-between; font-size:.9rem; margin-bottom:8px; color:#ccc; font-weight:bold; }
        .progress-track { width:100%; height:10px; background:#222; border-radius:5px; overflow:hidden; }
        .progress-fill { height:100%; border-radius:5px; transition:width .5s; }

        .food-grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; padding-bottom:20px; }
        .food-item { background:#1a1a1a; padding:15px; border-radius:12px; border:1px solid #333; display:flex; flex-direction:column; gap:5px; font-size:.9rem; cursor:pointer; transition:.2s; position:relative; overflow:hidden; }
        .food-item:active { transform:scale(.98); background:#222; }

        .supp-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:10px; margin-bottom:15px; }
        .supp-icon { background:#222; border:1px solid #333; aspect-ratio:1; border-radius:12px; display:flex; align-items:center; justify-content:center; flex-direction:column; font-size:.7rem; cursor:pointer; opacity:.5; transition:.3s; }
        .supp-icon.active { opacity:1; border-color:var(--blue); background:rgba(10,132,255,.1); box-shadow:0 0 10px rgba(10,132,255,.3); }

        .plate-visual { display:flex; gap:2px; justify-content:center; align-items:flex-end; height:60px; margin-top:15px; }
        .plate { height:100%; border-radius:4px; border:1px solid rgba(255,255,255,.2); display:flex; align-items:center; justify-content:center; font-size:.7rem; color:#000; font-weight:bold; }

        .anatomy-container { position:relative; width:150px; height:260px; margin:20px auto; }
        .anatomy-svg { width:100%; height:100%; overflow:visible; }
        .muscle-path { fill:#333; stroke:#222; stroke-width:1; transition:fill .5s; }

        .pain-grid { display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin-top:10px; }
        .pain-part { padding:8px 16px; background:#222; border:1px solid #333; border-radius:20px; font-size:.8rem; cursor:pointer; }
        .pain-part.active { background:var(--danger); color:#fff; border-color:var(--danger); }

        .action-btn { width:100%; margin-top:10px; padding:14px; background:#222; border:1px solid #333; color:var(--text); border-radius:12px; font-weight:600; font-size:.9rem; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:8px; transition:.2s; position:relative; z-index:10; }
        .action-btn:active { background:#333; }
        .btn-jump { border-color:var(--purple); color:var(--purple); background:rgba(191,90,242,.1); }

        .spin-btn { width:100%; padding:14px; background:#222; border:1px solid #333; color:#fff; border-radius:12px; font-weight:bold; cursor:pointer; margin-top:10px; display:flex; align-items:center; justify-content:center; gap:5px; }

        .mental-sub { font-size:.8rem; color:#aaa; margin-top:8px; }
        .mental-row { display:flex; gap:10px; margin-top:10px; align-items:center; }
        .mental-row input { flex:1; }

        .recovery-badge { font-size:.75rem; color:#ccc; margin-top:8px; }

        #painAdvice { margin-top:10px; font-size:.8rem; color:#ccc; background:#111; border-radius:10px; padding:10px; border:1px solid #333; }

        @keyframes slideUp { from{transform:translateY(100%);} to{transform:translateY(0);} }
        @keyframes fadeIn { from{opacity:0; transform:translateY(-10px);} to{opacity:1; transform:translateY(0);} }
    </style>
</head>
<body>
<canvas id="confetti"></canvas>

<header>
    <div class="header-top">
        <div style="display:flex; flex-direction:column">
            <div class="app-title">PRIME v23.0 <span style="font-size:.8rem; color:var(--accent)">Coach Pack</span></div>
            <div style="font-size:.6rem; letter-spacing:2px; color:var(--blue); font-weight:bold" id="seasonBadge">SEZON Ä°Ã‡Ä°</div>
        </div>
        <div style="display:flex; gap:15px; align-items:center;">
            <div class="challenge-badge" onclick="openModal('challengeModal')">ğŸ† <span id="challengeShort">0/1000</span></div>
            <button class="icon-btn" onclick="openModal('zoneModal')">ğŸ§˜</button>
            <button class="icon-btn" onclick="openModal('settingsModal')">âš™ï¸</button>
        </div>
    </div>
    <div class="xp-container"><div class="xp-fill" id="xpBar"></div></div>
    <div class="level-badge">
        <span id="currentLvl">Lvl 1</span>
        <span id="userRank">Rookie</span>
        <span id="xpText">0 XP</span>
    </div>
</header>

<div class="quote-box" id="dailyQuote" style="text-align:center; padding:15px; font-style:italic; color:#888; font-size:.9rem;">...</div>

<div class="date-strip" style="display:flex; justify-content:space-between; align-items:center; padding:0 16px; margin-bottom:15px; position:relative; z-index:10;">
    <div class="nav-arrow" onclick="changeDate(-1)" style="font-size:1.5rem; padding:10px; cursor:pointer;">â®</div>
    <div style="font-weight:700; font-size:1.1rem;" id="dateDisplay">BugÃ¼n</div>
    <div class="nav-arrow" onclick="changeDate(1)" style="font-size:1.5rem; padding:10px; cursor:pointer;">â¯</div>
</div>

<div class="container">
    <div class="alert-box alert-deload" id="deloadAlert" style="display:none;"><span>âš ï¸</span> <div><b>Yorgunluk Tespit Edildi!</b><br>Son 7 gÃ¼n yÃ¼k + uyku verilerine gÃ¶re bugÃ¼n yÃ¼kÃ¼ azalt.</div></div>
    <div class="alert-box alert-low" id="lowEnergyAlert" style="display:none;"><span>ğŸ¢</span> <div><b>HAFÄ°F ANTRENMAN</b><br>HazÄ±rlÄ±k derecen dÃ¼ÅŸÃ¼k. TekniÄŸe ve mobiliteye odaklan.</div></div>
    <div class="alert-box alert-high" id="highEnergyAlert" style="display:none;"><span>ğŸš€</span> <div><b>REKOR GÃœNÃœ!</b><br>HazÄ±rlÄ±k yÃ¼ksek. IsÄ±nmayÄ± iyi yap, seÃ§ili 1â€“2 harekette PR dene.</div></div>

    <div class="prehab-box" id="prehabSection">
        <div class="box-header" style="color:var(--blue)">ğŸ›¡ï¸ SakatlÄ±k Ã–nleme & IsÄ±nma</div>
        <div id="prehabList"></div>
    </div>

    <div class="card" id="mentalCard" style="display:none;">
        <div class="box-header">ğŸ§  MaÃ§ / Ã–nemli GÃ¼n Mental Rutin</div>
        <div class="mental-sub">1 tur nefes, 30 sn gÃ¶rselleÅŸtirme, 1 cÃ¼mle niyet â†’ sonra alttan tamamla.</div>
        <button class="action-btn" onclick="completeMentalRoutine()">Rutin TamamlandÄ± (+20 XP)</button>
        <div class="mental-sub" style="margin-top:10px;">
            Odak: <span id="focusLabel">3</span> â€¢ Ã–zgÃ¼ven: <span id="confLabel">3</span><br>
            (AyrÄ±ntÄ±lar HazÄ±rlÄ±k ekranÄ±ndan)
        </div>
    </div>

    <div class="card">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; border-bottom:1px solid #333; padding-bottom:10px;">
            <div>
                <h2 style="margin:0; font-size:1.3rem" id="progTitle">...</h2>
                <small style="color:var(--muted)" id="progSub">...</small>
                <div id="readinessBadge" style="font-size:.65rem; background:#222; display:inline-block; padding:2px 6px; border-radius:4px; margin-top:4px; color:#aaa">Enerji: ?</div>
                <div id="recoveryBadge" class="recovery-badge">Recovery: -</div>
            </div>
            <div style="text-align:right">
                <div style="font-size:1.5rem; font-weight:900; color:var(--accent)" id="progPercent">%0</div>
                <div style="font-size:.7rem; color:#777; margin-top:4px">YÃœK: <span id="totalVolume" style="color:#fff; font-weight:bold">0 kg</span></div>
            </div>
        </div>

        <div id="workoutList"></div>

        <button class="action-btn btn-jump" onclick="addJumpToToday()">ğŸš€ + AnlÄ±k ZÄ±plama Ekle</button>

        <div class="finisher-box" style="margin-top:20px; position:relative; z-index:10;">
            <button class="spin-btn" onclick="spinFinisher()">ğŸ² Cila (Finisher) Ã‡evir</button>
            <div class="finisher-result" id="finisherResult" style="margin-top:10px; font-weight:bold; color:var(--purple); display:none; text-align:center;">...</div>
            <div style="margin-top:10px; font-size:.7rem; color:#666; text-align:center;">
                <label><input type="radio" name="fType" value="gym" checked> Salon</label>
                <label style="margin-left:10px"><input type="radio" name="fType" value="basket"> Saha</label>
            </div>
        </div>

        <button class="action-btn" onclick="openModal('builderModal')" style="margin-top:15px; color:var(--blue)">ğŸ› ï¸ ProgramÄ± DeÄŸiÅŸtir</button>
    </div>

    <div class="card tracker-section">
        <h3 style="margin:0 0 15px 0">ğŸ”‹ GÃ¼nlÃ¼k Takip</h3>
        <div class="grid-3">
            <div class="track-box" onclick="addWater()">
                <div class="track-val" id="waterCount">0 lt</div>
                <div style="font-size:.7rem; color:#777; margin-top:5px">SU</div>
            </div>
            <div class="track-box" onclick="openModal('nutriModal')">
                <div class="track-val" id="calStatus">0</div>
                <div style="font-size:.7rem; color:#777; margin-top:5px">KALORÄ°</div>
            </div>
            <div class="track-box" id="proBox" style="border-color:#333" onclick="openModal('nutriModal')">
                <div class="track-val" id="proStatus">0g</div>
                <div style="font-size:.7rem; color:#777; margin-top:5px">PROTEÄ°N</div>
            </div>
        </div>
        <div style="display:flex; gap:10px; margin-top:10px; align-items:center;">
            <input type="number" min="0" id="steps" class="mini-input" style="flex:1; width:auto;" placeholder="AdÄ±m" onchange="saveData()">
            <div style="font-size:.7rem; color:#777;">Hedef: 8000+</div>
        </div>
        <textarea id="journal" style="width:100%; background:#111; color:#fff; border:1px solid #333; border-radius:12px; padding:15px; min-height:80px; margin-top:10px;" placeholder="Genel notlar..." oninput="saveData()"></textarea>
        <textarea id="journalPride" style="width:100%; background:#111; color:#fff; border:1px solid #444; border-radius:12px; padding:10px; min-height:50px; margin-top:8px; font-size:.85rem;" placeholder="BugÃ¼n kendimle gurur duyduÄŸum 1 ÅŸey..." oninput="saveData()"></textarea>
    </div>
</div>

<div class="timer-float" id="timerFloat">
    <div style="font-size:.7rem; color:var(--accent); font-weight:bold">REST</div>
    <div class="timer-val" id="timerDisplay">01:30</div>
    <button class="icon-btn" onclick="addTimer(10)" style="color:#fff; font-size:1.1rem">+10</button>
    <button class="icon-btn" onclick="stopTimer()" style="color:var(--danger); font-size:1.1rem">âœ•</button>
</div>

<div class="bottom-bar">
    <div class="tab-btn" onclick="togglePanic()">ğŸ </div>
    <div class="tab-btn" onclick="openModal('nutriModal')">ğŸ</div>
    <div class="tab-btn active" onclick="window.scrollTo(0,0)">ğŸ’ª</div>
    <div class="tab-btn" onclick="openModal('statsModal')">ğŸ“Š</div>
</div>

<div class="modal full-modal" id="clutchModal">
    <div class="sheet clutch-modal" style="text-align:center;">
        <div style="font-size:3rem; margin-bottom:10px">ğŸ”¥</div>
        <h2 class="clutch-title">CLUTCH TIME!</h2>
        <p style="color:#ccc; margin-top:10px">MaÃ§Ä±n son topu elinde.</p>
        <div class="clutch-task" id="clutchTaskDisplay">...</div>
        <div style="color:var(--gold); font-size:.9rem; margin-bottom:20px">Ã–dÃ¼l: 2x XP</div>
        <button onclick="completeClutch()" class="spin-btn" style="width:100%; justify-content:center; background:var(--danger); margin-bottom:10px">YAPTIM (+XP)</button>
        <button onclick="closeModal('clutchModal'); showWrapUp()" style="background:none; border:none; color:#777; text-decoration:underline">Pas GeÃ§</button>
    </div>
</div>

<div class="modal full-modal" id="zoneModal">
    <div class="sheet" style="text-align:center">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2>Zone Modu</h2>
            <span onclick="closeZone()">âœ•</span>
        </div>
        <p style="color:#777; font-size:.9rem">Kutu Nefes: 4 Al - 4 Tut - 4 Ver - 4 Tut</p>
        <div class="breathing-circle" id="breathCircle" style="width:150px; height:150px; border:4px solid #333; border-radius:50%; margin:30px auto; display:flex; align-items:center; justify-content:center; font-size:1.5rem; font-weight:bold; color:var(--blue); transition:all 4s ease-in-out;">BAÅLA</div>
        <div class="breathing-text" id="breathText">Odaklan...</div>
        <button onclick="startBreathing()" class="spin-btn" style="margin-top:30px; width:100%; justify-content:center">BaÅŸlat</button>
    </div>
</div>

<div class="modal full-modal" id="wrapUpModal">
    <div class="sheet" style="text-align:center; border-color:var(--gold)">
        <div style="font-size:3rem; margin-bottom:10px">ğŸ‰</div>
        <h2 style="color:var(--gold); font-size:1.8rem; margin:0">ANTRENMAN TAMAMLANDI!</h2>
        <div class="wrap-stats" style="display:flex; justify-content:space-around; margin:20px 0;">
            <div class="wrap-box">
                <div class="wrap-val" id="wrapVol">0</div>
                <div style="font-size:.8rem; color:#777">Toplam YÃ¼k (Kg)</div>
            </div>
            <div class="wrap-box">
                <div class="wrap-val" id="wrapXP">0</div>
                <div style="font-size:.8rem; color:#777">KazanÄ±lan XP</div>
            </div>
        </div>
        <button onclick="closeModal('wrapUpModal')" class="spin-btn" style="width:100%; justify-content:center; background:#333; border:1px solid #555">Kapat</button>
    </div>
</div>

<div class="modal full-modal" id="nutriModal">
    <div class="sheet nutri-container">
        <div class="close-sticky" onclick="closeModal('nutriModal')">âœ•</div>
        <h2 style="padding:0 20px">Beslenme Merkezi</h2>
        <div style="padding:0 20px">
            <div class="nutri-tabs">
                <div class="n-tab active" onclick="switchToolTab('track', this)">Takip</div>
                <div class="n-tab" onclick="switchToolTab('wizard', this)">Sihirbaz</div>
                <div class="n-tab" onclick="switchToolTab('1rm', this)">1RM & Hesap</div>
            </div>

            <div id="tool-track" class="tool-content active">
                <div style="text-align:center;margin-bottom:15px">
                    HEDEF:
                    <span id="targetCalDisplay" style="color:var(--gold);font-weight:bold">--</span> kcal /
                    <span style="color:var(--accent);font-weight:bold">160g</span> Prot
                </div>
                <div class="macro-bar-container">
                    <div class="macro-label"><span>Kalori</span><span id="calText">0</span></div>
                    <div class="progress-track"><div class="progress-fill" id="calBar" style="width:0%;background:var(--gold)"></div></div>
                </div>
                <div class="macro-bar-container">
                    <div class="macro-label"><span>Protein</span><span id="proText">0</span></div>
                    <div class="progress-track"><div class="progress-fill" id="proBar" style="width:0%;background:var(--accent)"></div></div>
                </div>
                <div style="display:flex; gap:10px; margin-bottom:15px; background:#1a1a1a; padding:10px; border-radius:12px; border:1px solid #333;">
                    <input type="number" min="0" id="quickCal" class="mini-input" style="flex:1; width:auto;" placeholder="Kcal">
                    <input type="number" min="0" id="quickPro" class="mini-input" style="flex:1; width:auto;" placeholder="Prot (g)">
                    <button class="tool-btn" style="width:50px" onclick="addQuickMacros()">+</button>
                </div>
                <h4 style="margin-bottom:10px; color:#888;">Supplementler</h4>
                <div class="supp-grid">
                    <div class="supp-icon" id="supp-creatine" onclick="toggleSupp('creatine')">ğŸ§ª<br>Kreatin</div>
                    <div class="supp-icon" id="supp-omega" onclick="toggleSupp('omega')">ğŸŸ<br>Omega3</div>
                    <div class="supp-icon" id="supp-multi" onclick="toggleSupp('multi')">ğŸ’Š<br>Vitamin</div>
                    <div class="supp-icon" id="supp-caffeine" onclick="toggleSupp('caffeine')">â˜•<br>Kafein</div>
                </div>
                <div class="timing-box" id="nutrientTimingBox" style="display:none; background:rgba(255,214,10,.1); padding:10px; border-radius:10px; margin-bottom:15px;">
                    <div style="font-weight:bold; color:var(--gold); margin-bottom:5px">âš¡ MAÃ‡ GÃœNÃœ ZAMANLAMASI</div>
                    <div class="timing-item" onclick="toggleTiming('t1')" id="time-t1" style="padding:5px; cursor:pointer;">ğŸ”² MaÃ§tan 3-4 Saat Ã–nce: Karbonhidrat</div>
                    <div class="timing-item" onclick="toggleTiming('t2')" id="time-t2" style="padding:5px; cursor:pointer;">ğŸ”² MaÃ§tan 1 Saat Ã–nce: Hafif AtÄ±ÅŸtÄ±rmalÄ±k</div>
                    <div class="timing-item" onclick="toggleTiming('t3')" id="time-t3" style="padding:5px; cursor:pointer;">ğŸ”² MaÃ§ SonrasÄ± (30dk): Protein & Åeker</div>
                </div>
                <h4 style="margin-bottom:10px; color:#888;">HÄ±zlÄ± MenÃ¼</h4>
                <div class="food-grid" id="foodGrid"></div>
                <div id="foodLog" class="food-log-list" style="margin-top:15px; font-size:.8rem; color:#777;"></div>
                <button onclick="clearNutrition()" style="width:100%; margin-top:20px; padding:10px; background:none; border:1px solid #333; color:#666; border-radius:8px;">Listeyi Temizle</button>
            </div>

            <div id="tool-wizard" class="tool-content" style="display:none;">
                <button class="spin-btn" style="width:100%; justify-content:center; margin-bottom:15px" onclick="generateMenu()">ğŸ² Rastgele GÃ¼nlÃ¼k MenÃ¼ OluÅŸtur</button>
                <div id="menuResult"></div>
            </div>

            <div id="tool-1rm" class="tool-content" style="display:none;">
                <div style="display:flex;gap:10px">
                    <input type="number" min="0" id="rmWeight" class="mini-input" style="width:50%" placeholder="Kilo">
                    <input type="number" min="0" id="rmReps" class="mini-input" style="width:50%" placeholder="Tekrar">
                </div>
                <button onclick="calc1RM()" class="spin-btn" style="width:100%;margin-top:15px">1RM Hesapla</button>
                <div id="rmResult" style="font-size:2rem;text-align:center;margin-top:20px;color:var(--blue)"></div>
            </div>
        </div>
    </div>
</div>

<div class="modal full-modal" id="statsModal">
    <div class="sheet" style="padding-top:60px;">
        <div class="close-sticky" onclick="closeModal('statsModal')">âœ•</div>
        <h2>Ä°statistikler</h2>
        <div style="display:flex; gap:10px; margin-bottom:15px;">
            <input type="number" min="0" id="userHeight" class="mini-input" style="width:50%; padding:15px" placeholder="Boy (cm)" onchange="saveStats()">
            <input type="number" min="0" id="dailyWeight" class="mini-input" style="width:50%; padding:15px" placeholder="Kilo (kg)" onchange="saveData()">
        </div>
        <div style="display:flex; gap:10px; margin-bottom:15px;">
            <input type="number" min="0" max="24" id="sleepHours" class="mini-input" style="width:50%; padding:15px" placeholder="Uyku (saat)" onchange="saveData()">
            <input type="number" min="1" max="5" id="sleepQuality" class="mini-input" style="width:50%; padding:15px" placeholder="Kalite (1-5)" onchange="saveData()">
        </div>
        <div class="alert-box alert-imbalance" id="legAlert">
            <span>ğŸ”</span>
            <div><b>Chicken Leg UyarÄ±sÄ±!</b><br>Ãœst vÃ¼cudun geliÅŸti ama bacaklarÄ± ihmal ediyorsun.</div>
        </div>
        <h4 style="margin-top:20px; border-top:1px solid #333; padding-top:10px; text-align:center">Kas YoÄŸunluk HaritasÄ±</h4>
        <div class="anatomy-container">
            <svg class="anatomy-svg" viewBox="0 0 100 200">
                <circle cx="50" cy="20" r="10" fill="#333" />
                <path id="svg-shoulders" class="muscle-path" d="M30 35 L70 35 L75 45 L25 45 Z" />
                <path id="svg-arms" class="muscle-path" d="M25 45 L15 80 L22 80 L30 45 Z M75 45 L85 80 L78 80 L70 45 Z" />
                <path id="svg-chest" class="muscle-path" d="M35 45 L65 45 L60 65 L40 65 Z" />
                <path id="svg-core" class="muscle-path" d="M40 65 L60 65 L58 90 L42 90 Z" />
                <path id="svg-legs" class="muscle-path" d="M38 90 L62 90 L65 140 L55 140 L52 100 L48 100 L45 140 L35 140 Z" />
            </svg>
        </div>
        <h4 style="margin-top:20px; border-top:1px solid #333; padding-top:10px">AÄŸrÄ± HaritasÄ±</h4>
        <div class="pain-grid" id="painMapGrid">
            <div class="pain-part" onclick="togglePain('diz')">Diz</div>
            <div class="pain-part" onclick="togglePain('bel')">Bel</div>
            <div class="pain-part" onclick="togglePain('omuz')">Omuz</div>
            <div class="pain-part" onclick="togglePain('bilek')">Bilek</div>
            <div class="pain-part" onclick="togglePain('kalca')">KalÃ§a</div>
        </div>
        <div id="painAdvice"></div>

        <h4 style="margin-top:20px; border-top:1px solid #333; padding-top:10px">Son MaÃ§lar</h4>
        <div id="gameInsights" style="font-size:.8rem; color:#aaa; margin-bottom:8px;"></div>
        <div id="gameHistory"></div>
    </div>
</div>

<div class="modal" id="plateModal">
    <div class="sheet">
        <h2>Plaka HesaplayÄ±cÄ±</h2>
        <input type="number" min="0" id="plateTarget" class="mini-input" style="width:100%; font-size:1.5rem; padding:15px; margin-bottom:10px;" placeholder="Hedef (kg)" oninput="calcPlates()">
        <div id="plateResult" style="color:var(--accent);font-weight:bold;margin-bottom:10px"></div>
        <div id="plateVisual" class="plate-visual"></div>
        <span onclick="closeModal('plateModal')" style="position:absolute;top:20px;right:20px;font-size:1.5rem; cursor:pointer;">âœ•</span>
    </div>
</div>

<div class="modal" id="historyModal">
    <div class="sheet">
        <h2 id="histTitle">GeÃ§miÅŸ</h2>
        <div id="histList" style="margin-top:15px;"></div>
        <span onclick="closeModal('historyModal')" style="position:absolute;top:20px;right:20px;font-size:1.5rem; cursor:pointer;">âœ•</span>
    </div>
</div>

<div class="modal" id="builderModal">
    <div class="sheet">
        <div style="display:flex; justify-content:space-between;">
            <h2>Program Yap</h2><span onclick="closeModal('builderModal')">âœ•</span>
        </div>
        <select id="mainMuscle" style="width:100%;padding:12px;background:#000;color:#fff;border:1px solid #333;border-radius:8px;margin-bottom:10px" onchange="updateSec()">
            <option value="">1. BÃ¶lge</option>
            <option value="chest">GÃ¶ÄŸÃ¼s</option>
            <option value="back">SÄ±rt</option>
            <option value="legs">Bacak</option>
            <option value="shoulders">Omuz</option>
            <option value="arms">Kol</option>
        </select>
        <select id="subMuscle" style="width:100%;padding:12px;background:#000;color:#fff;border:1px solid #333;border-radius:8px;margin-bottom:10px" disabled>
            <option>2. BÃ¶lge</option>
        </select>
        <div class="toggle-row">
            <span>ğŸ€ SÄ±Ã§rama Ekle (Booster)</span>
            <label class="switch"><input type="checkbox" id="addJump"><span class="slider"></span></label>
        </div>
        <button onclick="buildProg()" style="width:100%;padding:15px;background:var(--blue);border:none;border-radius:8px;color:#fff;font-weight:bold">Uygula</button>
    </div>
</div>

<div class="modal" id="readinessModal">
    <div class="sheet">
        <div style="display:flex; justify-content:space-between;">
            <h2>GÃ¼nlÃ¼k HazÄ±rlÄ±k</h2><span onclick="closeModal('readinessModal')">âœ•</span>
        </div>
        <p style="color:#aaa; margin-bottom:10px">BugÃ¼n kendini nasÄ±l hissediyorsun?</p>
        <div class="readiness-scale" style="display:flex; justify-content:space-between; font-size:2rem;">
            <div class="r-btn" onclick="setReadiness(1)">ğŸ˜«</div>
            <div class="r-btn" onclick="setReadiness(2)">ğŸ¥±</div>
            <div class="r-btn" onclick="setReadiness(3)">ğŸ˜</div>
            <div class="r-btn" onclick="setReadiness(4)">ğŸ™‚</div>
            <div class="r-btn" onclick="setReadiness(5)">ğŸ”¥</div>
        </div>
        <div class="mental-row">
            <span style="font-size:.8rem; color:#ccc;">Odak</span>
            <input type="range" id="focusInput" min="1" max="5" value="3" oninput="updateFocusLabel(this.value)">
        </div>
        <div class="mental-row">
            <span style="font-size:.8rem; color:#ccc;">Ã–zgÃ¼ven</span>
            <input type="range" id="confInput" min="1" max="5" value="3" oninput="updateConfLabel(this.value)">
        </div>
        <div style="font-size:.75rem; color:#777; margin-top:8px;">Bu deÄŸerler mental koÃ§ tarafÄ±ndan maÃ§ performanslarÄ±nle birlikte yorumlanÄ±r.</div>
    </div>
</div>

<div class="modal" id="gameLogModal">
    <div class="sheet">
        <div style="display:flex; justify-content:space-between;">
            <h2>ğŸ€ MaÃ§ Karnesi</h2><span onclick="closeModal('gameLogModal')">âœ•</span>
        </div>
        <div style="display:flex; gap:10px; margin:20px 0;">
            <input type="number" min="0" id="gamePoints" class="mini-input" style="width:50%; padding:15px" placeholder="SayÄ±">
            <input type="number" min="0" id="gameAssists" class="mini-input" style="width:50%; padding:15px" placeholder="Asist">
        </div>
        <div style="display:flex; gap:10px; margin:10px 0;">
            <input type="number" min="0" id="gameRebounds" class="mini-input" style="width:50%; padding:15px" placeholder="Rib">
            <input type="number" min="0" id="gameSteals" class="mini-input" style="width:50%; padding:15px" placeholder="TÃ‡">
        </div>
        <div style="display:flex; gap:10px; margin-bottom:10px;">
            <select id="gameResult" style="width:100%; padding:12px; background:#222; color:#fff; border:1px solid #333; border-radius:8px;">
                <option value="W">Galibiyet (W)</option>
                <option value="L">MaÄŸlubiyet (L)</option>
            </select>
        </div>
        <textarea id="gameNotes" style="width:100%; background:#000; border:1px solid #333; color:#fff; padding:10px; border-radius:8px" placeholder="MaÃ§ yorumu..."></textarea>
        <button onclick="saveGameLog()" style="width:100%; padding:15px; background:var(--accent); border:none; border-radius:10px; margin-top:15px; font-weight:bold">Kaydet</button>
    </div>
</div>

<div class="modal" id="settingsModal">
    <div class="sheet">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2>Ayarlar</h2>
            <span style="cursor:pointer;" onclick="closeModal('settingsModal')">âœ•</span>
        </div>
        <div class="toggle-row">
            <span>ğŸ€ Sezon Ä°Ã§i</span>
            <label class="switch"><input type="checkbox" id="seasonToggle" onchange="toggleSeason()"><span class="slider"></span></label>
        </div>
        <div class="toggle-row">
            <span>ğŸ”Š Ses Efektleri</span>
            <label class="switch"><input type="checkbox" id="soundToggle" onchange="toggleSound()"><span class="slider"></span></label>
        </div>
        <div style="display:flex; gap:10px; margin:20px 0">
            <button onclick="exportData()" class="backup-btn" style="width:100%; padding:10px; background:#222; color:var(--blue); border:1px solid var(--blue); border-radius:8px;">ğŸ“¥ Ä°ndir</button>
            <button onclick="document.getElementById('importFile').click()" class="backup-btn" style="width:100%; padding:10px; background:#222; color:var(--warn); border:1px solid var(--warn); border-radius:8px;">ğŸ“¤ YÃ¼kle</button>
            <input type="file" id="importFile" style="display:none" onchange="importData(this)">
        </div>
        <button onclick="resetApp()" style="width:100%; padding:15px; background:var(--danger); border:none; border-radius:10px; color:#fff; font-weight:bold">SÄ±fÄ±rla</button>
    </div>
</div>

<div class="modal" id="challengeModal">
    <div class="sheet">
        <div style="display:flex; justify-content:space-between;">
            <h2>Meydan Okuma</h2><span onclick="closeModal('challengeModal')">âœ•</span>
        </div>
        <div style="background:#111; padding:20px; border-radius:12px; text-align:center; margin-top:20px">
            <h3 style="margin:0; color:var(--warn)" id="challengeTitle">1000 ÅÄ±nav</h3>
            <div style="font-size:2rem; font-weight:bold; margin:10px 0" id="challengeDisplay">0 / 1000</div>
            <div class="progress-track"><div class="progress-fill" id="challengeBarFill" style="width:0%; background:var(--warn)"></div></div>
            <div style="margin-top:20px; display:flex; gap:10px; justify-content:center">
                <button class="mini-input" onclick="addChallenge(10)">+10</button>
                <button class="mini-input" onclick="addChallenge(25)">+25</button>
                <button class="mini-input" onclick="addChallenge(50)">+50</button>
            </div>
            <button onclick="setChallenge()" style="margin-top:15px; background:none; border:none; color:#555; font-size:.8rem; text-decoration:underline">Hedefi DeÄŸiÅŸtir</button>
        </div>
    </div>
</div>

<script>
    const visuals = {
        push:`<svg viewBox="0 0 24 24"><path d="M4 18h16v-2H4v2zM8 6h8v2H8V6zm4 4c-1.1 0-2 .9-2 2v4h4v-4c0-1.1-.9-2-2-2z" fill="#fff"/></svg>`,
        pull:`<svg viewBox="0 0 24 24"><path d="M12 2C9.24 2 7 4.24 7 7v4h2V7h10v4h2V7c0-2.76-2.24-5-5-5h-4zm-2 12v8h4v-8h-4z" fill="#fff"/></svg>`,
        legs:`<svg viewBox="0 0 24 24"><path d="M12 4c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-2 16v-4h4v4h-4zm0-6h4v-2h-4v2zm-4 6h2v-6H6v6zm12 0h2v-6h-2v6z" fill="#fff"/></svg>`,
        press:`<svg viewBox="0 0 24 24"><path d="M12 2L4 10h5v12h6V10h5L12 2z" fill="#fff"/></svg>`,
        core:`<svg viewBox="0 0 24 24"><path d="M20 18h-2v-2h-2v2H8v-2H6v2H4v-6c0-1.1.9-2 2-2h12c1.1 0 2 .9 2 2v6z" fill="#fff"/></svg>`,
        arm:`<svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 9h-2V7h-2v5H6v2h2v5h2v-5h2v-2z" fill="#fff"/></svg>`,
        cardio:`<svg viewBox="0 0 24 24"><path d="M13.5 5.5c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zM9.8 8.9L7 23h2.1l1.8-8.4L13 19v4h2v-5l-1.8-3.6 1.8-1.4c.6-.5 1.1-.7 1.7-.7.3 0 .5.1.8.2L20 13v-2l-2.1-.6c-1.1-.4-2.4-.1-3.2.7l-1.5 1.5-1.4-4.1z" fill="#fff"/></svg>`,
        pilates:`<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="8" fill="none" stroke="#fff" stroke-width="2"/><circle cx="12" cy="12" r="2" fill="#fff"/></svg>`
    };

    const quotes = [
        "Yetenek seni zirveye taÅŸÄ±r, karakter orada tutar.",
        "Antrenman bittiÄŸinde asÄ±l geliÅŸim baÅŸlar.",
        "BugÃ¼n yaptÄ±ÄŸÄ±n her tekrar yarÄ±nki zaferin tuÄŸlasÄ±dÄ±r.",
        "Yorgunluk sadece zihnindedir."
    ];

    const muscleDB = {
        chest:{t:"GÃ¶ÄŸÃ¼s", mb:"chest", i:[
            {n:"Bench Press (4x8)",v:"push",d:"BarÄ± gÃ¶ÄŸÃ¼s ucuna indir, omuzlarÄ± kilitleme."},
            {n:"Incline Press (3x10)",v:"push",d:"Ãœst gÃ¶ÄŸse odaklan, kontrolÃ¼ kaybetme."},
            {n:"Cable Fly",v:"push",d:"Hareketin sonunda gÃ¶ÄŸÃ¼ste sÄ±kma hisset."}
        ]},
        back:{t:"SÄ±rt", mb:"back", i:[
            {n:"Pull Up",v:"pull",d:"Ã‡eneni barÄ±n Ã¼zerine getir, salÄ±nma yok."},
            {n:"Barbell Row",v:"pull",d:"KÃ¼rek kemiklerini sÄ±k, belini yuvarlama."},
            {n:"Lat Pulldown",v:"pull",d:"BarÄ± gÃ¶ÄŸÃ¼s hizasÄ±na indir, trapeze yÃ¼k bindirme."}
        ]},
        legs:{t:"Bacak", mb:"legs", i:[
            {n:"Back Squat",v:"legs",d:"Topuklara bas, dizleri iÃ§e dÃ¼ÅŸÃ¼rme."},
            {n:"RDL",v:"legs",d:"KalÃ§ayÄ± geriye it, belini kilitle."},
            {n:"Walking Lunge",v:"legs",d:"Uzun adÄ±m, diz Ã§izgisini geÃ§irme."}
        ]},
        shoulders:{t:"Omuz", mb:"shoulders", i:[
            {n:"OH Press",v:"press",d:"KarnÄ± sÄ±k, barÄ± dÃ¼z hatta yukarÄ± it."},
            {n:"Lateral Raise",v:"press",d:"Dirsekten hafif kÄ±rÄ±k, kontrolÃ¼ bÄ±rakma."}
        ]},
        arms:{t:"Kol", mb:"arms", i:[
            {n:"Barbell Curl",v:"arm",d:"Dirsekleri sabit tut, savurma."},
            {n:"Triceps Pushdown",v:"arm",d:"Dirsekleri kilitle, son noktada sÄ±k."}
        ]},
        core:{t:"KarÄ±n", mb:"core", i:[
            {n:"Plank",v:"core",d:"KalÃ§ayÄ± dÃ¼ÅŸÃ¼rme, nefesini tutma."},
            {n:"Dead Bug",v:"core",d:"Belini yere bastÄ±r, hareketi kontrollÃ¼ yap."}
        ]}
    };

    const compat = { chest:['arms','shoulders'], back:['arms','shoulders'], legs:['core'], shoulders:['arms'], arms:['core'] };

    const jumpR = [
        {n:"Pogo Hops (3x20)", v:"legs", d:"Bilekleri kilitle, hÄ±zlÄ± ve hafif sÄ±Ã§ra."},
        {n:"Box Jump (3x8)", v:"legs", d:"AlÃ§ak kutuya patlayÄ±cÄ± sÄ±Ã§ra, sessiz iniÅŸ."},
        {n:"Depth Jump (3x5)", v:"legs", d:"Kutu Ã¼zerinden in, yere deÄŸer deÄŸmez zÄ±pla."}
    ];

    const finishers = {
        gym: [
            {n:"ğŸ”¥ 1 Dakika Plank", d:"Core stabilitesi ve mental dayanÄ±klÄ±lÄ±k iÃ§in.", y:"plank core exercise"},
            {n:"ğŸ”¥ 50 Mekik", d:"KarÄ±n kaslarÄ±nÄ± yakmak iÃ§in klasik finisher.", y:"crunches abs workout"},
            {n:"ğŸ”¥ Tabata Burpee (4dk)", d:"20 sn burpee / 10 sn dinlen â€“ 8 tur.", y:"tabata burpee workout"},
            {n:"ğŸ”¥ 100 ÅÄ±nav (Toplam)", d:"Setlere bÃ¶l, formu bozmadan tamamla.", y:"push up workout beginner"},
            {n:"ğŸ”¥ Farmer's Walk", d:"AÄŸÄ±rlÄ±klarÄ± yanlarda taÅŸÄ±, kavrama + core.", y:"farmer walk exercise"},
            {n:"ğŸ”¥ Dead Hang (Max SÃ¼re)", d:"Barfixte asÄ±lÄ± kal; omuz + kavrama iÃ§in.", y:"dead hang grip strength"}
        ],
        basket: [
            {n:"ğŸ€ 5 Noktadan 10'ar Åut", d:"Her bÃ¶lgeden 10 ÅŸut, ritim odaklÄ±.", y:"basketball shooting spots drill"},
            {n:"ğŸ€ 50 Serbest AtÄ±ÅŸ (Sokmadan Ã‡Ä±kma)", d:"Yorgunken serbest atÄ±ÅŸ konsantrasyonu.", y:"basketball free throw routine"},
            {n:"ğŸ€ Mikan Drill (2 Dakika)", d:"BoyalÄ± alanda bitiricilik iÃ§in temel drill.", y:"mikan drill finishes"},
            {n:"ğŸ€ 3 SayÄ± YarÄ±ÅŸmasÄ± (10'da KaÃ§?)", d:"10 Ã¼Ã§lÃ¼k dene, skorunu kaydet.", y:"basketball 3 point shooting drill"},
            {n:"ğŸ€ SahayÄ± 5 Kere Tam Tur KoÅŸ", d:"Kondisyon ve ritim iÃ§in tempo koÅŸusu.", y:"basketball suicide conditioning drill"}
        ]
    };

    const clutchTasks = [
        "1 Dakika Plank yapmadan eve gidemezsin!",
        "Ãœst Ã¼ste 10 serbest atÄ±ÅŸ sok!",
        "50 ÅÄ±nav Ã§ek, hemen!"
    ];

    const foodDB = [
        {n:"Yumurta (1 Adet)", c:70, p:6},
        {n:"Tavuk GÃ¶ÄŸsÃ¼ (150g)", c:165, p:31},
        {n:"Pilav (1 Kase)", c:200, p:4},
        {n:"Yulaf (50g)", c:190, p:6},
        {n:"Muz (Orta)", c:105, p:1},
        {n:"Protein Shake", c:120, p:24},
        {n:"Ton BalÄ±ÄŸÄ± (100g)", c:130, p:25},
        {n:"Makarna (1 Tabak)", c:250, p:8},
        {n:"FÄ±stÄ±k Ezmesi (1 tk)", c:90, p:3},
        {n:"YoÄŸurt (1 Kase)", c:100, p:10},
        {n:"Elma", c:52, p:0},
        {n:"Badem/Ceviz (1 AvuÃ§)", c:160, p:6},
        {n:"Lor Peyniri (100g)", c:90, p:15},
        {n:"Izgara KÃ¶fte (150g)", c:350, p:25},
        {n:"Mercimek (1 Tabak)", c:230, p:18},
        {n:"PirinÃ§ PatlaÄŸÄ± (1 ad)", c:30, p:1},
        {n:"Protein Bar", c:200, p:20},
        {n:"Hindi FÃ¼me (2 Dilim)", c:60, p:10},
        {n:"Patates HaÅŸlama (Orta)", c:160, p:4}
    ];

    const warmupDB = {
        "YÃ¼rÃ¼yÃ¼ÅŸ": {d:"Kan akÄ±ÅŸÄ±nÄ± baÅŸlat, zihni antrenmana hazÄ±rla."},
        "Rotator Cuff": {d:"Lastikle dÄ±ÅŸa/iÃ§e rotasyon. Omuz saÄŸlÄ±ÄŸÄ± iÃ§in ÅŸart."},
        "Tibialis": {d:"Duvara yaslanÄ±p parmak ucu kaldÄ±rma. Diz aÄŸrÄ±sÄ±nÄ± Ã¶nlemeye yardÄ±mcÄ± olur."},
        "Patellar Tendon": {d:"Diz kapaÄŸÄ± altÄ± izometrik bekleme (Spanish Squat tarzÄ±)."},
        "KalÃ§a Flexor": {d:"Lunge pozisyonunda arka bacaÄŸÄ± sÄ±kÄ±p esnet."},
        "Omuz Mob.": {d:"Sopayla omuz Ã§evirme (Dislocates) ile hareket aÃ§Ä±klÄ±ÄŸÄ±nÄ± artÄ±r."},
        "KalÃ§a Akt.": {d:"Monster Walk veya Glute Bridge ile kalÃ§ayÄ± uyandÄ±r."},
        "Dinamik IsÄ±nma": {d:"High Knees, Butt Kicks, kol/bacak savurma."},
        "Jacks": {d:"Jumping Jacks ile nabzÄ± 120 Ã¼zerine Ã§Ä±kar."}
    };

    const painPrehab = {
        diz: [
            {n:"Spanish Squat", d:"Patellar tendona yÃ¼kÃ¼ daÄŸÄ±tmak iÃ§in izometrik bekleme.", y:"spanish squat knee pain"},
            {n:"Tibialis Raise", d:"Diz Ã¶nÃ¼ yÃ¼kÃ¼nÃ¼ dengelemek iÃ§in.", y:"tibialis raise exercise"}
        ],
        bel: [
            {n:"Dead Bug", d:"Core stabilitesi ile bel yÃ¼kÃ¼nÃ¼ azalt.", y:"dead bug core exercise"},
            {n:"Bird Dog", d:"Omurga stabilitesi iÃ§in temel hareket.", y:"bird dog exercise"}
        ],
        omuz: [
            {n:"External Rotation Band", d:"Rotator cuff gÃ¼Ã§lendirme.", y:"band external rotation shoulder"},
            {n:"Scap Push Up", d:"KÃ¼rek Ã§evresi stabilitesi.", y:"scapular push ups drill"}
        ],
        bilek: [
            {n:"Wrist Flex/Ext Stretch", d:"Bilek esnekliÄŸi ve kan akÄ±ÅŸÄ± iÃ§in.", y:"wrist flexion extension stretch"},
            {n:"Farmer Carry Hafif", d:"Kavrama ve Ã¶nkol iÃ§in dÃ¼ÅŸÃ¼k yÃ¼k.", y:"farmer carry light kettlebell"}
        ],
        kalca: [
            {n:"Glute Bridge", d:"KalÃ§a aktivasyonu; bel yÃ¼kÃ¼nÃ¼ azaltÄ±r.", y:"glute bridge exercise"},
            {n:"Hip Airplane (Destekli)", d:"KalÃ§a stabilizasyonu iÃ§in.", y:"hip airplane drill"}
        ]
    };

    const seasonSchedule = {
        0:{t:"Dinlenme", s:"Recovery", j:false, pre:["YÃ¼rÃ¼yÃ¼ÅŸ"], i:[{n:"Meal Prep",v:"rest",d:"HaftalÄ±k beslenmeni planla."}]},
        1:{t:"Chest & Triceps", s:"Ä°tme", j:false, pre:["Rotator Cuff"], i:[...muscleDB.chest.i,{n:"Extra Pushdown",v:"arm",d:"Triceps izolasyonu."}]},
        2:{t:"Pilates & Basket", s:"YoÄŸun", j:false, pre:["Tibialis"], i:[
            {n:"Pilates (19:00)",v:"pilates",d:"Core ve esneklik."},
            {n:"Basketbol (20:45)",v:"cardio",d:"Åut, oyun okuma, kondisyon."}
        ]},
        3:{t:"MaÃ§ GÃ¼nÃ¼", s:"Game Night", j:true, pre:["Patellar Tendon"], i:[
            {n:"MaÃ§ (21:45)",v:"cardio", isGame:true, d:"MaÃ§a odaklan, Ä±sÄ±nma ve mental hazÄ±rlÄ±ÄŸÄ± tamamla."}
        ]},
        4:{t:"Pilates", s:"Recov", j:false, pre:["KalÃ§a Flexor"], i:[
            {n:"Pilates (19:00)",v:"pilates",d:"Esneklik ve nefes kontrolÃ¼."}
        ]},
        5:{t:"Back & Biceps", s:"Ã‡ekme", j:true, pre:["Omuz Mob."], i:[...muscleDB.back.i,{n:"Extra Curl",v:"arm",d:"YavaÅŸ negatiflere odaklan."}]},
        6:{t:"Legs & Shoulders", s:"Kuvvet", j:false, pre:["KalÃ§a Akt."], i:[...muscleDB.legs.i,...muscleDB.shoulders.i]},
        panic:{t:"Ev Modu", s:"Home", j:false, pre:["Jacks"], i:[
            {n:"50 ÅÄ±nav",v:"push",d:"Nizami formda, bÃ¶lerek yap."},
            {n:"50 Squat",v:"legs",d:"Derin squat, topuk yerde."}
        ]}
    };

    const offSeasonSchedule = JSON.parse(JSON.stringify(seasonSchedule));
    offSeasonSchedule[3] = {
        t:"CANAVAR MODU", s:"Off-Season", j:true, pre:["Dinamik IsÄ±nma"], i:[
            {n:"Deadlift",v:"legs",d:"AÄŸÄ±r ama kontrollÃ¼."},
            {n:"Heavy Rows",v:"pull",d:"SÄ±rt kalÄ±nlÄ±ÄŸÄ±na odaklan."},
            {n:"HIIT",v:"cardio",d:"KÄ±sa ama sert interval."}
        ]
    };

    const getK = d => d.toLocaleDateString('fr-CA'); // YYYY-MM-DD

    let today = new Date();
    let data, stats, settings;
    let timerInt = null, timerSec = 0;
    let breathInt = null;

    function init(){
        try{
            data = JSON.parse(localStorage.getItem('primeDataV21')) || {};
            stats = JSON.parse(localStorage.getItem('primeStatsV21')) || {
                xp:0,
                height:0,
                challenge:{target:1000,current:0,title:"1000 ÅÄ±nav"},
                streak:0,
                lastLogin:"",
                max:{},
                games:[],
                heat:{},
                history:{},
                pain:[],
                weekSummary:{}
            };
            settings = JSON.parse(localStorage.getItem('primeSettingsV21')) || {sound:false,inSeason:true};

            const k = getK(today);
            if(!data[k]) data[k] = {c:[],s:{},w:{},rpe:{},n:"",wt:0,bw:0,nutri:{cal:0,pro:0,log:[],supps:[],timing:[]},panic:false,readiness:0,mental:{focus:3,confidence:3},pride:"",steps:0};
            if(!stats.heat) stats.heat = {chest:0,back:0,legs:0,shoulders:0,arms:0,core:0};
            if(!stats.weekSummary) stats.weekSummary = {};

            document.getElementById('dailyQuote').innerHTML = `"${quotes[today.getDate() % quotes.length]}"`;
            if(data[k].readiness === 0) openModal('readinessModal');

            document.getElementById('seasonToggle').checked = settings.inSeason;
            document.getElementById('soundToggle').checked = settings.sound;
            document.getElementById('userHeight').value = stats.height || "";

            updateChallengeUI();
            renderFoodList();
            computeWeeklyStats();
            render();
            renderXP();
            renderHeatmap();
            renderGameHistory();
            renderPainMap();
        }catch(e){
            alert("Veri hatasÄ± algÄ±landÄ±. Uygulama sÄ±fÄ±rlanÄ±yor...");
            localStorage.clear();
            location.reload();
        }
    }

    function save(){ localStorage.setItem('primeDataV21', JSON.stringify(data)); }
    function saveStats(){
        stats.height = document.getElementById('userHeight').value || stats.height || 0;
        localStorage.setItem('primeStatsV21', JSON.stringify(stats));
    }

    function saveData(){
        const k = getK(today);
        const dd = data[k] || (data[k] = {});
        dd.n = document.getElementById('journal').value || "";
        dd.bw = document.getElementById('dailyWeight').value || dd.bw || "";
        dd.pride = document.getElementById('journalPride').value || "";
        dd.steps = parseInt(document.getElementById('steps').value) || 0;
        dd.sleepHours = parseFloat(document.getElementById('sleepHours').value) || dd.sleepHours || 0;
        dd.sleepQuality = parseInt(document.getElementById('sleepQuality').value) || dd.sleepQuality || 0;
        save();
    }

    function getProgramForDate(d, dd){
        const idx = d.getDay();
        const base = settings.inSeason ? seasonSchedule[idx] : offSeasonSchedule[idx];
        if(dd.panic) return seasonSchedule.panic;
        if(dd.custom) return dd.custom;
        return base;
    }

    function computeDailyVolume(dKey, dObj, prog){
        if(!dObj || !prog || !prog.i) return 0;
        let vol = 0;
        prog.i.forEach((it,i)=>{
            const kg = parseInt(dObj.w && dObj.w[i] || 0);
            const sets = parseInt(dObj.s && dObj.s[i] || 3);
            if(kg > 0 && sets > 0) vol += kg * sets;
        });
        return vol;
    }

    function computeWeeklyStats(){
        const summary = {avgVolume:0,jumpDays:0,avgSleep:0};
        let totalVol = 0, volCount = 0;
        let jumpDays = 0;
        let sleepSum = 0, sleepCount = 0;

        for(let i=0;i<7;i++){
            const d = new Date(today);
            d.setDate(today.getDate() - i);
            const k = getK(d);
            const dd = data[k];
            if(!dd) continue;
            const p = getProgramForDate(d, dd);
            const v = computeDailyVolume(k, dd, p);
            if(v > 0){ totalVol += v; volCount++; }
            if(p.j) jumpDays++;
            if(dd.sleepHours){
                sleepSum += dd.sleepHours;
                sleepCount++;
            }
        }

        summary.avgVolume = volCount ? Math.round(totalVol / volCount) : 0;
        summary.jumpDays = jumpDays;
        summary.avgSleep = sleepCount ? (sleepSum / sleepCount) : 0;
        stats.weekSummary = summary;
        saveStats();
    }

    function render(){
        const k = getK(today);
        const dd = data[k];
        const p = dd.panic ? seasonSchedule.panic : (dd.custom || (settings.inSeason ? seasonSchedule[today.getDay()] : offSeasonSchedule[today.getDay()]));

        document.getElementById('dateDisplay').innerText = today.toLocaleDateString('tr-TR', {weekday:'long', day:'numeric'});
        document.getElementById('progTitle').innerText = p.t;
        document.getElementById('progSub').innerText = p.s;
        document.getElementById('seasonBadge').innerText = settings.inSeason ? "SEZON Ä°Ã‡Ä°" : "OFF-SEASON";

        const readinessMap = ["?","ğŸ˜« Ã‡ok Yorgun","ğŸ¥± DÃ¼ÅŸÃ¼k","ğŸ˜ Orta","ğŸ™‚ Ä°yi","ğŸ”¥ Ã‡ok Ä°yi"];
        document.getElementById('readinessBadge').innerText = "Enerji: " + (readinessMap[dd.readiness] || "?");

        const mental = dd.mental || {focus:3,confidence:3};
        document.getElementById('focusLabel').innerText = mental.focus;
        document.getElementById('confLabel').innerText = mental.confidence;
        const fIn = document.getElementById('focusInput');
        const cIn = document.getElementById('confInput');
        if(fIn) fIn.value = mental.focus;
        if(cIn) cIn.value = mental.confidence;

        const weekly = stats.weekSummary || {};
        let recText = "Recovery: Veri az";
        if(weekly.avgVolume || weekly.avgSleep){
            if(weekly.avgVolume > 12000 && weekly.avgSleep < 6) recText = "Recovery: KÄ±rmÄ±zÄ± (YÃ¼k yÃ¼ksek + uyku dÃ¼ÅŸÃ¼k)";
            else if(weekly.avgVolume > 9000 || weekly.jumpDays >= 3) recText = "Recovery: SarÄ± (YÃ¼k yÃ¼ksek, dikkat)";
            else recText = "Recovery: YeÅŸil (Dengelisin)";
        }
        document.getElementById('recoveryBadge').innerText = recText;

        const phList = document.getElementById('prehabList');
        phList.innerHTML = "";
        if(p.pre){
            p.pre.forEach(item=>{
                const meta = warmupDB[item] || {d:"HazÄ±rlÄ±k."};
                phList.innerHTML += `
                <div class="prehab-item">
                    <div>
                        <div style="font-weight:600">${item}</div>
                        <span class="prehab-desc">${meta.d}</span>
                    </div>
                    <a href="https://www.youtube.com/results?search_query=${encodeURIComponent(item + " exercise")}" target="_blank" class="yt-btn">â–¶</a>
                </div>`;
            });
        }

        // Pain bazlÄ± ekstra prehab
        if(stats.pain && stats.pain.length){
            stats.pain.forEach(key=>{
                (painPrehab[key] || []).forEach(extra=>{
                    phList.innerHTML += `
                    <div class="prehab-item">
                        <div>
                            <div style="font-weight:600">${extra.n}</div>
                            <span class="prehab-desc">${extra.d}</span>
                        </div>
                        <a href="https://www.youtube.com/results?search_query=${encodeURIComponent(extra.y)}" target="_blank" class="yt-btn">â–¶</a>
                    </div>`;
                });
            });
        }

        const mentalCard = document.getElementById('mentalCard');
        if(p.t.includes("MaÃ§") || p.s.toLowerCase().includes("game")){
            mentalCard.style.display = "block";
        }else{
            mentalCard.style.display = "none";
        }

        const list = document.getElementById('workoutList');
        list.innerHTML = "";
        let vol = 0;

        p.i.forEach((it,i)=>{
            const chk = dd.c.includes(i);
            const kg = parseInt(dd.w[i] || 0);
            const sets = parseInt(dd.s[i] || 3);
            if(chk && kg > 0 && sets > 0) vol += kg * sets;

            const name = it.n.split('(')[0].trim();
            const isPR = kg > (stats.max[name] || 0) && kg > 0;
            list.innerHTML += `
            <div class="task-item ${chk?'checked':''}" id="task-${i}">
                <div class="task-top">
                    <div class="task-visual" onclick="toggleGuide(${i})">${visuals[it.v] || visuals.push}</div>
                    <div class="check-group" onclick="toggle(${i},'${it.isGame?'game':''}',${p.i.length})">
                        <div style="flex:1"><span class="task-name">${name}</span></div>
                        <div class="circle-check"></div>
                    </div>
                    <a href="https://www.youtube.com/results?search_query=${encodeURIComponent(name + ' nasÄ±l yapÄ±lÄ±r')}" target="_blank" class="yt-btn">â–¶</a>
                </div>
                <div class="guide-text">ğŸ’¡ ${it.d || "KontrollÃ¼ Ã§alÄ±ÅŸ."}</div>
                ${it.v!=='rest' && it.v!=='pilates' && it.v!=='cardio' ? `
                <div class="input-row">
                    <input class="mini-input" type="number" min="0" placeholder="Set" value="${dd.s[i] || ''}" onchange="saveS(${i},this.value)">
                    <input class="mini-input ${isPR?'pr-active':''}" type="number" min="0" placeholder="Kg" value="${dd.w[i] || ''}" onchange="saveW('${name}',${i},this.value,${dd.s[i] || 3})">
                    <button class="tool-btn" onclick="openCalc(${kg || 0})">ğŸ§®</button>
                    <button class="tool-btn" onclick="openHist('${name}')">ğŸ“œ</button>
                </div>` : ''}
            </div>`;
        });

        document.getElementById('totalVolume').innerText = vol + " kg";
        document.getElementById('progPercent').innerText = "%" + (p.i.length ? Math.round((dd.c.length / p.i.length) * 100) : 0);

        // Alert mantÄ±ÄŸÄ±
        document.getElementById('deloadAlert').style.display = "none";
        document.getElementById('lowEnergyAlert').style.display = "none";
        document.getElementById('highEnergyAlert').style.display = "none";

        if(weekly.avgVolume && (weekly.avgVolume > 12000 || weekly.jumpDays >= 3 || (weekly.avgSleep && weekly.avgSleep < 6 && weekly.avgVolume > 8000))){
            document.getElementById('deloadAlert').style.display = "flex";
        }
        if(dd.readiness && dd.readiness <= 2){
            document.getElementById('lowEnergyAlert').style.display = "flex";
        }else if(dd.readiness >= 4){
            document.getElementById('highEnergyAlert').style.display = "flex";
        }

        updateTrackers(dd);
    }

    function toggle(i,s,t){
        const k = getK(today);
        const a = data[k].c;
        if(a.includes(i)){
            a.splice(a.indexOf(i),1);
            addXP(-10);
        }else{
            a.push(i);
            startTimer();
            addXP(10);
            updateHeatmap(i);
            if(s === 'game') openModal('gameLogModal');
            if(a.length === t) checkClutch();
        }
        save();
        render();
    }

    function checkClutch(){
        if(Math.random() < 0.3){
            document.getElementById('clutchTaskDisplay').innerText = clutchTasks[Math.floor(Math.random()*clutchTasks.length)];
            openModal('clutchModal');
        }else{
            showWrapUp();
        }
    }

    function completeClutch(){
        addXP(100);
        closeModal('clutchModal');
        showWrapUp();
    }

    function showWrapUp(){
        const k = getK(today);
        const dt = data[k];
        let vol = 0;
        if(dt && dt.w){
            Object.values(dt.w).forEach(v => vol += parseInt(v || 0));
        }
        document.getElementById('wrapVol').innerText = vol;
        document.getElementById('wrapXP').innerText = "+" + (dt.c.length * 10);
        openModal('wrapUpModal');
        fireConfetti();
    }

    function addJumpToToday(){
        const k = getK(today);
        const idx = today.getDay();
        const dd = data[k];
        let cur = dd.custom ? dd.custom : (settings.inSeason ? seasonSchedule[idx] : offSeasonSchedule[idx]);
        if(cur.i.find(x=>x.n === jumpR[0].n)){
            alert("Zaten zÄ±plama eklenmiÅŸ!");
            return;
        }
        data[k].custom = {
            t: cur.t + " + Jump",
            s: cur.s,
            j: true,
            pre: cur.pre,
            i: [...cur.i, ...jumpR]
        };
        save();
        render();
        alert("ZÄ±plama eklendi!");
    }

    function saveW(n,i,v,s){
        const k = getK(today);
        if(!data[k].w) data[k].w = {};
        data[k].w[i] = v;
        const val = parseFloat(v || 0);
        if(val > (stats.max[n] || 0)){
            stats.max[n] = val;
            alert("REKOR! ğŸ†");
        }
        stats.history[n] = {w:val,s:s,d:k};
        save();
        saveStats();
        render();
    }

    function saveS(i,v){
        const k = getK(today);
        if(!data[k].s) data[k].s = {};
        data[k].s[i] = v;
        save();
    }

    function addXP(x){
        stats.xp = Math.max(0, (stats.xp || 0) + x);
        saveStats();
        renderXP();
    }

    function renderXP(){
        document.getElementById('xpBar').style.width = ((stats.xp % 1000) / 10) + "%";
        document.getElementById('xpText').innerText = stats.xp + " XP";
        document.getElementById('currentLvl').innerText = "Lvl " + Math.floor(stats.xp / 1000 + 1);
    }

    function updateTrackers(dd){
        document.getElementById('waterCount').innerText = (dd.wt || 0) + " lt";
        document.getElementById('journal').value = dd.n || "";
        document.getElementById('journalPride').value = dd.pride || "";
        document.getElementById('dailyWeight').value = dd.bw || "";
        document.getElementById('steps').value = dd.steps || "";
        document.getElementById('sleepHours').value = dd.sleepHours || "";
        document.getElementById('sleepQuality').value = dd.sleepQuality || "";

        const cal = dd.nutri?.cal || 0;
        const pro = dd.nutri?.pro || 0;
        document.getElementById('calStatus').innerText = cal + " kcal";
        document.getElementById('proStatus').innerText = pro + "g";

        const tCal = 2500;
        const tPro = 160;
        document.getElementById('targetCalDisplay').innerText = tCal;
        document.getElementById('calText').innerText = `${cal} / ${tCal}`;
        document.getElementById('proText').innerText = `${pro} / ${tPro}g`;
        document.getElementById('calBar').style.width = Math.min((cal / tCal) * 100, 100) + "%";
        document.getElementById('proBar').style.width = Math.min((pro / tPro) * 100, 100) + "%";

        const l = document.getElementById('foodLog');
        l.innerHTML = "";
        if(dd.nutri?.log){
            dd.nutri.log.forEach(f=>{
                l.innerHTML += `<div>â€¢ ${f.n} (${f.c}kcal, ${f.p}g)</div>`;
            });
        }

        if((seasonSchedule[today.getDay()] || {}).j){
            document.getElementById('nutrientTimingBox').style.display = 'block';
        }else{
            document.getElementById('nutrientTimingBox').style.display = 'none';
        }

        document.querySelectorAll('.supp-icon').forEach(el=>el.classList.remove('active'));
        if(dd.nutri?.supps) dd.nutri.supps.forEach(s => document.getElementById('supp-'+s)?.classList.add('active'));

        document.querySelectorAll('.timing-item').forEach(el=>el.classList.remove('timing-active'));
        if(dd.nutri?.timing) dd.nutri.timing.forEach(t => document.getElementById('time-'+t)?.classList.add('timing-active'));
    }

    function renderFoodList(){
        const g = document.getElementById('foodGrid');
        g.innerHTML = "";
        foodDB.forEach((f,i)=>{
            g.innerHTML += `<div class="food-item" onclick="addFood(${i})"><b>${f.n}</b><small>${f.c}kcal / ${f.p}g</small></div>`;
        });
    }

    function addFood(i){
        const f = foodDB[i];
        const k = getK(today);
        if(!data[k].nutri) data[k].nutri = {cal:0,pro:0,log:[],supps:[],timing:[]};
        data[k].nutri.cal += f.c;
        data[k].nutri.pro += f.p;
        if(!data[k].nutri.log) data[k].nutri.log = [];
        data[k].nutri.log.push(f);
        save();
        render();
    }

    function addQuickMacros(){
        const c = parseInt(document.getElementById('quickCal').value) || 0;
        const p = parseInt(document.getElementById('quickPro').value) || 0;
        if(c > 0 || p > 0){
            const k = getK(today);
            if(!data[k].nutri) data[k].nutri = {cal:0,pro:0,log:[],supps:[],timing:[]};
            data[k].nutri.cal += c;
            data[k].nutri.pro += p;
            if(!data[k].nutri.log) data[k].nutri.log = [];
            data[k].nutri.log.push({n:"HÄ±zlÄ± Ekleme",c:c,p:p});
            document.getElementById('quickCal').value = "";
            document.getElementById('quickPro').value = "";
            save();
            render();
        }
    }

    function clearNutrition(){
        if(confirm("Beslenme kaydÄ± silinsin mi?")){
            const k = getK(today);
            const supp = data[k].nutri?.supps || [];
            const timing = data[k].nutri?.timing || [];
            data[k].nutri = {cal:0,pro:0,log:[],supps:supp,timing:timing};
            save();
            render();
        }
    }

    function renderHeatmap(){
        const c = {low:'#333',med:'#ffd60a',high:'#ff453a'};
        const setFill = (id,val)=>{
            const el = document.getElementById(id);
            if(!el) return;
            if(val > 20) el.style.fill = c.high;
            else if(val > 5) el.style.fill = c.med;
            else el.style.fill = c.low;
        };
        setFill('svg-chest',stats.heat.chest || 0);
        setFill('svg-shoulders',stats.heat.shoulders || 0);
        setFill('svg-arms',stats.heat.arms || 0);
        setFill('svg-legs',stats.heat.legs || 0);
        setFill('svg-core',stats.heat.core || 0);
    }

    function updateHeatmap(i){
        const k = getK(today);
        const dd = data[k];
        const p = dd.custom || (settings.inSeason ? seasonSchedule[today.getDay()] : offSeasonSchedule[today.getDay()]);
        const mv = p.i[i];
        let key = mv.mb || "core";
        if(!stats.heat[key]) stats.heat[key] = 0;
        stats.heat[key] += 1;
        saveStats();
        renderHeatmap();
    }

    function renderGameHistory(){
        const d = document.getElementById('gameHistory');
        const gi = document.getElementById('gameInsights');
        d.innerHTML = "";
        gi.innerHTML = "";

        if(!stats.games || stats.games.length === 0){
            d.innerHTML = `<div style="font-size:.8rem; color:#777;">HenÃ¼z kayÄ±t yok.</div>`;
            return;
        }

        const last = stats.games.slice(-5).reverse();
        let sPts=0,sAst=0,sReb=0,sStl=0,w=0,l=0;
        last.forEach(g=>{
            sPts += g.pts || 0;
            sAst += g.ast || 0;
            sReb += g.reb || 0;
            sStl += g.stl || 0;
            if(g.res === 'W') w++; else if(g.res === 'L') l++;
            d.innerHTML += `<div style="background:#111; padding:10px; border-radius:8px; margin-bottom:5px; border:1px solid #333; font-size:.8rem;">
                ${g.date} - ${g.res || '-'} â€¢ ${g.pts || 0} SayÄ± / ${g.ast || 0} Ast / ${g.reb || 0} Rib / ${g.stl || 0} TÃ‡
            </div>`;
        });

        const n = last.length;
        const aPts = (sPts/n).toFixed(1);
        const aAst = (sAst/n).toFixed(1);
        const aReb = (sReb/n).toFixed(1);
        const aStl = (sStl/n).toFixed(1);

        let role = "Dengeli oyuncu";
        if(aPts >= 15 && aAst < 3) role = "Skorer Guard";
        else if(aAst >= 5 && aPts < 20) role = "Oyun Kurucu (Playmaker)";
        else if(aReb >= 8) role = "Ribaund OdaklÄ± Forvet";
        else if(aStl >= 2) role = "Savunma CanavarÄ± (3&D)";

        gi.innerHTML = `Son ${n} maÃ§ ortalaman: ${aPts} sayÄ±, ${aAst} asist, ${aReb} rib, ${aStl} top Ã§alma. Skor: ${w}W / ${l}L. Profilin: <b>${role}</b>.`;
    }

    function openModal(id){ document.getElementById(id).classList.add('open'); }
    function closeModal(id){ document.getElementById(id).classList.remove('open'); }

    function switchToolTab(t, el){
        document.querySelectorAll('.tool-content').forEach(e=>e.style.display='none');
        document.getElementById('tool-'+t).style.display = 'block';
        document.querySelectorAll('.n-tab').forEach(e=>e.classList.remove('active'));
        if(el) el.classList.add('active');
    }

    function toggleGuide(i){
        document.getElementById(`task-${i}`).classList.toggle('show-guide');
    }

    function startTimer(){
        const el = document.getElementById('timerFloat');
        el.classList.add('active');
        if(timerInt) clearInterval(timerInt);
        timerSec = 90;
        updT();
        timerInt = setInterval(()=>{
            timerSec--;
            updT();
            if(timerSec <= 0){
                stopTimer();
                notify();
            }
        },1000);
    }

    function addTimer(sec){
        timerSec += sec;
        updT();
    }

    function stopTimer(){
        if(timerInt) clearInterval(timerInt);
        document.getElementById('timerFloat').classList.remove('active');
    }

    function updT(){
        const m = Math.floor(timerSec/60);
        const s = timerSec % 60;
        document.getElementById('timerDisplay').innerText = `0${m}:${s<10?'0'+s:s}`;
    }

    function notify(){
        if(settings.sound && 'speechSynthesis' in window){
            const u = new SpeechSynthesisUtterance("SÃ¼re doldu!");
            u.lang = 'tr-TR';
            window.speechSynthesis.speak(u);
        }else if('vibrate' in navigator){
            navigator.vibrate([200,100,200]);
        }
    }

    function addWater(){
        const k = getK(today);
        if(!data[k].wt) data[k].wt = 0;
        data[k].wt += 0.5;
        save();
        render();
    }

    function setReadiness(v){
        const k = getK(today);
        const dd = data[k];
        dd.readiness = v;
        const f = parseInt(document.getElementById('focusInput').value) || 3;
        const c = parseInt(document.getElementById('confInput').value) || 3;
        dd.mental = {focus:f,confidence:c};
        save();
        closeModal('readinessModal');
        render();
    }

    function updateFocusLabel(v){
        document.getElementById('focusLabel').innerText = v;
    }

    function updateConfLabel(v){
        document.getElementById('confLabel').innerText = v;
    }

    function togglePanic(){
        const k = getK(today);
        data[k].panic = !data[k].panic;
        save();
        render();
    }

    function changeDate(d){
        today.setDate(today.getDate() + d);
        init();
    }

    function toggleSupp(s){
        const k = getK(today);
        if(!data[k].nutri) data[k].nutri = {cal:0,pro:0,log:[],supps:[],timing:[]};
        if(!data[k].nutri.supps) data[k].nutri.supps = [];
        if(data[k].nutri.supps.includes(s)) data[k].nutri.supps = data[k].nutri.supps.filter(x=>x!==s);
        else data[k].nutri.supps.push(s);
        save();
        render();
    }

    function toggleTiming(t){
        const k = getK(today);
        if(!data[k].nutri) data[k].nutri = {cal:0,pro:0,log:[],supps:[],timing:[]};
        if(!data[k].nutri.timing) data[k].nutri.timing = [];
        if(data[k].nutri.timing.includes(t)) data[k].nutri.timing = data[k].nutri.timing.filter(x=>x!==t);
        else data[k].nutri.timing.push(t);
        save();
        render();
    }

    function calc1RM(){
        const w = parseFloat(document.getElementById('rmWeight').value);
        const r = parseFloat(document.getElementById('rmReps').value);
        if(w && r) document.getElementById('rmResult').innerText = Math.round(w * (1 + r/30)) + " kg";
    }

    function openCalc(kg){
        document.getElementById('plateTarget').value = kg || "";
        calcPlates();
        openModal('plateModal');
    }

    function calcPlates(){
        const t = parseFloat(document.getElementById('plateTarget').value);
        const vis = document.getElementById('plateVisual');
        vis.innerHTML = '';
        if(!t || t <= 20) return;
        let w = (t - 20) / 2;
        [25,20,15,10,5,2.5,1.25].forEach(p=>{
            while(w >= p){
                w -= p;
                const color = p>=25 ? '#ff3b30' : (p>=20 ? '#0a84ff' : (p>=10 ? '#32d74b' : '#ffd60a'));
                vis.innerHTML += `<div class="plate" style="width:${28+p}px; background:${color}">${p}</div>`;
            }
        });
    }

    function openHist(n){
        const h = stats.history[n];
        const max = stats.max[n] || 0;
        document.getElementById('histTitle').innerText = n + " GeÃ§miÅŸi";
        document.getElementById('histList').innerHTML =
            (max>0 ? `<div style="color:var(--gold); font-weight:bold; margin-bottom:10px;">ğŸ† PR: ${max} kg</div>` : "") +
            (h ? `<div>Son: ${h.w}kg x ${h.s} (${h.d})</div>` : "HenÃ¼z veri yok.");
        openModal('historyModal');
    }

    function generateMenu(){
        const r = a => a[Math.floor(Math.random()*a.length)];
        const kah = r(foodDB.filter(f=>f.n.includes('Yumurta') || f.n.includes('Yulaf')));
        const oglen = r(foodDB.filter(f=>f.n.includes('Tavuk') || f.n.includes('Ton') || f.n.includes('Hindi')));
        const aksam = r(foodDB.filter(f=>f.n.includes('Pilav') || f.n.includes('Makarna') || f.n.includes('KÃ¶fte') || f.n.includes('Mercimek')));
        const ara = r(foodDB.filter(f=>f.n.includes('Badem') || f.n.includes('Protein Bar') || f.n.includes('YoÄŸurt')));
        document.getElementById('menuResult').innerHTML = `
            <div style="background:#222; padding:15px; margin-top:15px; border-radius:12px;">
                <b>KahvaltÄ±:</b> ${kah.n}<br>
                <b>Ara Ã–ÄŸÃ¼n:</b> ${ara.n}<br>
                <b>Ã–ÄŸle:</b> ${oglen.n}<br>
                <b>AkÅŸam:</b> ${aksam.n}
            </div>`;
    }

    function togglePain(p){
        if(!stats.pain) stats.pain = [];
        if(stats.pain.includes(p)) stats.pain = stats.pain.filter(x=>x!==p);
        else stats.pain.push(p);
        saveStats();
        renderPainMap();
        render();
    }

    function renderPainMap(){
        document.querySelectorAll('.pain-part').forEach(el=>el.classList.remove('active'));
        if(stats.pain) stats.pain.forEach(p=>{
            const el = document.querySelector(`.pain-part[onclick="togglePain('${p}')"]`);
            if(el) el.classList.add('active');
        });

        const pa = document.getElementById('painAdvice');
        if(!stats.pain || stats.pain.length === 0){
            pa.innerHTML = "";
            return;
        }

        let txt = "SeÃ§ili bÃ¶lgelerde hassasiyet var. BugÃ¼n bu bÃ¶lgeler iÃ§in yÃ¼kÃ¼ akÄ±llÄ±ca yÃ¶net.";
        if(stats.pain.includes('diz')) txt += "<br>- Diz iÃ§in zÄ±plama ve derin squat hacmini azalt, prehab setlerini aksatma.";
        if(stats.pain.includes('bel')) txt += "<br>- Bel iÃ§in Ã§ekiÅŸ ve squatlarda formu mÃ¼kemmel tut, core stabilitesine Ã¶ncelik ver.";
        if(stats.pain.includes('omuz')) txt += "<br>- Omuz iÃ§in overhead yÃ¼kleri hafiflet, rotator cuff Ä±sÄ±nmalarÄ±nÄ± artÄ±r.";
        txt += "<br><br><i>AÄŸrÄ± birkaÃ§ gÃ¼nden uzun sÃ¼rerse veya ÅŸiddetlenirse mutlaka doktora / fizyoterapiste gÃ¶rÃ¼n.</i>";

        pa.innerHTML = txt;
    }

    function toggleSeason(){
        settings.inSeason = document.getElementById('seasonToggle').checked;
        localStorage.setItem('primeSettingsV21', JSON.stringify(settings));
        render();
    }

    function toggleSound(){
        settings.sound = document.getElementById('soundToggle').checked;
        localStorage.setItem('primeSettingsV21', JSON.stringify(settings));
    }

    function resetApp(){
        if(confirm("TÃ¼m veriler silinsin mi?")){
            localStorage.clear();
            location.reload();
        }
    }

    function startBreathing(){
        const el = document.getElementById('breathCircle');
        const txt = document.getElementById('breathText');
        let phase = 0;
        if(breathInt) clearInterval(breathInt);

        const cycle = ()=>{
            if(phase === 0){
                el.innerText = "AL";
                txt.innerText = "4 sn boyunca nefes al";
                el.style.transform = "scale(1.5)";
            }else if(phase === 1){
                el.innerText = "TUT";
                txt.innerText = "4 sn tut";
            }else if(phase === 2){
                el.innerText = "VER";
                txt.innerText = "4 sn boyunca nefes ver";
                el.style.transform = "scale(1)";
            }else if(phase === 3){
                el.innerText = "TUT";
                txt.innerText = "4 sn tut";
            }
            phase = (phase+1) % 4;
        };
        cycle();
        breathInt = setInterval(cycle,4000);
    }

    function closeZone(){
        if(breathInt) clearInterval(breathInt);
        closeModal('zoneModal');
    }

    function saveGameLog(){
        const p = parseInt(document.getElementById('gamePoints').value) || 0;
        const a = parseInt(document.getElementById('gameAssists').value) || 0;
        const r = parseInt(document.getElementById('gameRebounds').value) || 0;
        const s = parseInt(document.getElementById('gameSteals').value) || 0;
        const res = document.getElementById('gameResult').value || "W";
        const notes = document.getElementById('gameNotes').value || "";
        if(p || a || r || s || notes){
            stats.games.push({date:getK(today), pts:p, ast:a, reb:r, stl:s, res:res, notes:notes});
            saveStats();
            closeModal('gameLogModal');
            renderGameHistory();
        }
    }

    function fireConfetti(){
        const c = document.getElementById('confetti');
        const x = c.getContext('2d');
        c.width = window.innerWidth;
        c.height = window.innerHeight;
        let p = [];
        for(let i=0;i<60;i++) p.push({x:Math.random()*c.width,y:-10,v:Math.random()*5+2,c:'hsl('+Math.random()*360+',100%,50%)'});
        function l(){
            x.clearRect(0,0,c.width,c.height);
            let alive = false;
            p.forEach(o=>{
                o.y += o.v;
                if(o.y < c.height){
                    alive = true;
                    x.fillStyle = o.c;
                    x.fillRect(o.x,o.y,5,5);
                }
            });
            if(alive) requestAnimationFrame(l);
        }
        l();
    }

    function exportData(){
        const d = {data:data, stats:stats, settings:settings};
        const b = new Blob([JSON.stringify(d)], {type:'application/json'});
        const u = URL.createObjectURL(b);
        const a = document.createElement('a');
        a.href = u;
        a.download = 'prime_backup.json';
        a.click();
    }

    function importData(input){
        const f = input.files[0];
        const r = new FileReader();
        r.onload = (e)=>{
            const d = JSON.parse(e.target.result);
            localStorage.setItem('primeDataV21', JSON.stringify(d.data || {}));
            localStorage.setItem('primeStatsV21', JSON.stringify(d.stats || {}));
            localStorage.setItem('primeSettingsV21', JSON.stringify(d.settings || {}));
            location.reload();
        };
        r.readAsText(f);
    }

    function updateChallengeUI(){
        if(!stats.challenge) stats.challenge = {target:1000,current:0,title:"1000 ÅÄ±nav"};
        const ch = stats.challenge;
        const short = document.getElementById('challengeShort');
        const title = document.getElementById('challengeTitle');
        const disp = document.getElementById('challengeDisplay');
        const bar = document.getElementById('challengeBarFill');
        if(short) short.innerText = `${ch.current}/${ch.target}`;
        if(title) title.innerText = ch.title;
        if(disp) disp.innerText = `${ch.current} / ${ch.target}`;
        if(bar) bar.style.width = Math.min(ch.current/ch.target*100,100) + "%";
    }

    function addChallenge(amount){
        if(!stats.challenge) stats.challenge = {target:1000,current:0,title:"1000 ÅÄ±nav"};
        stats.challenge.current = (stats.challenge.current || 0) + amount;
        saveStats();
        updateChallengeUI();
    }

    function setChallenge(){
        const current = stats.challenge || {target:1000,title:"Ã–zel Hedef"};
        const newTarget = prompt("Yeni hedef (adet):", current.target);
        if(!newTarget) return;
        const newTitle = prompt("BaÅŸlÄ±k:", current.title);
        stats.challenge = {target:parseInt(newTarget)||current.target||1000, current:0, title:newTitle || current.title || "Ã–zel Hedef"};
        saveStats();
        updateChallengeUI();
    }

    function completeMentalRoutine(){
        const k = getK(today);
        const dd = data[k];
        if(dd.mentalDone){
            alert("BugÃ¼nÃ¼n mental rutini zaten iÅŸaretli.");
            return;
        }
        dd.mentalDone = true;
        addXP(20);
        save();
        alert("Mental rutin tamamlandÄ±. +20 XP");
    }

    function spinFinisher(){
        const type = document.querySelector('input[name="fType"]:checked')?.value || 'gym';
        const list = finishers[type] || finishers.gym;
        const item = list[Math.floor(Math.random()*list.length)];
        const res = document.getElementById('finisherResult');
        res.style.display = 'block';
        res.innerHTML = `
            <div style="font-size:1rem; font-weight:700; margin-bottom:6px;">${item.n}</div>
            <div style="font-size:.8rem; color:#ccc; margin-bottom:8px;">${item.d}</div>
            <a class="yt-btn" target="_blank" href="https://www.youtube.com/results?search_query=${encodeURIComponent(item.y)}">â–¶ YouTube</a>
        `;
    }

    function updateSec(){
        const main = document.getElementById('mainMuscle').value;
        const sub = document.getElementById('subMuscle');
        sub.innerHTML = "<option>2. BÃ¶lge</option>";
        sub.disabled = true;
        if(!main || !compat[main]) return;
        compat[main].forEach(k=>{
            sub.innerHTML += `<option value="${k}">${muscleDB[k].t}</option>`;
        });
        sub.disabled = false;
    }

    function buildProg(){
        const main = document.getElementById('mainMuscle').value;
        const sub = document.getElementById('subMuscle').value;
        const addJ = document.getElementById('addJump').checked;
        const k = getK(today);
        if(!main){
            alert("Ã–nce 1. bÃ¶lgeyi seÃ§.");
            return;
        }
        let i = [...(muscleDB[main]?.i || [])];
        let pre = ["Dinamik IsÄ±nma"];
        if(sub && muscleDB[sub]) i = i.concat(muscleDB[sub].i);
        if(addJ) i = i.concat(jumpR);
        data[k].custom = {t:muscleDB[main].t + (sub ? " + " + muscleDB[sub].t : ""), s:"KiÅŸisel", j:addJ, pre:pre, i:i};
        save();
        closeModal('builderModal');
        render();
    }

    window.onload = init;
</script>
</body>
</html>
