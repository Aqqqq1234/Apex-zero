<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>APEX ZERO</title>
<link rel="apple-touch-icon" href="https://img.icons8.com/ios-filled/192/000000/triangle.png">
<style>
    /* --- APEX ZERO DESIGN SYSTEM (2024) --- */
    :root { 
        --bg: #000000; 
        --card: #1C1C1E; /* Darker, modern iOS card background */
        --card-border: #2C2C2E;
        --primary: #0A84FF; /* iOS Blue */
        --accent: #FF9F0A; /* Orange for energy/warning */
        --success: #30D158; /* iOS Green */
        --danger: #FF453A; /* iOS Red */
        --text: #FFFFFF;
        --dim-text: #8E8E93; /* Lighter grey for secondary text */
        
        --safe-top: env(safe-area-inset-top); 
        --safe-bottom: env(safe-area-inset-bottom);
    }
    body { 
        background: var(--bg); 
        color: var(--text); 
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
        margin: 0; padding: 0; 
        height: 100vh; 
        display: flex; flex-direction: column; 
        overflow: hidden;
        -webkit-tap-highlight-color: transparent; 
        user-select: none;
        font-size: 16px;
        line-height: 1.4;
    }

    /* --- GLOBAL TYPOGRAPHY & HEADERS --- */
    h1 { font-size: 28px; font-weight: 700; letter-spacing: -0.5px; margin: 0 0 5px 0; }
    h2 { font-size: 20px; font-weight: 600; margin: 0 0 10px 0; }
    h3 { font-size: 17px; font-weight: 600; margin: 0 0 8px 0; }
    p { margin: 0 0 10px 0; }

    /* --- NAVIGATION (TAB BAR) --- */
    .tab-bar {
        position: fixed; bottom: 0; width: 100%; height: 85px;
        background: rgba(28,28,30,0.9); /* Slightly transparent background */
        border-top: 0.5px solid rgba(72,72,74,0.7); /* Subtle border */
        display: flex; justify-content: space-around; padding-top: 10px; 
        z-index: 1000;
        backdrop-filter: blur(20px); /* iOS blur effect */
        -webkit-backdrop-filter: blur(20px);
        padding-bottom: var(--safe-bottom);
    }
    .tab-btn { 
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        gap: 4px; 
        color: var(--dim-text); 
        font-size: 10px; font-weight: 500; 
        cursor: pointer; 
        transition: color 0.2s ease-out; 
    }
    .tab-btn.active { color: var(--primary); }
    .tab-icon { font-size: 24px; transition: transform 0.2s ease-out; }
    .tab-btn.active .tab-icon { transform: translateY(-2px); } /* Slight lift on active */

    /* --- SCREENS --- */
    .screen { 
        flex: 1; 
        overflow-y: auto; 
        padding: 20px; 
        padding-top: calc(var(--safe-top) + 15px); 
        padding-bottom: calc(85px + var(--safe-bottom)); 
        display: none; 
        animation: fadeIn 0.2s ease-out; 
    }
    .screen.active { display: block; }
    @keyframes fadeIn { from {opacity:0; transform: translateY(5px);} to {opacity:1; transform: translateY(0);} }

    /* --- CALENDAR (GRID) --- */
    .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .month-title { font-size: 22px; font-weight: 700; letter-spacing: -0.5px; }
    .cal-nav-btn { 
        background: var(--card-border); 
        border: none; 
        color: var(--text); 
        width: 38px; height: 38px; 
        border-radius: 10px; 
        cursor: pointer; 
        display: flex; align-items: center; justify-content: center; 
        font-size: 20px; 
        transition: background 0.2s ease-out;
    }
    .cal-nav-btn:active { background: #48484A; }

    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-bottom: 25px; }
    .cal-day-head { text-align: center; font-size: 11px; color: var(--dim-text); font-weight: 600; text-transform: uppercase; margin-bottom: 5px; }
    .cal-day { 
        aspect-ratio: 1/1; 
        background: var(--card); 
        border-radius: 12px; 
        border: 1px solid var(--card-border);
        display: flex; flex-direction: column; align-items: center; justify-content: center; 
        cursor: pointer; 
        position: relative;
        transition: all 0.2s ease-out;
    }
    .cal-day.empty { background: transparent; border: none; cursor: default; }
    .cal-day.today { border-color: var(--primary); background: rgba(10,132,255,0.15); }
    .cal-day.selected { 
        background: var(--primary); 
        border-color: var(--primary); 
        color: white; 
        box-shadow: 0 5px 15px rgba(10,132,255,0.3); 
        transform: translateY(-2px); /* Pop effect */
    }
    .cal-day.has-workout::after { 
        content: ''; 
        width: 6px; height: 6px; 
        background: var(--success); 
        border-radius: 50%; 
        position: absolute; 
        bottom: 8px; right: 8px; /* More modern dot position */
    }
    .cd-num { font-size: 16px; font-weight: 600; }
    .cal-day.selected .cd-num, .cal-day.selected .cd-day-name { color: white !important; }

    /* --- DASHBOARD CARDS --- */
    .day-detail-card { 
        background: var(--card); 
        border: 1px solid var(--card-border); 
        border-radius: 18px; 
        padding: 20px; 
        margin-top: 15px; 
        box-shadow: 0 4px 15px rgba(0,0,0,0.2); /* Soft shadow */
    }
    .dd-tag { 
        font-size: 11px; font-weight: 700; 
        background: rgba(72,72,74,0.5); /* Subtle background for tags */
        color: var(--dim-text); 
        padding: 6px 10px; 
        border-radius: 6px; 
        text-transform: uppercase; 
        display: inline-block; 
        margin-bottom: 10px; 
    }
    .dd-title { font-size: 24px; font-weight: 700; margin-bottom: 8px; }
    .dd-desc { font-size: 15px; color: var(--dim-text); margin-bottom: 15px; }
    
    .smart-tip { 
        margin-top: 20px; 
        padding: 12px; 
        background: rgba(255,159,10,0.15); /* Accent color background */
        border-left: 4px solid var(--accent); 
        border-radius: 10px; 
        font-size: 14px; 
        color: var(--accent); 
        display: flex; align-items: flex-start; gap: 10px;
    }
    .tip-icon { font-size: 18px; line-height: 1; }
    .tip-text { flex: 1; }

    .action-row { display: flex; gap: 12px; margin-top: 25px; }
    .btn-primary { 
        flex: 2; 
        background: var(--primary); 
        color: white; 
        border: none; 
        padding: 16px; 
        border-radius: 12px; 
        font-weight: 600; 
        font-size: 17px; 
        cursor: pointer; 
        transition: background 0.2s ease-out, transform 0.1s ease-out;
    }
    .btn-primary:active { transform: scale(0.98); }
    .btn-outline { 
        flex: 1; 
        background: transparent; 
        border: 1px solid var(--card-border); 
        color: var(--dim-text); 
        padding: 16px; 
        border-radius: 12px; 
        font-weight: 500; 
        font-size: 15px; 
        cursor: pointer; 
        transition: background 0.2s ease-out, color 0.2s ease-out, transform 0.1s ease-out;
    }
    .btn-outline:active { background: #2C2C2E; transform: scale(0.98); }

    /* --- HEATMAP --- */
    .heatmap-container { display: flex; justify-content: center; margin-top: 30px; gap: 10px; }
    .hm-part { 
        width: 80px; height: 100px; 
        background: var(--card-border); 
        border-radius: 12px; 
        display: flex; flex-direction: column; align-items: center; justify-content: center; 
        font-size: 11px; font-weight: 600; 
        color: var(--dim-text); 
        transition: all 0.4s ease-out; 
        border: 1px solid transparent; /* Default transparent border */
        overflow: hidden;
        position: relative;
    }
    .hm-part::before { /* Gradient overlay for better look */
        content: '';
        position: absolute; inset: 0;
        background: linear-gradient(to top, rgba(0,0,0,0.6) 0%, transparent 50%);
        z-index: 1;
    }
    .hm-level-bar {
        position: absolute; bottom: 0; width: 100%; 
        background: linear-gradient(to top, var(--danger), var(--warning), var(--success));
        height: 0; /* Controlled by JS */
        transition: height 0.4s ease-out;
        z-index: 0;
    }
    .hm-part span { z-index: 2; position: relative; } /* Ensure text is above gradient */
    .hm-part.low-energy { color: white; background: var(--danger); }
    .hm-part.medium-energy { color: white; background: var(--warning); }
    .hm-part.high-energy { color: black; background: var(--success); }

    /* --- VAULT (KNOWLEDGE) --- */
    .vault-search { 
        width: 100%; 
        background: var(--card); 
        border: 1px solid var(--card-border); 
        padding: 12px 15px; 
        border-radius: 12px; 
        color: var(--text); 
        font-size: 16px; 
        margin-bottom: 25px; 
        box-sizing: border-box;
    }
    .vault-search::placeholder { color: var(--dim-text); opacity: 0.7; }
    .vault-search:focus { border-color: var(--primary); outline: none; }
    
    .vault-item { 
        background: var(--card); 
        border: 1px solid var(--card-border); 
        border-radius: 16px; 
        margin-bottom: 12px; 
        overflow: hidden; 
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .vi-head { 
        padding: 18px; 
        display: flex; justify-content: space-between; align-items: center; 
        cursor: pointer; 
        transition: background 0.2s ease-out;
    }
    .vi-head:active { background: #2C2C2E; }
    .vi-title { font-weight: 600; font-size: 17px; }
    .vi-tag { 
        font-size: 11px; font-weight: 700; 
        padding: 4px 8px; 
        border-radius: 5px; 
        background: rgba(72,72,74,0.5); 
        color: var(--dim-text); 
        text-transform: uppercase;
    }
    .vi-body { 
        display: none; 
        padding: 10px 18px 18px 18px; 
        border-top: 1px solid var(--card-border); 
        font-size: 15px; 
        color: #ccc; 
        line-height: 1.6; 
    }
    .vi-body.open { 
        display: block; 
        animation: slideDown 0.3s ease-out; 
    }
    .vi-body p { margin-bottom: 10px; }
    .vi-body p:last-child { margin-bottom: 0; }
    .vi-body strong { color: var(--text); }
    .vi-body ul { padding-left: 20px; margin-top: 5px; margin-bottom: 10px; }
    .vi-body li { margin-bottom: 5px; }

    /* --- SESSION TRACKER --- */
    .session-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
    .timer-badge { 
        font-family: monospace; 
        font-size: 17px; 
        background: var(--card-border); 
        padding: 8px 12px; 
        border-radius: 8px; 
        color: var(--success); 
        font-weight: 600;
    }
    
    .ex-card { 
        background: var(--card); 
        border-radius: 16px; 
        padding: 18px; 
        margin-bottom: 15px; 
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .ex-card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
    .ex-name { font-size: 18px; font-weight: 600; }
    .btn-add-set { 
        background: transparent; border: none; 
        color: var(--primary); 
        font-size: 24px; font-weight: 300; /* Thin plus sign */
        padding: 0 5px; 
        cursor: pointer;
    }

    .ex-row { display: grid; grid-template-columns: 30px 1fr 1fr 45px; gap: 10px; align-items: center; margin-bottom: 10px; }
    .set-num { font-size: 13px; color: var(--dim-text); text-align: center; }
    .inp { 
        background: rgba(0,0,0,0.5); 
        border: 1px solid var(--card-border); 
        color: var(--text); 
        border-radius: 8px; 
        padding: 10px; 
        text-align: center; 
        width: 100%; 
        box-sizing: border-box; 
        font-size: 16px;
        -webkit-appearance: none; /* Remove default iOS styles */
    }
    .inp:focus { outline: none; border-color: var(--primary); }
    .chk { 
        width: 40px; height: 40px; 
        display: flex; align-items: center; justify-content: center; 
        background: var(--card-border); 
        border-radius: 10px; 
        cursor: pointer; 
        font-size: 20px; 
        color: var(--dim-text); 
        transition: background 0.2s ease-out, color 0.2s ease-out;
    }
    .chk.done { background: var(--success); color: var(--bg); }

    /* --- MODALS --- */
    .modal-overlay { 
        position: fixed; inset: 0; 
        background: rgba(0,0,0,0.6); 
        z-index: 2000; 
        display: none; 
        align-items: flex-end; 
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
        animation: modalFadeIn 0.2s ease-out;
    }
    @keyframes modalFadeIn { from{opacity:0;} to{opacity:1;} }

    .modal-box { 
        background: #1a1a1a; 
        width: 100%; 
        border-radius: 25px 25px 0 0; 
        padding: 25px; 
        max-height: 80vh; 
        overflow-y: auto; 
        animation: slideUp 0.3s ease-out;
    }
    @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

    .plan-opt { 
        padding: 18px; 
        background: var(--card); 
        border: 1px solid var(--card-border); 
        border-radius: 12px; 
        margin-bottom: 10px; 
        cursor: pointer; 
        display: flex; justify-content: space-between; align-items: center; 
        transition: background 0.2s ease-out;
    }
    .plan-opt:active { background: #2C2C2E; } /* Darker active state */
    .plan-opt-title { font-weight: 600; font-size: 17px; }
    .plan-opt-tag { font-size: 11px; background: rgba(72,72,74,0.5); padding: 5px 9px; border-radius: 5px; color: var(--dim-text); text-transform: uppercase; }

    .btn-flat {
        width: 100%; background: transparent; border: none;
        color: var(--primary); padding: 15px; border-radius: 12px;
        font-weight: 600; font-size: 16px; margin-top: 15px; cursor: pointer;
        transition: background 0.2s ease-out;
    }
    .btn-flat:active { background: rgba(10,132,255,0.15); }

    .hidden { display: none !important; }
</style>
</head>
<body>

    <div id="view-dash" class="screen active">
        <h1 style="margin-bottom: 25px; text-align: center;">APEX <span style="font-size:18px; color:var(--dim-text)">ZERO</span></h1>

        <div class="calendar-header">
            <button class="cal-nav-btn" onclick="changeMonth(-1)">&#x276E;</button>
            <div class="month-title" id="monthDisplay">ARALIK 2024</div>
            <button class="cal-nav-btn" onclick="changeMonth(1)">&#x276F;</button>
        </div>

        <div class="calendar-grid" id="calendarGrid">
            </div>

        <div class="day-detail-card">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div class="dd-tag" id="planTag"></div>
                <div style="font-size:13px; color:var(--dim-text); font-weight:500;" id="selectedDateText"></div>
            </div>
            <h2 class="dd-title" id="planTitle"></h2>
            <p class="dd-desc" id="planDesc"></p>
            
            <div class="smart-tip hidden" id="smartTip">
                <span class="tip-icon">ğŸ’¡</span>
                <span class="tip-text"></span>
            </div>

            <div class="action-row">
                <button class="btn-primary" onclick="startSession()">ANTRENMANA BAÅLA</button>
                <button class="btn-outline" onclick="openEditor()">PLANLA</button>
            </div>
        </div>

        <h3 style="margin-top: 35px; text-align: center; color:var(--dim-text);">ENERJÄ° SEVÄ°YELERÄ°</h3>
        <div class="heatmap-container">
            <div class="hm-part" id="hm-upper">
                <div class="hm-level-bar" id="bar-upper"></div>
                <span>ÃœST VÃœCUT</span>
            </div>
            <div class="hm-part" id="hm-core">
                <div class="hm-level-bar" id="bar-core"></div>
                <span>CORE</span>
            </div>
            <div class="hm-part" id="hm-legs">
                <div class="hm-level-bar" id="bar-legs"></div>
                <span>BACAKLAR</span>
            </div>
        </div>
    </div>

    <div id="view-session" class="screen">
        <div class="session-header">
            <h1 style="font-size:24px;">Antrenman</h1>
            <div class="timer-badge" id="sessionTimer">00:00</div>
        </div>
        <div id="sessionList"></div>
        <button class="btn-primary" style="background:var(--danger); margin-top:25px;" onclick="finishSession()">BÄ°TÄ°R VE KAYDET</button>
    </div>

    <div id="view-vault" class="screen">
        <h1 style="margin-bottom:5px;">THE VAULT</h1>
        <p style="font-size:15px; color:var(--dim-text); margin-bottom:25px;">Bio-Hacking & Uzman Protokolleri</p>
        
        <input type="text" class="vault-search" placeholder="Ara (Ã–rn: Diz, Kreatin, Uyku)..." onkeyup="renderVault(this.value)">
        
        <div id="vaultGrid">
            </div>
    </div>

    <div class="tab-bar">
        <div class="tab-btn active" onclick="nav('dash')">
            <div class="tab-icon">ğŸ“…</div>
            <div>Plan</div>
        </div>
        <div class="tab-btn" onclick="nav('session')">
            <div class="tab-icon">ğŸ‹ï¸</div>
            <div>Antrenman</div>
        </div>
        <div class="tab-btn" onclick="nav('vault')">
            <div class="tab-icon">ğŸ§ </div>
            <div>Vault</div>
        </div>
    </div>

    <div class="modal-overlay" id="editModal" onclick="if(event.target===this) closeModal()">
        <div class="modal-box">
            <h3 style="margin-top:0; margin-bottom:20px; color:white;">PLAN SEÃ‡</h3>
            <div id="templateList"></div>
            <button class="btn-flat" onclick="closeModal()">Ä°ptal</button>
        </div>
    </div>

<script>
    /* --- VERÄ°TABANI: ÅABLONLAR & BÄ°LGÄ° --- */
    const templates = {
        'gym_pzt': { name: "Gym: Maksimum GÃ¼Ã§", tag:"GYM", tip:"Set arasÄ± 3dk dinlen. ATP yenilensin. BÃ¼yÃ¼k kas gruplarÄ±na odaklan.", moves: ["Barbell Squat", "Bench Press", "Bent Over Row", "Overhead Press"], energy: [60, 40, 80] },
        'gym_cum': { name: "Gym: Hipertrofi", tag:"GYM", tip:"Her sette kasÄ± hisset. Negatifleri yavaÅŸ yap (3 saniye).", moves: ["Incline Dumbbell Press", "Lat Pulldown", "Lateral Raise", "Bicep Curl", "Tricep Pushdown"], energy: [80, 70, 50] },
        'gym_cmt': { name: "Gym: PatlayÄ±cÄ±lÄ±k", tag:"GYM", tip:"Yorgun hissedersen sÄ±Ã§ramalarÄ± yapma. HÄ±zlÄ± ve kontrollÃ¼ ol.", moves: ["Trap Bar Deadlift", "Box Jump", "Plyo Push-up"], energy: [40, 60, 90] },
        'basket': { name: "Basketbol Ä°dmanÄ±", tag:"SPORT", tip:"MaÃ§tan 4 saat Ã¶nce kompleks karbonhidrat yÃ¼klemesi yap.", moves: ["IsÄ±nma & Esneme", "Basketbol Drilleri", "MaÃ§ SimÃ¼lasyonu", "SoÄŸuma"], energy: [70, 80, 70] },
        'active': { name: "Aktif Dinlenme", tag:"RECOVERY", tip:"NabzÄ± 120'nin altÄ±nda tut, sadece kan dolaÅŸÄ±mÄ± iÃ§in.", moves: ["Hafif YÃ¼rÃ¼yÃ¼ÅŸ (45dk)", "Yoga / Esneme"], energy: [90, 90, 90] },
        'rest': { name: "Tam Dinlenme", tag:"OFF", tip:"BugÃ¼n tam dinlenme. BÃ¼yÃ¼me hormonu iÃ§in kaliteli uyku ÅŸart.", moves: [], energy: [100, 100, 100] }
    };

    const vaultContent = [
        { title: "MaÃ§ GÃ¼nÃ¼ Beslenmesi", tag: "BESLENME", body: `
            <p>MÃ¼sabaka gÃ¼nÃ¼ beslenme stratejin, performansÄ±nÄ±n anahtarÄ±dÄ±r. KanÄ± mideden Ã§ekip kaslara ve beyne pompalamak iÃ§in sindirimi kolay gÄ±dalar seÃ§melisin.</p>
            <h3>Protokol</h3>
            <ul>
                <li><strong>4 Saat Ã–nce:</strong> YaÄŸsÄ±z Tavuk GÃ¶ÄŸsÃ¼ + Yasmin PirinÃ§. (YavaÅŸ sindirilen karbonhidrat ve protein).</li>
                <li><strong>45 Dakika Ã–nce:</strong> 200mg Kafein + 1/2 Ã‡ay KaÅŸÄ±ÄŸÄ± Tuz + 400ml Su. (Odaklanma, kramp Ã¶nleme).</li>
                <li><strong>Devre ArasÄ±:</strong> Jel veya Meyve Suyu. (HÄ±zlÄ± enerji, Ã§iÄŸneme yapma).</li>
            </ul>
        `},
        { title: "Jumper's Knee (Patellar Tendinopati)", tag: "SAKATLIK", body: `
            <p>Diz kapaÄŸÄ±nÄ±n hemen altÄ±ndaki batma hissi, atlama ve sÄ±Ã§rama sporcularÄ±nda sÄ±k gÃ¶rÃ¼lÃ¼r. Tendonun aÅŸÄ±rÄ± yÃ¼klenmesiyle oluÅŸur.</p>
            <h3>Tedavi Egzersizi: Spanish Squat</h3>
            <p>Bir direnÃ§ bandÄ±nÄ± (veya havluyu) dizlerinin arkasÄ±na, bir direÄŸe baÄŸla. Geriye doÄŸru yaslanarak dizlerin 90 derece olana kadar otur. Bu izometrik bekleme, tendondaki aÄŸrÄ±yÄ± azaltÄ±r ve gÃ¼Ã§lenmesini saÄŸlar.</p>
            <ul>
                <li><strong>Dozaj:</strong> 5 Set x 45 Saniye Bekleme.</li>
                <li><strong>SÄ±klÄ±k:</strong> AÄŸrÄ± geÃ§ene kadar gÃ¼nde 1-2 kez.</li>
            </ul>
        `},
        { title: "Sirkadiyen Ritme GÃ¶re Uyku", tag: "RECOVERY", body: `
            <p>Uyku kaliteni artÄ±rarak hem fiziksel hem zihinsel toparlanmayÄ± hÄ±zlandÄ±rabilirsin. Sirkadiyen ritmini optimize etmek Ã§ok Ã¶nemlidir.</p>
            <h3>Protokol: 10-3-2-1 KuralÄ±</h3>
            <ul>
                <li><strong>10 Saat Ã–nce:</strong> Kafeini kes.</li>
                <li><strong>3 Saat Ã–nce:</strong> AÄŸÄ±r yemeÄŸi ve alkolÃ¼ kes.</li>
                <li><strong>2 Saat Ã–nce:</strong> Ä°ÅŸle ilgili zihinsel aktiviteyi bÄ±rak.</li>
                <li><strong>1 Saat Ã–nce:</strong> TÃ¼m ekranlarÄ± kapat (telefon, tablet, TV).</li>
            </ul>
            <p>Ek olarak, sabah uyandÄ±ktan sonra ilk 30 dakika iÃ§inde doÄŸal Ä±ÅŸÄ±k almak (gÃ¼neÅŸ veya parlak oda), melatonin dÃ¶ngÃ¼nÃ¼ dÃ¼zenler.</p>
        `},
        { title: "Optimal Supplement Stack", tag: "KÄ°MYA", body: `
            <p>Piyasada binlerce takviye olsa da, bilimsel olarak kanÄ±tlanmÄ±ÅŸ ve gerÃ§ek fayda saÄŸlayanlar sÄ±nÄ±rlÄ±dÄ±r. Gereksiz harcamalardan kaÃ§Ä±n.</p>
            <h3>Olmazsa Olmazlar</h3>
            <ul>
                <li><strong>Kreatin Monohidrat:</strong> GÃ¼nde 5g. (ATP depolarÄ±nÄ± artÄ±rÄ±r, gÃ¼Ã§ ve performans saÄŸlar. SaÃ§ dÃ¶kmesi efsanedir).</li>
                <li><strong>Magnezyum Bisglisinat:</strong> Gece yatmadan 400mg. (Kas gevÅŸemesi, uyku kalitesi ve sinir sistemi desteÄŸi).</li>
                <li><strong>D3 Vitamini (K2 ile):</strong> GÃ¼nde 5000 IU. (Kemik saÄŸlÄ±ÄŸÄ±, baÄŸÄ±ÅŸÄ±klÄ±k, hormonal denge).</li>
            </ul>
        `},
    ];

    // --- JAVASCRIPT: TEMEL FONKSÄ°YONLAR ---

    // GLOBAL DURUM (STATE)
    let currentMonth = new Date().getMonth();
    let currentYear = new Date().getFullYear();
    let selectedDate = new Date();
    let workouts = {}; // 'YYYY-MM-DD': templateKey
    let timerInterval;
    let startTime;
    let currentSession = null; // Aktif antrenman oturumu
    let sessionTime = 0;

    // GÃœNÃœN PLANINI ALMA
    function getPlanForDate(date) {
        const dateKey = formatDate(date);
        const templateKey = workouts[dateKey] || 'rest'; 
        return templates[templateKey];
    }

    // TARÄ°H FORMATLAMA (YYYY-MM-DD)
    function formatDate(date) {
        const y = date.getFullYear();
        const m = String(date.getMonth() + 1).padStart(2, '0');
        const d = String(date.getDate()).padStart(2, '0');
        return `${y}-${m}-${d}`;
    }

    // NAVÄ°GASYON FONKSÄ°YONU
    function nav(viewId) {
        const screens = document.querySelectorAll('.screen');
        screens.forEach(screen => screen.classList.remove('active'));
        document.getElementById('view-' + viewId).classList.add('active');

        const tabs = document.querySelectorAll('.tab-btn');
        tabs.forEach(tab => tab.classList.remove('active'));
        document.querySelector(`.tab-btn[onclick="nav('${viewId}')"]`).classList.add('active');

        if (viewId === 'dash') {
            renderCalendar(); // Takvimi her dÃ¶nÃ¼ÅŸte yeniden Ã§iz
        }
        if (viewId === 'vault') {
            renderVault(''); // Vault'u ilk aÃ§Ä±lÄ±ÅŸta yÃ¼kle
        }
    }

    // --- DASHBOARD: TAKVÄ°M VE PLAN YÃ–NETÄ°MÄ° ---

    function renderCalendar() {
        const firstDayOfMonth = new Date(currentYear, currentMonth, 1);
        const lastDayOfMonth = new Date(currentYear, currentMonth + 1, 0);
        const dayCount = lastDayOfMonth.getDate();
        const firstDayIndex = firstDayOfMonth.getDay(); // Pazar 0, Pazartesi 1...

        document.getElementById('monthDisplay').textContent = 
            firstDayOfMonth.toLocaleDateString('tr-TR', { month: 'long', year: 'numeric' }).toUpperCase();
        
        const calendarGrid = document.getElementById('calendarGrid');
        calendarGrid.innerHTML = ''; // Temizle

        // GÃ¼n baÅŸlÄ±klarÄ±nÄ± ekle (Pzt, Sal, Ã‡a...)
        const dayNames = ['Pzt', 'Sal', 'Ã‡ar', 'Per', 'Cum', 'Cmt', 'Paz'];
        dayNames.forEach(day => {
            calendarGrid.innerHTML += `<div class="cal-day-head">${day}</div>`;
        });

        // BoÅŸ gÃ¼nleri ekle (HaftanÄ±n ilk gÃ¼nÃ¼ Pzt olsun)
        let startDay = (firstDayIndex === 0 ? 6 : firstDayIndex - 1);
        for (let i = 0; i < startDay; i++) {
            calendarGrid.innerHTML += `<div class="cal-day empty"></div>`;
        }

        // GÃ¼nleri ekle
        for (let i = 1; i <= dayCount; i++) {
            const date = new Date(currentYear, currentMonth, i);
            const dateKey = formatDate(date);
            const isToday = date.toDateString() === new Date().toDateString();
            const isSelected = dateKey === formatDate(selectedDate);
            const hasWorkout = workouts[dateKey] && workouts[dateKey] !== 'rest';
            
            let classes = 'cal-day';
            if (isToday) classes += ' today';
            if (isSelected) classes += ' selected';
            if (hasWorkout) classes += ' has-workout';

            calendarGrid.innerHTML += `
                <div class="${classes}" onclick="selectDate(new Date(${currentYear}, ${currentMonth}, ${i}))">
                    <div class="cd-num">${i}</div>
                </div>
            `;
        }

        updateDayDetails();
    }

    function changeMonth(delta) {
        currentMonth += delta;
        if (currentMonth < 0) {
            currentMonth = 11;
            currentYear--;
        } else if (currentMonth > 11) {
            currentMonth = 0;
            currentYear++;
        }
        selectedDate = new Date(currentYear, currentMonth, 1); // Yeni ayÄ±n 1. gÃ¼nÃ¼nÃ¼ seÃ§
        renderCalendar();
    }

    function selectDate(date) {
        selectedDate = date;
        renderCalendar(); // Takvimi yeniden Ã§izmek, seÃ§ili gÃ¼nÃ¼ vurgulayacaktÄ±r.
    }

    function updateDayDetails() {
        const plan = getPlanForDate(selectedDate);
        const dateKey = formatDate(selectedDate);
        const dateDisplay = selectedDate.toLocaleDateString('tr-TR', { day: 'numeric', month: 'short' });

        document.getElementById('selectedDateText').textContent = dateDisplay;
        document.getElementById('planTag').textContent = plan.tag;
        document.getElementById('planTitle').textContent = plan.name;
        document.getElementById('planDesc').textContent = plan.moves.join(' / ');
        
        const smartTipEl = document.getElementById('smartTip');
        smartTipEl.classList.add('hidden'); // Her zaman gizle
        if (plan.tip) {
            smartTipEl.classList.remove('hidden');
            document.querySelector('#smartTip .tip-text').textContent = plan.tip;
        }
        
        updateHeatmap(plan.energy);
        
        // Antrenmana BaÅŸla butonu durumunu ayarla
        const startBtn = document.querySelector('.btn-primary');
        if (currentSession) {
            startBtn.textContent = 'OTURUMU DEVAM ETTÄ°R';
            startBtn.onclick = () => nav('session');
        } else if (plan.tag === 'OFF') {
            startBtn.textContent = 'DÄ°NLENMEYÄ° KAYDET';
            startBtn.onclick = () => alert('Dinlenme gÃ¼nÃ¼nÃ¼ kaydettin.');
        } else {
            startBtn.textContent = 'ANTRENMANA BAÅLA';
            startBtn.onclick = startSession;
        }
    }

    function updateHeatmap(energyLevels) { // [upper, core, legs]
        const parts = ['upper', 'core', 'legs'];
        parts.forEach((part, index) => {
            const level = energyLevels[index];
            const hmPart = document.getElementById(`hm-${part}`);
            const bar = document.getElementById(`bar-${part}`);
            
            // Bar yÃ¼ksekliÄŸi (0% - 100%)
            bar.style.height = `${level}%`;
            
            // Renk sÄ±nÄ±fÄ± (YÃ¼ksek/Orta/DÃ¼ÅŸÃ¼k enerji)
            hmPart.className = 'hm-part';
            if (level >= 80) {
                hmPart.classList.add('high-energy');
            } else if (level >= 50) {
                hmPart.classList.add('medium-energy');
            } else {
                hmPart.classList.add('low-energy');
            }
        });
    }

    // --- PLANLAMA VE MODAL ---
    function openEditor() {
        renderTemplates();
        document.getElementById('editModal').style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('editModal').style.display = 'none';
    }

    function renderTemplates() {
        const templateList = document.getElementById('templateList');
        templateList.innerHTML = '';
        
        for (const key in templates) {
            const t = templates[key];
            templateList.innerHTML += `
                <div class="plan-opt" onclick="applyTemplate('${key}')">
                    <div class="plan-opt-title">${t.name}</div>
                    <div class="plan-opt-tag">${t.tag}</div>
                </div>
            `;
        }
    }

    function applyTemplate(templateKey) {
        const dateKey = formatDate(selectedDate);
        workouts[dateKey] = templateKey;
        closeModal();
        renderCalendar(); // Takvimi ve detaylarÄ± gÃ¼ncelle
    }


    // --- ANTRENMAN OTURUMU (SESSION) ---
    function startSession() {
        const plan = getPlanForDate(selectedDate);
        if (plan.tag === 'OFF') return; // Dinlenme gÃ¼nÃ¼ ise baÅŸlatma

        currentSession = {
            date: formatDate(selectedDate),
            template: plan.name,
            exercises: plan.moves.map(move => ({ name: move, sets: [] })),
            isRunning: true,
            setsDone: 0
        };
        
        // Oturumu baÅŸlat ve sayacÄ± ayarla
        startTime = Date.now();
        sessionTime = 0;
        timerInterval = setInterval(updateTimer, 1000);
        
        renderSession();
        nav('session'); // Antrenman ekranÄ±na geÃ§
    }

    function updateTimer() {
        sessionTime = Math.floor((Date.now() - startTime) / 1000);
        const minutes = String(Math.floor(sessionTime / 60)).padStart(2, '0');
        const seconds = String(sessionTime % 60).padStart(2, '0');
        document.getElementById('sessionTimer').textContent = `${minutes}:${seconds}`;
    }

    function renderSession() {
        if (!currentSession) return;
        
        document.querySelector('#view-session h1').textContent = currentSession.template;
        
        const sessionList = document.getElementById('sessionList');
        sessionList.innerHTML = '';
        
        currentSession.exercises.forEach((ex, exIndex) => {
            let setsHtml = `<div style="display:grid; grid-template-columns: 30px 1fr 1fr 45px; gap: 10px; margin-bottom: 10px; font-weight:600; color:var(--dim-text);">
                                <div style="text-align:center;">SET</div><div>KG/LBS</div><div>TEKRAR</div><div></div>
                            </div>`;
                            
            ex.sets.forEach((set, setIndex) => {
                setsHtml += `
                    <div class="ex-row">
                        <div class="set-num">${setIndex + 1}</div>
                        <input type="number" class="inp" placeholder="AÄŸÄ±rlÄ±k" value="${set.weight || ''}" oninput="updateSet(${exIndex}, ${setIndex}, 'weight', this.value)">
                        <input type="number" class="inp" placeholder="Tekrar" value="${set.reps || ''}" oninput="updateSet(${exIndex}, ${setIndex}, 'reps', this.value)">
                        <div class="chk ${set.done ? 'done' : ''}" onclick="toggleSetDone(${exIndex}, ${setIndex})">${set.done ? 'âœ…' : ' '}</div>
                    </div>
                `;
            });
            
            setsHtml += `<button class="btn-flat" onclick="addSet(${exIndex})" style="margin-top:0; color:var(--accent); font-size:14px;">+ SET EKLE</button>`;

            sessionList.innerHTML += `
                <div class="ex-card">
                    <div class="ex-card-header">
                        <div class="ex-name">${ex.name}</div>
                    </div>
                    ${setsHtml}
                </div>
            `;
        });
    }

    function addSet(exIndex) {
        if (!currentSession) return;
        currentSession.exercises[exIndex].sets.push({ weight: '', reps: '', done: false });
        renderSession();
    }

    function updateSet(exIndex, setIndex, field, value) {
        if (!currentSession) return;
        currentSession.exercises[exIndex].sets[setIndex][field] = value;
        // Otomatik render yapmÄ±yoruz, sadece veriyi gÃ¼ncelliyoruz.
    }

    function toggleSetDone(exIndex, setIndex) {
        if (!currentSession) return;
        const set = currentSession.exercises[exIndex].sets[setIndex];
        set.done = !set.done;
        
        // Tamamlanan set sayÄ±sÄ±nÄ± gÃ¼ncelle (Basit bir Ã¶rnek)
        currentSession.setsDone = currentSession.exercises.reduce((count, ex) => 
            count + ex.sets.filter(s => s.done).length, 0);

        renderSession();
    }

    function finishSession() {
        clearInterval(timerInterval);
        alert(`Antrenman TamamlandÄ±! SÃ¼re: ${document.getElementById('sessionTimer').textContent}. Toplam Set: ${currentSession.setsDone}`);
        
        // Oturum verisini kaydetme (Åimdilik sadece konsola basÄ±yoruz)
        console.log("Kaydedilen Oturum:", currentSession);

        currentSession = null;
        document.getElementById('sessionTimer').textContent = '00:00';
        
        // Ana ekrana dÃ¶n ve durumu gÃ¼ncelle
        nav('dash'); 
        updateDayDetails(); 
    }

    // --- VAULT (BÄ°LGÄ° KAYNAÄI) ---
    function renderVault(searchText) {
        const vaultGrid = document.getElementById('vaultGrid');
        vaultGrid.innerHTML = '';
        const filteredContent = vaultContent.filter(item => 
            item.title.toLowerCase().includes(searchText.toLowerCase()) || 
            item.body.toLowerCase().includes(searchText.toLowerCase()) || 
            item.tag.toLowerCase().includes(searchText.toLowerCase())
        );

        filteredContent.forEach((item, index) => {
            vaultGrid.innerHTML += `
                <div class="vault-item">
                    <div class="vi-head" onclick="toggleVaultItem(${index})">
                        <div class="vi-title">${item.title}</div>
                        <div class="vi-tag">${item.tag}</div>
                    </div>
                    <div class="vi-body" id="vault-body-${index}">${item.body}</div>
                </div>
            `;
        });
    }

    function toggleVaultItem(index) {
        const body = document.getElementById(`vault-body-${index}`);
        body.classList.toggle('open');
    }


    // UYGULAMA BAÅLANGICI: DOM yÃ¼klendiÄŸinde Ã§alÄ±ÅŸacak ana fonksiyon
    document.addEventListener('DOMContentLoaded', () => {
        // GeÃ§erli tarihi ayarla ve takvimi Ã§iz
        const today = new Date();
        currentMonth = today.getMonth();
        currentYear = today.getFullYear();
        selectedDate = today;
        
        // BaÅŸlangÄ±Ã§ ekranÄ±nÄ± ayarla
        nav('dash'); 
    });

</script>
</body>
</html>
 
