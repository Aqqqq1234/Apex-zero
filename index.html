<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <title>PRIME v22.1 Stable</title>

    <style>
        /* --- CORE DESIGN --- */
        :root {
            --bg: #000000; 
            --card: #161618; 
            --text: #ffffff; 
            --muted: #8e8e93;
            --accent: #32d74b; /* Green */
            --blue: #0a84ff; 
            --danger: #ff453a; 
            --warn: #ff9f0a; 
            --purple: #bf5af2; 
            --gold: #ffd60a;
            --glass: rgba(22, 22, 24, 0.95); 
            --radius: 18px;
        }
        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif; 
        }
        body { 
            margin: 0; 
            background: var(--bg); 
            color: var(--text); 
            padding-top: env(safe-area-inset-top); 
            padding-bottom: 120px; 
            user-select: none; 
        }

        /* --- LAYERING (Z-INDEX FIX) --- */
        #confetti { 
            position: fixed; 
            top:0; 
            left:0; 
            pointer-events:none; 
            z-index: 0; 
        } 
        header { 
            position: sticky; 
            top: 0; 
            z-index: 100; 
            background: var(--glass); 
            backdrop-filter: blur(20px); 
            border-bottom: 1px solid #333; 
            padding: 10px 20px; 
        }
        .container { 
            position: relative; 
            z-index: 10; 
            padding: 0 16px; 
            max-width: 600px; 
            margin: 0 auto; 
        }
        .bottom-bar { 
            position: fixed; 
            bottom: 0; 
            width: 100%; 
            background: var(--glass); 
            backdrop-filter: blur(20px); 
            border-top: 0.5px solid #333; 
            display: flex; 
            justify-content: space-around; 
            padding: 12px; 
            padding-bottom: calc(15px + env(safe-area-inset-bottom)); 
            z-index: 200; 
        }
        
        /* HEADER */
        .header-top { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 10px; 
        }
        .app-title { 
            font-size: 1.4rem; 
            font-weight: 900; 
            font-style: italic; 
            letter-spacing: -1px; 
        }
        .xp-container { 
            width: 100%; 
            height: 6px; 
            background: #333; 
            border-radius: 3px; 
            overflow: hidden; 
        }
        .xp-fill { 
            height: 100%; 
            background: linear-gradient(90deg, var(--accent), var(--blue)); 
            width: 0%; 
            transition: width 0.5s ease; 
        }
        .level-badge { 
            font-size: 0.7rem; 
            color: var(--blue); 
            font-weight: bold; 
            display: flex; 
            justify-content: space-between; 
            margin-top: 4px; 
        }
        .icon-btn { 
            background: none; 
            border: none; 
            color: var(--text); 
            font-size: 1.2rem; 
            cursor: pointer; 
            opacity: 0.8; 
            position: relative; 
            z-index: 101;
        }
        .challenge-badge { 
            background: linear-gradient(90deg, #ff9f0a, #ff3b30); 
            color: #fff; 
            padding: 4px 10px; 
            border-radius: 12px; 
            font-size: 0.7rem; 
            font-weight:bold; 
            display: flex; 
            align-items: center; 
            gap: 5px; 
            box-shadow: 0 0 10px rgba(255, 159, 10, 0.3); 
            cursor: pointer; 
        }

        /* ALERTS */
        .alert-box { 
            padding: 15px; 
            border-radius: 12px; 
            margin: 15px 16px; 
            font-size: 0.9rem; 
            display: flex; 
            align-items: center; 
            gap: 15px; 
            animation: fadeIn 0.5s; 
            border: 1px solid transparent; 
            position: relative; 
            z-index: 15; 
        }
        .alert-low { 
            background: rgba(10, 132, 255, 0.15); 
            border-color: var(--blue); 
            color: var(--blue); 
        }
        .alert-high { 
            background: rgba(255, 214, 10, 0.15); 
            border-color: var(--gold); 
            color: var(--gold); 
        }
        .alert-deload { 
            background: rgba(255, 69, 58, 0.15); 
            border-color: var(--danger); 
            color: var(--danger); 
        }
        .alert-imbalance { 
            background: rgba(255, 159, 10, 0.15); 
            border-color: var(--warn); 
            color: var(--warn); 
            display:none; 
        }

        /* CARDS & BOXES */
        .card { 
            background: var(--card); 
            border-radius: var(--radius); 
            padding: 20px; 
            margin-bottom: 20px; 
            position: relative; 
            border: 1px solid #2c2c2e; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); 
        }
        .box-header { 
            font-weight: bold; 
            font-size: 0.85rem; 
            text-transform: uppercase; 
            margin-bottom: 8px; 
            display:flex; 
            align-items:center; 
            gap:8px; 
        }
        .prehab-box { 
            background: rgba(10, 132, 255, 0.1); 
            border: 1px solid rgba(10, 132, 255, 0.3); 
            padding: 15px; 
            margin-bottom: 15px; 
            border-radius: 12px; 
        }
        .prehab-item { 
            display:flex; 
            justify-content:space-between; 
            align-items:center; 
            padding: 8px 0; 
            border-bottom:1px solid rgba(10,132,255,0.2); 
            font-size:0.9rem; 
        }
        .prehab-item:last-child { border-bottom:none; }
        .prehab-desc { 
            font-size:0.75rem; 
            color: #aaa; 
            display:block; 
            margin-top:2px; 
        }
        .prehab-alt {
            font-size:0.75rem;
            color:#888;
        }

        /* TASK ITEMS */
        .task-item { 
            padding: 16px 0; 
            border-bottom: 1px solid #2a2a2a; 
            position: relative; 
        }
        .task-top { 
            display: flex; 
            align-items: center; 
            gap: 12px; 
        }
        .task-visual { 
            width: 50px; 
            height: 50px; 
            background: #252527; 
            border-radius: 10px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            flex-shrink: 0; 
            border: 1px solid #333; 
            cursor: pointer; 
        }
        .task-visual svg { 
            width: 30px; 
            height: 30px; 
            fill: #fff; 
        }
        .checked .task-visual svg { 
            fill: var(--accent); 
        }
        .check-group { 
            display: flex; 
            align-items: center; 
            gap: 12px; 
            flex: 1; 
            cursor: pointer; 
        }
        .circle-check { 
            width: 24px; 
            height: 24px; 
            border: 2px solid #444; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            flex-shrink: 0; 
            transition: 0.2s; 
        }
        .checked .circle-check { 
            background: var(--accent); 
            border-color: var(--accent); 
        }
        .task-name { 
            font-size: 1rem; 
            font-weight: 600; 
            transition: 0.2s; 
            line-height: 1.3; 
        }
        .checked .task-name { 
            color: var(--muted); 
            text-decoration: line-through; 
        }
        .guide-text { 
            font-size: 0.8rem; 
            color: var(--blue); 
            margin-top: 5px; 
            display: none; 
            background: rgba(10, 132, 255, 0.1); 
            padding: 8px; 
            border-radius: 6px;
        }
        .task-item.show-guide .guide-text { 
            display: block; 
            animation: fadeIn 0.3s; 
        }
        .alt-text {
            font-size: 0.75rem;
            color:#aaa;
            margin-top:4px;
            padding-left:66px;
        }
        .yt-btn { 
            background: #222; 
            color: var(--text); 
            padding: 8px 12px; 
            border-radius: 6px; 
            text-decoration: none; 
            font-size: 0.7rem; 
            font-weight: bold; 
            border: 1px solid #333; 
            display: flex; 
            align-items: center; 
            gap: 5px; 
            flex-shrink: 0; 
            cursor: pointer; 
            position: relative; 
            z-index: 20; 
        }
        
        /* INPUTS */
        .input-row { 
            display: flex; 
            gap: 8px; 
            margin-top: 12px; 
            padding-left: 66px; 
            align-items: center; 
            flex-wrap: wrap; 
            position: relative; 
            z-index: 20; 
        }
        .mini-input { 
            background: #000; 
            border: 1px solid #333; 
            color: #fff; 
            width: 65px; 
            padding: 10px; 
            border-radius: 8px; 
            text-align: center; 
            font-size: 0.9rem; 
            font-weight: 600; 
            -webkit-appearance: none; 
        }
        .tool-btn { 
            background: #222; 
            border: 1px solid #333; 
            color: var(--muted); 
            width: 34px; 
            height: 34px; 
            border-radius: 8px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            cursor: pointer; 
        }
        .pr-active { 
            border-color: var(--gold) !important; 
            color: var(--gold) !important; 
            box-shadow: 0 0 10px rgba(255, 214, 10, 0.3); 
        }
        .rpe-container { 
            width: 100%; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            margin-top: 8px; 
            padding-left: 66px; 
            opacity: 0.6; 
            transition: 0.3s; 
            position: relative; 
            z-index: 20; 
        }
        .rpe-container:hover, .rpe-container.active { 
            opacity: 1; 
        }
        .rpe-slider { 
            -webkit-appearance: none; 
            width: 100%; 
            height: 4px; 
            border-radius: 5px; 
            background: #333; 
            outline: none; 
        }
        .rpe-slider::-webkit-slider-thumb { 
            -webkit-appearance: none; 
            appearance: none; 
            width: 15px; 
            height: 15px; 
            border-radius: 50%; 
            background: var(--blue); 
            cursor: pointer; 
        }

        /* TOGGLES */
        .toggle-row { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            background: #000; 
            padding: 15px; 
            border-radius: 12px; 
            border: 1px solid #333; 
            margin-bottom: 15px; 
        }
        .switch { 
            position: relative; 
            display: inline-block; 
            width: 50px; 
            height: 28px; 
        }
        .switch input { 
            opacity: 0; 
            width: 0; 
            height: 0; 
        }
        .slider { 
            position: absolute; 
            cursor: pointer; 
            top: 0; 
            left: 0; 
            right: 0; 
            bottom: 0; 
            background-color: #333; 
            transition: .4s; 
            border-radius: 34px; 
        }
        .slider:before { 
            position: absolute; 
            content: ""; 
            height: 20px; 
            width: 20px; 
            left: 4px; 
            bottom: 4px; 
            background-color: white; 
            transition: .4s; 
            border-radius: 50%; 
        }
        input:checked + .slider { 
            background-color: var(--blue); 
        }
        input:checked + .slider:before { 
            transform: translateX(22px); 
        }

        /* MODALS */
        .modal { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.85); 
            z-index: 300; 
            align-items: flex-end; 
            backdrop-filter: blur(5px); 
        }
        .modal.open { 
            display: flex; 
        }
        .sheet { 
            background: #1c1c1e; 
            width: 100%; 
            border-radius: 24px 24px 0 0; 
            padding: 30px 25px; 
            max-height: 90vh; 
            overflow-y: auto; 
            animation: slideUp 0.3s; 
            border-top: 1px solid #333; 
            position: relative; 
            z-index: 301; 
        }
        .full-modal { 
            align-items: center; 
            justify-content: center; 
        }
        .full-modal .sheet { 
            border-radius: 0; 
            width: 100%; 
            height: 100%; 
            max-height: 100%; 
            max-width: 100%; 
            padding-top: env(safe-area-inset-top); 
        }
        .close-sticky { 
            position: fixed; 
            top: 20px; 
            right: 20px; 
            z-index: 999; 
            background: rgba(0,0,0,0.5); 
            width: 40px; 
            height: 40px; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 1.5rem; 
            color: #fff; 
            backdrop-filter: blur(10px); 
            border: 1px solid #444; 
            cursor: pointer; 
        }

        /* UTILS & NUTRITION */
        .tab-btn { 
            font-size: 1.7rem; 
            opacity: 0.5; 
            transition: 0.2s; 
            cursor: pointer; 
        } 
        .tab-btn.active { 
            opacity: 1; 
            transform: scale(1.1); 
            color: var(--accent); 
        }
        .timer-float { 
            position: fixed; 
            bottom: 90px; 
            left: 50%; 
            transform: translateX(-50%) translateY(150px); 
            background: #1c1c1e; 
            border: 1px solid var(--accent); 
            padding: 12px 24px; 
            border-radius: 40px; 
            display: flex; 
            align-items: center; 
            gap: 15px; 
            z-index: 250; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.8); 
            transition: 0.4s; 
        }
        .timer-float.active { 
            transform: translateX(-50%) translateY(0); 
        }
        .grid-3 { 
            display: grid; 
            grid-template-columns: 1fr 1fr 1fr; 
            gap: 10px; 
            margin-bottom: 15px; 
        }
        .track-box { 
            background: #111; 
            padding: 15px; 
            border-radius: 14px; 
            text-align: center; 
            cursor: pointer; 
            border: 1px solid #333; 
        }
        .track-val { 
            font-size: 1.2rem; 
            font-weight: 800; 
            color: #fff; 
        }
        .nutri-container { 
            padding-top: 20px; 
            padding-bottom: 80px; 
        }
        .nutri-tabs { 
            display: flex; 
            background: #111; 
            padding: 4px; 
            border-radius: 12px; 
            margin: 15px 0; 
            border: 1px solid #333; 
        }
        .n-tab { 
            flex: 1; 
            text-align: center; 
            padding: 12px; 
            border-radius: 10px; 
            font-size: 0.9rem; 
            color: #777; 
            transition: 0.2s; 
            font-weight: bold; 
            cursor: pointer; 
        }
        .n-tab.active { 
            background: #222; 
            color: #fff; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.2); 
        }
        .macro-bar-container { 
            margin-bottom: 20px; 
            background: #111; 
            padding: 15px; 
            border-radius: 12px; 
            border: 1px solid #333; 
        }
        .macro-label { 
            display: flex; 
            justify-content: space-between; 
            font-size: 0.9rem; 
            margin-bottom: 8px; 
            color: #ccc; 
            font-weight: bold; 
        }
        .progress-track { 
            width: 100%; 
            height: 10px; 
            background: #222; 
            border-radius: 5px; 
            overflow: hidden; 
        }
        .progress-fill { 
            height: 100%; 
            border-radius: 5px; 
            transition: width 0.5s; 
        }
        .food-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 10px; 
            padding-bottom: 20px; 
        }
        .food-item { 
            background: #1a1a1a; 
            padding: 15px; 
            border-radius: 12px; 
            border: 1px solid #333; 
            display: flex; 
            flex-direction: column; 
            gap: 5px; 
            font-size: 0.9rem; 
            cursor: pointer; 
            transition: 0.2s; 
            position: relative; 
            overflow: hidden; 
        }
        .food-item:active { 
            transform: scale(0.98); 
            background: #222; 
        }
        .food-tags {
            font-size:0.7rem;
            color:#888;
        }
        .supp-grid { 
            display: grid; 
            grid-template-columns: repeat(4, 1fr); 
            gap:10px; 
            margin-bottom: 15px; 
        }
        .supp-icon { 
            background: #222; 
            border: 1px solid #333; 
            aspect-ratio: 1; 
            border-radius: 12px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            flex-direction: column; 
            font-size: 0.7rem; 
            cursor: pointer; 
            opacity: 0.5; 
            transition: 0.3s; 
        }
        .supp-icon.active { 
            opacity: 1; 
            border-color: var(--blue); 
            background: rgba(10, 132, 255, 0.1); 
            box-shadow: 0 0 10px rgba(10, 132, 255, 0.3); 
        }
        .timing-item {
            font-size:0.8rem;
        }
        .timing-item.timing-active {
            color:var(--gold);
            font-weight:bold;
        }
        .plate-visual { 
            display: flex; 
            gap: 2px; 
            justify-content: center; 
            align-items: flex-end; 
            height: 60px; 
            margin-top: 15px; 
        }
        .plate { 
            height: 100%; 
            border-radius: 4px; 
            border: 1px solid rgba(255,255,255,0.2); 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 0.7rem; 
            color: #000; 
            font-weight: bold; 
        }

        /* ANATOMY & BUTTONS */
        .anatomy-container { 
            position: relative; 
            width: 150px; 
            height: 260px; 
            margin: 20px auto; 
        }
        .anatomy-svg { 
            width: 100%; 
            height: 100%; 
            overflow: visible; 
        }
        .muscle-path { 
            fill: #333; 
            stroke: #222; 
            stroke-width: 1; 
            transition: fill 0.5s; 
        }
        .pain-grid { 
            display: flex; 
            gap: 10px; 
            flex-wrap: wrap; 
            justify-content: center; 
            margin-top: 10px; 
        }
        .pain-part { 
            padding: 8px 16px; 
            background: #222; 
            border: 1px solid #333; 
            border-radius: 20px; 
            font-size: 0.8rem; 
            cursor: pointer; 
        }
        .pain-part.active { 
            background: var(--danger); 
            color: #fff; 
            border-color: var(--danger); 
        }
        .action-btn { 
            width: 100%; 
            margin-top: 10px; 
            padding: 14px; 
            background: #222; 
            border: 1px solid #333; 
            color: var(--text); 
            border-radius: 12px; 
            font-weight: 600; 
            font-size: 0.9rem; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 8px; 
            transition: 0.2s; 
            position: relative; 
            z-index: 10; 
        }
        .action-btn:active { 
            background: #333; 
        }
        .btn-jump { 
            border-color: var(--purple); 
            color: var(--purple); 
            background: rgba(191, 90, 242, 0.1); 
        }
        .spin-btn { 
            width: 100%; 
            padding: 14px; 
            background: #222; 
            border: 1px solid #333; 
            color: #fff; 
            border-radius: 12px; 
            font-weight: bold; 
            cursor: pointer; 
            margin-top: 10px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 5px; 
        }

        @keyframes slideUp { 
            from { transform: translateY(100%); } 
            to { transform: translateY(0); } 
        }
        @keyframes fadeIn { 
            from { opacity:0; transform:translateY(-10px); } 
            to { opacity:1; transform:translateY(0); } 
        }
    </style>
</head>
<body>
    <canvas id="confetti"></canvas>

    <header>
        <div class="header-top">
            <div style="display:flex; flex-direction:column">
                <div class="app-title">PRIME v22.1 <span style="font-size:0.8rem; color:var(--accent)">Stable</span></div>
                <div style="font-size:0.6rem; letter-spacing:2px; color:var(--blue); font-weight:bold" id="seasonBadge">SEZON ƒ∞√áƒ∞</div>
            </div>
            <div style="display:flex; gap:15px; align-items: center;">
                <div class="challenge-badge" onclick="openModal('challengeModal')">üèÜ <span id="challengeShort">0/1000</span></div>
                <button class="icon-btn" onclick="openModal('zoneModal')">üßò</button>
                <button class="icon-btn" onclick="openModal('settingsModal')">‚öôÔ∏è</button>
            </div>
        </div>
        <div class="xp-container"><div class="xp-fill" id="xpBar"></div></div>
        <div class="level-badge"><span id="currentLvl">Lvl 1</span><span id="userRank">Rookie</span><span id="xpText">0 XP</span></div>
    </header>

    <div class="quote-box" id="dailyQuote" style="text-align:center; padding:15px; font-style:italic; color:#888; font-size:0.9rem;">...</div>

    <div class="date-strip" style="display:flex; justify-content:space-between; align-items:center; padding:0 16px; margin-bottom:15px; position:relative; z-index:10;">
        <div class="nav-arrow" onclick="changeDate(-1)" style="font-size:1.5rem; padding:10px; cursor:pointer;">‚ùÆ</div>
        <div style="font-weight:700; font-size:1.1rem;" id="dateDisplay">Bug√ºn</div>
        <div class="nav-arrow" onclick="changeDate(1)" style="font-size:1.5rem; padding:10px; cursor:pointer;">‚ùØ</div>
    </div>

    <div class="container">
        <div class="alert-box alert-deload" id="deloadAlert" style="display:none;"><span>‚ö†Ô∏è</span> <div><b>Yorgunluk Tespit Edildi!</b><br>Son 7 g√ºn hacmin √ßok y√ºksek. Y√ºk√º %50 azalt.</div></div>
        <div class="alert-box alert-low" id="lowEnergyAlert" style="display:none;"><span>üê¢</span> <div><b>HAFƒ∞F ANTRENMAN</b><br>Enerjin d√º≈ü√ºk. Bug√ºn kendini zorlama.</div></div>
        <div class="alert-box alert-high" id="highEnergyAlert" style="display:none;"><span>üöÄ</span> <div><b>REKOR G√úN√ú!</b><br>Enerjin tavan! Bug√ºn PR denemek i√ßin harika.</div></div>

        <div class="prehab-box" id="prehabSection">
            <div class="box-header" style="color:var(--blue)">üõ°Ô∏è Sakatlƒ±k √ñnleme & Isƒ±nma</div>
            <div id="prehabList"></div>
        </div>

        <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; border-bottom:1px solid #333; padding-bottom:10px;">
                <div>
                    <h2 style="margin:0; font-size:1.3rem" id="progTitle">...</h2>
                    <small style="color:var(--muted)" id="progSub">...</small>
                    <div id="readinessBadge" style="font-size:0.65rem; background:#222; display:inline-block; padding:2px 6px; border-radius:4px; margin-top:4px; color:#aaa">Enerji: ?</div>
                </div>
                <div style="text-align:right">
                    <div style="font-size:1.5rem; font-weight:900; color:var(--accent)" id="progPercent">%0</div>
                    <div style="font-size:0.7rem; color:#777; margin-top:4px">Y√úK: <span id="totalVolume" style="color:#fff; font-weight:bold">0 kg</span></div>
                </div>
            </div>
            
            <div id="workoutList"></div>
            
            <button class="action-btn btn-jump" onclick="addJumpToToday()">üöÄ + Anlƒ±k Zƒ±plama Ekle</button>
            
            <div class="finisher-box" style="margin-top:20px; position:relative; z-index:10;">
                <button class="spin-btn" onclick="spinFinisher()">üé≤ Cila (Finisher) √áevir</button>
                <div class="finisher-result" id="finisherResult" style="margin-top:10px; font-weight:bold; color:var(--purple); display:none; text-align:center;">...</div>
                <div style="margin-top:10px; font-size:0.7rem; color:#666; text-align:center;">
                    <label><input type="radio" name="fType" value="gym" checked> Salon</label>
                    <label style="margin-left:10px"><input type="radio" name="fType" value="basket"> Saha</label>
                </div>
            </div>
            <button class="action-btn" onclick="openModal('builderModal')" style="margin-top:15px; color:var(--blue)">üõ†Ô∏è Programƒ± Deƒüi≈ütir</button>
        </div>

        <div class="card tracker-section">
            <h3 style="margin:0 0 15px 0">üîã G√ºnl√ºk Takip</h3>
            <div class="grid-3">
                <div class="track-box" onclick="addWater()">
                    <div class="track-val" id="waterCount">0 lt</div>
                    <div style="font-size:0.7rem; color:#777; margin-top:5px">SU</div>
                </div>
                <div class="track-box" onclick="openModal('nutriModal')">
                    <div class="track-val" id="calStatus">0</div>
                    <div style="font-size:0.7rem; color:#777; margin-top:5px">KALORƒ∞</div>
                </div>
                <div class="track-box" id="proBox" style="border-color:#333" onclick="openModal('nutriModal')">
                    <div class="track-val" id="proStatus">0g</div>
                    <div style="font-size:0.7rem; color:#777; margin-top:5px">PROTEƒ∞N</div>
                </div>
            </div>
            <textarea id="journal" style="width:100%; background:#111; color:#fff; border:1px solid #333; border-radius:12px; padding:15px; min-height:80px;" placeholder="Notlar..." oninput="saveData()"></textarea>
        </div>
    </div>

    <div class="timer-float" id="timerFloat">
        <div style="font-size:0.7rem; color:var(--accent); font-weight:bold">REST</div>
        <div class="timer-val" id="timerDisplay">01:30</div>
        <button class="icon-btn" onclick="addTimer(10)" style="color:#fff; font-size:1.1rem">+10</button>
        <button class="icon-btn" onclick="stopTimer()" style="color:var(--danger); font-size:1.1rem">‚úï</button>
    </div>
    
    <div class="bottom-bar">
        <div class="tab-btn" onclick="togglePanic()">üè†</div>
        <div class="tab-btn" onclick="openModal('nutriModal')">üçé</div>
        <div class="tab-btn active" onclick="window.scrollTo(0,0)">üí™</div>
        <div class="tab-btn" onclick="openModal('statsModal')">üìä</div>
    </div>

    <div class="modal full-modal" id="clutchModal">
        <div class="sheet clutch-modal" style="text-align:center;">
            <div style="font-size:3rem; margin-bottom:10px">üî•</div>
            <h2 class="clutch-title">CLUTCH TIME!</h2>
            <p style="color:#ccc; margin-top:10px">Ma√ßƒ±n son topu elinde.</p>
            <div class="clutch-task" id="clutchTaskDisplay">...</div>
            <div style="color:var(--gold); font-size:0.9rem; margin-bottom:20px">√ñd√ºl: 2x XP</div>
            <button onclick="completeClutch()" class="spin-btn" style="width:100%; justify-content:center; background:var(--danger); margin-bottom:10px">YAPTIM (+XP)</button>
            <button onclick="closeModal('clutchModal'); showWrapUp()" style="background:none; border:none; color:#777; text-decoration:underline">Pas Ge√ß</button>
        </div>
    </div>
    
    <div class="modal full-modal" id="zoneModal">
        <div class="sheet" style="text-align:center">
            <div style="display:flex; justify-content:space-between;">
                <h2>Zone Modu</h2>
                <span onclick="closeModal('zoneModal')" style="cursor:pointer;">‚úï</span>
            </div>
            <p style="color:#777; font-size:0.9rem">Kutu Nefes: 4 Al - 4 Tut - 4 Ver - 4 Tut</p>
            <div class="breathing-circle" id="breathCircle" style="width:150px; height:150px; border:4px solid #333; border-radius:50%; margin:30px auto; display:flex; align-items:center; justify-content:center; font-size:1.5rem; font-weight:bold; color:var(--blue); transition:all 4s ease-in-out;">BA≈ûLA</div>
            <div class="breathing-text" id="breathText">Odaklan...</div>
            <button onclick="startBreathing()" class="spin-btn" style="margin-top:30px; width:100%; justify-content:center">Ba≈ülat</button>
        </div>
    </div>
    
    <div class="modal full-modal" id="wrapUpModal">
        <div class="sheet" style="text-align:center; border-color:var(--gold)">
            <div style="font-size:3rem; margin-bottom:10px">üéâ</div>
            <h2 style="color:var(--gold); font-size:1.8rem; margin:0">ANTRENMAN TAMAMLANDI!</h2>
            <div class="wrap-stats" style="display:flex; justify-content:space-around; margin:20px 0;">
                <div class="wrap-box">
                    <div class="wrap-val" id="wrapVol" style="font-size:1.6rem; font-weight:bold;">0</div>
                    <div style="font-size:0.8rem; color:#777">Toplam Y√ºk (Kg)</div>
                </div>
                <div class="wrap-box">
                    <div class="wrap-val" id="wrapXP" style="font-size:1.6rem; font-weight:bold;">0</div>
                    <div style="font-size:0.8rem; color:#777">Kazanƒ±lan XP</div>
                </div>
            </div>
            <button onclick="closeModal('wrapUpModal')" class="spin-btn" style="width:100%; justify-content:center; background:#333; border:1px solid #555">Kapat</button>
        </div>
    </div>
    
    <div class="modal full-modal" id="nutriModal">
        <div class="sheet nutri-container">
            <div class="close-sticky" onclick="closeModal('nutriModal')">‚úï</div>
            <h2 style="padding:0 20px">Beslenme Merkezi</h2>
            <div style="padding:0 20px">
                <div class="nutri-tabs">
                    <div class="n-tab active" onclick="switchToolTab('track')">Takip</div>
                    <div class="n-tab" onclick="switchToolTab('wizard')">Sihirbaz</div>
                    <div class="n-tab" onclick="switchToolTab('1rm')">1RM & Hesap</div>
                </div>

                <div id="tool-track" class="tool-content active">
                    <div style="text-align:center;margin-bottom:15px">
                        HEDEF: <span id="targetCalDisplay" style="color:var(--gold);font-weight:bold">--</span> kcal / 
                        <span style="color:var(--accent);font-weight:bold">160g</span> Prot
                    </div>
                    <div class="macro-bar-container">
                        <div class="macro-label"><span>Kalori</span><span id="calText">0</span></div>
                        <div class="progress-track"><div class="progress-fill" id="calBar" style="width:0%;background:var(--gold)"></div></div>
                    </div>
                    <div class="macro-bar-container">
                        <div class="macro-label"><span>Protein</span><span id="proText">0</span></div>
                        <div class="progress-track"><div class="progress-fill" id="proBar" style="width:0%;background:var(--accent)"></div></div>
                    </div>
                    <div style="display:flex; gap:10px; margin-bottom:15px; background:#1a1a1a; padding:10px; border-radius:12px; border:1px solid #333;">
                        <input type="number" min="0" id="quickCal" class="mini-input" style="flex:1; width:auto;" placeholder="Kcal">
                        <input type="number" min="0" id="quickPro" class="mini-input" style="flex:1; width:auto;" placeholder="Prot (g)">
                        <button class="tool-btn" style="width:50px" onclick="addQuickMacros()">+</button>
                    </div>
                    <h4 style="margin-bottom:10px; color:#888;">Supplementler</h4>
                    <div class="supp-grid">
                        <div class="supp-icon" id="supp-creatine" onclick="toggleSupp('creatine')">üß™<br>Kreatin</div>
                        <div class="supp-icon" id="supp-omega" onclick="toggleSupp('omega')">üêü<br>Omega3</div>
                        <div class="supp-icon" id="supp-multi" onclick="toggleSupp('multi')">üíä<br>Vitamin</div>
                        <div class="supp-icon" id="supp-caffeine" onclick="toggleSupp('caffeine')">‚òï<br>Kafein</div>
                    </div>
                    <div class="timing-box" id="nutrientTimingBox" style="display:none; background:rgba(255,214,10,0.1); padding:10px; border-radius:10px; margin-bottom:15px;">
                        <div style="font-weight:bold; color:var(--gold); margin-bottom:5px">‚ö° MA√á G√úN√ú ZAMANLAMASI</div>
                        <div class="timing-item" onclick="toggleTiming('t1')" id="time-t1" style="padding:5px; cursor:pointer;">üî≤ Ma√ßtan 3-4 Saat √ñnce: Karbonhidrat</div>
                        <div class="timing-item" onclick="toggleTiming('t2')" id="time-t2" style="padding:5px; cursor:pointer;">üî≤ Ma√ßtan 1 Saat √ñnce: Hafif Atƒ±≈ütƒ±rmalƒ±k</div>
                        <div class="timing-item" onclick="toggleTiming('t3')" id="time-t3" style="padding:5px; cursor:pointer;">üî≤ Ma√ß Sonrasƒ± (30dk): Protein & Hƒ±zlƒ± Karbon</div>
                    </div>
                    <h4 style="margin-bottom:10px; color:#888;">Hƒ±zlƒ± Men√º</h4>
                    <div class="food-grid" id="foodGrid"></div>
                    <div id="foodLog" class="food-log-list" style="margin-top:15px; font-size:0.8rem; color:#777;"></div>
                    <button onclick="clearNutrition()" style="width:100%; margin-top:20px; padding:10px; background:none; border:1px solid #333; color:#666; border-radius:8px;">Listeyi Temizle</button>
                </div>

                <div id="tool-wizard" class="tool-content" style="display:none;">
                    <button class="spin-btn" style="width:100%; justify-content:center; margin-bottom:15px" onclick="generateMenu()">üé≤ Rastgele G√ºnl√ºk Men√º Olu≈ütur</button>
                    <div id="menuResult"></div>
                </div>
                
                <div id="tool-1rm" class="tool-content" style="display:none;">
                    <div style="display:flex;gap:10px">
                        <input type="number" min="0" id="rmWeight" class="mini-input" style="width:50%" placeholder="Kilo">
                        <input type="number" min="0" id="rmReps" class="mini-input" style="width:50%" placeholder="Tekrar">
                    </div>
                    <button onclick="calc1RM()" class="spin-btn" style="width:100%;margin-top:15px">1RM Hesapla</button>
                    <div id="rmResult" style="font-size:2rem;text-align:center;margin-top:20px;color:var(--blue)"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal full-modal" id="statsModal">
        <div class="sheet" style="padding-top:60px;">
            <div class="close-sticky" onclick="closeModal('statsModal')">‚úï</div>
            <h2>ƒ∞statistikler</h2>
            <div style="display:flex; gap:10px; margin-bottom:15px">
                <input type="number" min="0" id="userHeight" class="mini-input" style="width:50%; padding:15px" placeholder="Boy (cm)" onchange="saveStats()">
                <input type="number" min="0" id="dailyWeight" class="mini-input" style="width:50%; padding:15px" placeholder="Kilo (kg)" onchange="saveData()">
            </div>
            <div class="alert-box alert-imbalance" id="legAlert">
                <span>üêî</span> 
                <div><b>Chicken Leg Uyarƒ±sƒ±!</b><br>√úst v√ºcudun geli≈üti ama bacaklarƒ± ihmal ediyorsun.</div>
            </div>
            <h4 style="margin-top:20px; border-top:1px solid #333; padding-top:10px; text-align:center">Kas Yoƒüunluk Haritasƒ±</h4>
            <div class="anatomy-container">
                <svg class="anatomy-svg" viewBox="0 0 100 200">
                    <circle cx="50" cy="20" r="10" fill="#333" />
                    <path id="svg-shoulders" class="muscle-path" d="M30 35 L70 35 L75 45 L25 45 Z" />
                    <path id="svg-arms" class="muscle-path" d="M25 45 L15 80 L22 80 L30 45 Z M75 45 L85 80 L78 80 L70 45 Z" />
                    <path id="svg-chest" class="muscle-path" d="M35 45 L65 45 L60 65 L40 65 Z" />
                    <path id="svg-core" class="muscle-path" d="M40 65 L60 65 L58 90 L42 90 Z" />
                    <path id="svg-legs" class="muscle-path" d="M38 90 L62 90 L65 140 L55 140 L52 100 L48 100 L45 140 L35 140 Z" />
                </svg>
            </div>
            <h4 style="margin-top:20px; border-top:1px solid #333; padding-top:10px">Aƒürƒ± Haritasƒ±</h4>
            <div class="pain-grid" id="painMapGrid">
                <div class="pain-part" onclick="togglePain('diz')">Diz</div>
                <div class="pain-part" onclick="togglePain('bel')">Bel</div>
                <div class="pain-part" onclick="togglePain('omuz')">Omuz</div>
                <div class="pain-part" onclick="togglePain('bilek')">Bilek</div>
                <div class="pain-part" onclick="togglePain('kalca')">Kal√ßa</div>
            </div>
            <h4 style="margin-top:20px; border-top:1px solid #333; padding-top:10px">Son Ma√ßlar</h4>
            <div id="gameHistory"></div>
        </div>
    </div>

    <div class="modal" id="plateModal">
        <div class="sheet">
            <h2>Plaka Hesaplayƒ±cƒ±</h2>
            <input type="number" min="0" id="plateTarget" class="mini-input" style="width:100%; font-size:1.5rem; padding:15px; margin-bottom:10px;" placeholder="Hedef (kg)" oninput="calcPlates()">
            <div id="plateResult" style="color:var(--accent);font-weight:bold;margin-bottom:10px"></div>
            <div id="plateVisual" class="plate-visual"></div>
            <span onclick="closeModal('plateModal')" style="position:absolute;top:20px;right:20px;font-size:1.5rem; cursor:pointer;">‚úï</span>
        </div>
    </div>
    <div class="modal" id="historyModal">
        <div class="sheet">
            <h2 id="histTitle">Ge√ßmi≈ü</h2>
            <div id="histList" style="margin-top:15px;"></div>
            <span onclick="closeModal('historyModal')" style="position:absolute;top:20px;right:20px;font-size:1.5rem; cursor:pointer;">‚úï</span>
        </div>
    </div>
    <div class="modal" id="builderModal">
        <div class="sheet">
            <div style="display:flex; justify-content:space-between;">
                <h2>Program Yap</h2>
                <span onclick="closeModal('builderModal')" style="cursor:pointer;">‚úï</span>
            </div>
            <select id="mainMuscle" style="width:100%;padding:12px;background:#000;color:#fff;border:1px solid #333;border-radius:8px;margin-bottom:10px" onchange="updateSec()">
                <option value="">1. B√∂lge</option>
                <option value="chest">G√∂ƒü√ºs</option>
                <option value="back">Sƒ±rt</option>
                <option value="legs">Bacak</option>
                <option value="shoulders">Omuz</option>
                <option value="arms">Kol</option>
            </select>
            <select id="subMuscle" style="width:100%;padding:12px;background:#000;color:#fff;border:1px solid #333;border-radius:8px;margin-bottom:10px" disabled>
                <option>2. B√∂lge</option>
            </select>
            <div class="toggle-row">
                <span>üèÄ Sƒ±√ßrama Ekle (Booster)</span>
                <label class="switch">
                    <input type="checkbox" id="addJump">
                    <span class="slider"></span>
                </label>
            </div>
            <button onclick="buildProg()" style="width:100%;padding:15px;background:var(--blue);border:none;border-radius:8px;color:#fff;font-weight:bold">Uygula</button>
        </div>
    </div>
    <div class="modal" id="readinessModal">
        <div class="sheet">
            <div style="display:flex; justify-content:space-between;">
                <h2>G√ºnl√ºk Hazƒ±rlƒ±k</h2>
                <span onclick="closeModal('readinessModal')" style="cursor:pointer;">‚úï</span>
            </div>
            <p style="color:#aaa; margin-bottom:20px">Bug√ºn kendini nasƒ±l hissediyorsun?</p>
            <div class="readiness-scale" style="display:flex; justify-content:space-between; font-size:2rem;">
                <div class="r-btn" onclick="setReadiness(1)">üò´</div>
                <div class="r-btn" onclick="setReadiness(2)">ü•±</div>
                <div class="r-btn" onclick="setReadiness(3)">üòê</div>
                <div class="r-btn" onclick="setReadiness(4)">üôÇ</div>
                <div class="r-btn" onclick="setReadiness(5)">üî•</div>
            </div>
        </div>
    </div>
    <div class="modal" id="gameLogModal">
        <div class="sheet">
            <div style="display:flex; justify-content:space-between;">
                <h2>üèÄ Ma√ß Karnesi</h2>
                <span onclick="closeModal('gameLogModal')" style="cursor:pointer;">‚úï</span>
            </div>
            <div style="display:flex; gap:10px; margin:20px 0;">
                <input type="number" min="0" id="gamePoints" class="mini-input" style="width:50%; padding:15px" placeholder="Sayƒ±">
                <input type="number" min="0" id="gameAssists" class="mini-input" style="width:50%; padding:15px" placeholder="Asist">
            </div>
            <div style="display:flex; gap:10px; margin:10px 0;">
                <input type="number" min="0" id="gameRebounds" class="mini-input" style="width:50%; padding:15px" placeholder="Rib">
                <input type="number" min="0" id="gameSteals" class="mini-input" style="width:50%; padding:15px" placeholder="T√á">
            </div>
            <div style="display:flex; gap:10px; margin-bottom:10px;">
                <select id="gameResult" style="width:100%; padding:12px; background:#222; color:#fff; border:1px solid #333; border-radius:8px;">
                    <option value="">Ma√ß Sonucu</option>
                    <option value="W">Galibiyet (W)</option>
                    <option value="L">Maƒülubiyet (L)</option>
                </select>
            </div>
            <textarea id="gameNotes" style="width:100%; background:#000; border:1px solid #333; color:#fff; padding:10px; border-radius:8px" placeholder="Ma√ß yorumu..."></textarea>
            <button onclick="saveGameLog()" style="width:100%; padding:15px; background:var(--accent); border:none; border-radius:10px; margin-top:15px; font-weight:bold">Kaydet</button>
        </div>
    </div>
    <div class="modal" id="settingsModal">
        <div class="sheet" style="padding-top:60px;">
            <div class="close-sticky" onclick="closeModal('settingsModal')">‚úï</div>
            <h2>Ayarlar</h2>
            <div class="toggle-row">
                <span>üèÄ Sezon ƒ∞√ßi</span>
                <label class="switch">
                    <input type="checkbox" id="seasonToggle" onchange="toggleSeason()">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="toggle-row">
                <span>üîä Ses Efektleri</span>
                <label class="switch">
                    <input type="checkbox" id="soundToggle" onchange="toggleSound()">
                    <span class="slider"></span>
                </label>
            </div>

            <h3 style="margin-top:20px;">üé® Tema</h3>
            <div style="display:flex; gap:10px; margin-bottom:20px;">
                <button onclick="applyTheme('default')" class="backup-btn" style="flex:1; padding:10px; background:#222; color:#fff; border:1px solid #444; border-radius:8px;">Klasik</button>
                <button onclick="applyTheme('ice')" class="backup-btn" style="flex:1; padding:10px; background:#111827; color:#e5f4ff; border:1px solid #3b82f6; border-radius:8px;">Ice</button>
                <button onclick="applyTheme('heat')" class="backup-btn" style="flex:1; padding:10px; background:#1a0505; color:#ffe7d7; border:1px solid #f97316; border-radius:8px;">Heat</button>
            </div>

            <div style="display:flex; gap:10px; margin:20px 0">
                <button onclick="exportData()" class="backup-btn" style="width:100%; padding:10px; background:#222; color:var(--blue); border:1px solid var(--blue); border-radius:8px;">üì• ƒ∞ndir</button>
                <button onclick="document.getElementById('importFile').click()" class="backup-btn" style="width:100%; padding:10px; background:#222; color:var(--warn); border:1px solid var(--warn); border-radius:8px;">üì§ Y√ºkle</button>
                <input type="file" id="importFile" style="display:none" onchange="importData(this)">
            </div>
            <button onclick="resetApp()" style="width:100%; padding:15px; background:var(--danger); border:none; border-radius:10px; color:#fff; font-weight:bold">Sƒ±fƒ±rla</button>
        </div>
    </div>
    <div class="modal" id="challengeModal">
        <div class="sheet">
            <div style="display:flex; justify-content:space-between;">
                <h2>Meydan Okuma</h2>
                <span onclick="closeModal('challengeModal')" style="cursor:pointer;">‚úï</span>
            </div>
            <div style="background:#111; padding:20px; border-radius:12px; text-align:center; margin-top:20px">
                <h3 style="margin:0; color:var(--warn)" id="challengeTitle">1000 ≈ûƒ±nav</h3>
                <div style="font-size:2rem; font-weight:bold; margin:10px 0" id="challengeDisplay">0 / 1000</div>
                <div class="progress-track"><div class="progress-fill" id="challengeBarFill" style="width:0%; background:var(--warn)"></div></div>
                <div style="margin-top:20px; display:flex; gap:10px; justify-content:center">
                    <button class="mini-input" onclick="addChallenge(10)">+10</button>
                    <button class="mini-input" onclick="addChallenge(25)">+25</button>
                    <button class="mini-input" onclick="addChallenge(50)">+50</button>
                </div>
                <button onclick="setChallenge()" style="margin-top:15px; background:none; border:none; color:#555; font-size:0.8rem; text-decoration:underline">Hedefi Deƒüi≈ütir</button>
            </div>
        </div>
    </div>
    
    <script>
        /* --- THEMES --- */
        const themes = {
            default: {
                '--bg': '#000000',
                '--card': '#161618',
                '--text': '#ffffff',
                '--muted': '#8e8e93',
                '--accent': '#32d74b',
                '--blue': '#0a84ff',
                '--danger': '#ff453a',
                '--warn': '#ff9f0a',
                '--purple': '#bf5af2',
                '--gold': '#ffd60a',
                '--glass': 'rgba(22,22,24,0.95)'
            },
            ice: {
                '--bg': '#020617',
                '--card': '#0b172a',
                '--text': '#e5f4ff',
                '--muted': '#94a3b8',
                '--accent': '#38bdf8',
                '--blue': '#0ea5e9',
                '--danger': '#fb7185',
                '--warn': '#facc15',
                '--purple': '#6366f1',
                '--gold': '#facc15',
                '--glass': 'rgba(15,23,42,0.9)'
            },
            heat: {
                '--bg': '#050000',
                '--card': '#1e0505',
                '--text': '#fff7ed',
                '--muted': '#f97316',
                '--accent': '#f97316',
                '--blue': '#fb923c',
                '--danger': '#ef4444',
                '--warn': '#facc15',
                '--purple': '#db2777',
                '--gold': '#facc15',
                '--glass': 'rgba(24,7,7,0.9)'
            }
        };

        function applyTheme(name) {
            const theme = themes[name] || themes.default;
            const root = document.documentElement;
            Object.keys(theme).forEach(key => {
                root.style.setProperty(key, theme[key]);
            });
            settings.theme = name;
            localStorage.setItem('primeSettingsV21', JSON.stringify(settings));
        }

        /* --- DATA & CONFIG --- */
        const visuals = { 
            push: `<svg viewBox="0 0 24 24"><path d="M4 18h16v-2H4v2zM8 6h8v2H8V6zm4 4c-1.1 0-2 .9-2 2v4h4v-4c0-1.1-.9-2-2-2z" fill="#fff"/></svg>`, 
            pull: `<svg viewBox="0 0 24 24"><path d="M12 2C9.24 2 7 4.24 7 7v4h2V7h10v4h2V7c0-2.76-2.24-5-5-5h-4zm-2 12v8h4v-8h-4z" fill="#fff"/></svg>`, 
            legs: `<svg viewBox="0 0 24 24"><path d="M12 4c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-2 16v-4h4v4h-4zm0-6h4v-2h-4v2zm-4 6h2v-6H6v6zm12 0h2v-6h-2v6z" fill="#fff"/></svg>`, 
            press: `<svg viewBox="0 0 24 24"><path d="M12 2L4 10h5v12h6V10h5L12 2z" fill="#fff"/></svg>`, 
            core: `<svg viewBox="0 0 24 24"><path d="M20 18h-2v-2h-2v2H8v-2H6v2H4v-6c0-1.1.9-2 2-2h12c1.1 0 2 .9 2 2v6z" fill="#fff"/></svg>`, 
            arm: `<svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 9h-2V7h-2v5H6v2h2v5h2v-5h2v-2z" fill="#fff"/></svg>`, 
            cardio: `<svg viewBox="0 0 24 24"><path d="M13.5 5.5c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zM9.8 8.9L7 23h2.1l1.8-8.4L13 19v4h2v-5l-1.8-3.6 1.8-1.4c.6-.5 1.1-.7 1.7-.7.3 0 .5.1.8.2L20 13v-2l-2.1-.6c-1.1-.4-2.4-.1-3.2.7l-1.5 1.5-1.4-4.1z" fill="#fff"/></svg>`, 
            pilates: `<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="8" fill="none" stroke="#fff" stroke-width="2"/><circle cx="12" cy="12" r="2" fill="#fff"/></svg>` 
        };

        const quotes = [
            "Yetenek seni zirveye ta≈üƒ±r, karakter orada tutar.",
            "Antrenman bittiƒüinde asƒ±l geli≈üim ba≈ülar.",
            "Bug√ºn yaptƒ±ƒüƒ±n her tekrar yarƒ±nki zaferin tuƒülasƒ±dƒ±r.",
            "Yorgunluk sadece zihnindedir."
        ];

        /* Egzersiz veri tabanƒ± + alternatif hareketler */
        const muscleDB = { 
            chest:{
                t:"G√∂ƒü√ºs", mb:"chest", 
                i:[
                    {
                        n:"Bench Press (4x8)",
                        v:"push",
                        d:"Barƒ± kontroll√º indir, dirsekler √ßok a√ßƒ±lmasƒ±n.",
                        alt:["Dumbbell Bench Press","Push-Up","Machine Chest Press"]
                    },
                    {
                        n:"Incline Bench Press (3x10)",
                        v:"push",
                        d:"√úst g√∂ƒüse odaklan, barƒ± √ßenen deƒüil g√∂ƒü√ºs √ºst√ºne indir.",
                        alt:["Incline Dumbbell Press","Machine Incline Press"]
                    }
                ]
            }, 
            back:{
                t:"Sƒ±rt", mb:"back", 
                i:[
                    {
                        n:"Pull Up",
                        v:"pull",
                        d:"√áeneni barƒ±n √ºzerine √ßƒ±kar, salƒ±nmadan √ßek.",
                        alt:["Lat Pulldown","Band Assisted Pull-Up"]
                    },
                    {
                        n:"Barbell Row",
                        v:"pull",
                        d:"Belini sabit tut, k√ºrek kemiklerini sƒ±kƒ±≈ütƒ±r.",
                        alt:["Dumbbell Row","Seated Cable Row"]
                    }
                ]
            }, 
            legs:{
                t:"Bacak", mb:"legs", 
                i:[
                    {
                        n:"Back Squat",
                        v:"legs",
                        d:"Topuklara bas, belini yuvarlama.",
                        alt:["Front Squat","Goblet Squat","Leg Press"]
                    },
                    {
                        n:"RDL (Romanian Deadlift)",
                        v:"legs",
                        d:"Kal√ßayƒ± geriye it, barƒ± v√ºcuda yakƒ±n tut.",
                        alt:["Hip Thrust","Good Morning","Leg Curl"]
                    }
                ]
            }, 
            shoulders:{
                t:"Omuz", mb:"shoulders", 
                i:[
                    {
                        n:"Overhead Press",
                        v:"press",
                        d:"Karnƒ± sƒ±k, barƒ± √ßenenin √∂n√ºnden d√ºz yukarƒ± it.",
                        alt:["Dumbbell Shoulder Press","Machine Shoulder Press","Landmine Press"]
                    }
                ]
            }, 
            arms:{
                t:"Kol", mb:"arms", 
                i:[
                    {
                        n:"Biceps Curl",
                        v:"arm",
                        d:"V√ºcudu sallamadan sadece dirsekten b√ºk.",
                        alt:["Incline DB Curl","Cable Curl"]
                    },
                    {
                        n:"Triceps Pushdown",
                        v:"arm",
                        d:"Dirsekleri sabit tut, tam a√ßƒ±lmaya odaklan.",
                        alt:["Overhead Rope Extension","Bench Dips"]
                    }
                ]
            }, 
            core:{
                t:"Karƒ±n", mb:"core", 
                i:[
                    {
                        n:"Plank",
                        v:"core",
                        d:"Kal√ßayƒ± d√º≈ü√ºrme, nefesini tutma.",
                        alt:["Side Plank","Dead Bug","Hollow Hold"]
                    }
                ]
            } 
        };

        const compat = { 
            chest:['arms','shoulders'], 
            back:['arms','shoulders'], 
            legs:['core'], 
            shoulders:['arms'], 
            arms:['core'] 
        };
        
        /* Sƒ±√ßrama paketleri */
        const jumpR = [
            {n:"Pogo Hops (3x20)", v:"legs", d:"Ayak bileklerini kilitle, hƒ±zlƒ± ve hafif sƒ±√ßra.", alt:["Line Hops","Jump Rope"]}, 
            {n:"Box Jump (3x8)", v:"legs", d:"Al√ßak bir kutuya patlayƒ±cƒ± ≈üekilde zƒ±pla.", alt:["Squat Jump","Broad Jump"]}, 
            {n:"Depth Jump (3x5)", v:"legs", d:"Y√ºksekten in, yere deƒüer deƒümez zƒ±pla (sinir sistemine ≈üok).", alt:["Countermovement Jump","Drop to Squat Jump"]}
        ];

        /* Finisher‚Äôlar: a√ßƒ±klama + YouTube arama sorgusu */
        const finishers = { 
            gym: [
                { n:"üî• 1 Dakika Plank", d:"Core dayanƒ±klƒ±lƒ±ƒüƒ± ve omurga stabilitesini zorlar.", q:"1 minute plank workout" }, 
                { n:"üî• 50 Mekik", d:"Abdominal b√∂lge i√ßin y√ºksek tekrarlƒ± yanma seti.", q:"crunches workout" }, 
                { n:"üî• Tabata Burpee (4dk)", d:"T√ºm v√ºcut, nabzƒ± tavana √ßƒ±karan HIIT protokol√º.", q:"tabata burpee 4 minutes" }, 
                { n:"üî• 100 ≈ûƒ±nav (Toplam)", d:"G√∂ƒü√ºs, triceps ve omuzlar i√ßin hacim y√ºklemesi.", q:"100 push up challenge" }, 
                { n:"üî• Farmer's Walk (Aƒüƒ±rlƒ±kla Y√ºr√º)", d:"Tutu≈ü, core ve genel ta≈üƒ±ma g√ºc√ºn√º geli≈ütirir.", q:"farmer walk exercise" },
                { n:"üî• Dead Hang (Barfikste Asƒ±lƒ± Kal - Max S√ºre)", d:"Tutu≈ü g√ºc√º, omuz ve skapula stabilitesine yardƒ±mcƒ± olur.", q:"dead hang grip exercise" }
            ], 
            basket: [
                { n:"üèÄ 5 Noktadan 10'ar ≈ûut", d:"Farklƒ± noktalardan ritim, form ve √∂zg√ºven √ßalƒ±≈ümasƒ±.", q:"basketball 5 spots shooting drill" }, 
                { n:"üèÄ 50 Serbest Atƒ±≈ü (Sokmadan √áƒ±kma)", d:"Serbest atƒ±≈ü ritmi ve ma√ß sonu g√ºveni i√ßin ideal.", q:"basketball free throw routine" }, 
                { n:"üèÄ Mikan Drill (2 Dakika)", d:"Fundamental bitiri≈ü ve pota √ßevresi hissiyatƒ±.", q:"basketball mikan drill" },
                { n:"üèÄ 3 Sayƒ± Yarƒ±≈ümasƒ± (Kendinle - 10'da ka√ß?)", d:"Perimetre ≈üut istikrarƒ± ve mental baskƒ± sim√ºlasyonu.", q:"basketball 3 point shooting drill" },
                { n:"üèÄ Sahayƒ± 5 Kere Tam Tur Ko≈ü", d:"Ma√ß kondisyonu ve sprint kapasitesi i√ßin basit ama acƒ±masƒ±z bir bitiri≈ü.", q:"basketball suicide runs conditioning" }
            ] 
        };
        
        const clutchTasks = [
            "1 Dakika Plank yapmadan eve gidemezsin!",
            "√úst √ºste 10 serbest atƒ±≈ü sok!",
            "50 ≈ûƒ±nav √ßek, hemen!",
            "Sahayƒ± 3 tam tur ko≈ü, bƒ±rakma!"
        ];
        
        /* Besin veri tabanƒ± - etiketli */
        const foodDB = [
            {n:"Yumurta (2 Adet)", c:140, p:12, type:["kahvaltƒ±","y√ºksek_protein","b√ºt√ße"]},
            {n:"Yulaf + S√ºt (60g)", c:250, p:10, type:["kahvaltƒ±","kompleks_karbon","lifli"]},
            {n:"Menemen (2 Yumurta)", c:220, p:14, type:["kahvaltƒ±","ana_√∂ƒü√ºn"]},
            {n:"Tam Buƒüday Peynirli Tost", c:280, p:14, type:["kahvaltƒ±","ofis_kolay","ma√ß_oncesi_guvenli"]},
            {n:"Tavuk G√∂ƒüs√º (150g)", c:165, p:31, type:["ana_√∂ƒü√ºn","y√ºksek_protein","ma√ß_sonrasƒ±"]},
            {n:"Izgara K√∂fte (150g)", c:350, p:25, type:["ana_√∂ƒü√ºn","y√ºksek_protein"]},
            {n:"Bulgur Pilavƒ± (1 Kase)", c:210, p:5, type:["ana_√∂ƒü√ºn","kompleks_karbon","lifli"]},
            {n:"Pirin√ß Pilavƒ± (1 Kase)", c:220, p:4, type:["ana_√∂ƒü√ºn","y√ºksek_karbon","ma√ß_oncesi_guvenli"]},
            {n:"Somon (150g)", c:280, p:26, type:["ana_√∂ƒü√ºn","y√ºksek_protein","saƒülƒ±klƒ±_yaƒü"]},
            {n:"Mercimek (1 Tabak)", c:230, p:18, type:["ana_√∂ƒü√ºn","lifli","bitkisel_protein"]},
            {n:"Yoƒüurt (1 Kase)", c:100, p:10, type:["ara_√∂ƒü√ºn","ma√ß_sonrasƒ±","ofis_kolay"]},
            {n:"Yoƒüurt + Yulaf + Meyve", c:260, p:12, type:["ara_√∂ƒü√ºn","fit_tatlƒ±","ofis_kolay"]},
            {n:"Muz (Orta)", c:105, p:1, type:["ara_√∂ƒü√ºn","ma√ß_oncesi_guvenli","ma√ß_sonrasƒ±"]},
            {n:"Elma", c:52, p:0, type:["ara_√∂ƒü√ºn","lifli"]},
            {n:"Badem/Ceviz (1 Avu√ß)", c:160, p:6, type:["ara_√∂ƒü√ºn","saƒülƒ±klƒ±_yaƒü","fit_tatlƒ±"]},
            {n:"Pirin√ß Patlaƒüƒ± (1 Adet)", c:30, p:1, type:["ara_√∂ƒü√ºn","ma√ß_oncesi_guvenli"]},
            {n:"Protein Shake", c:120, p:24, type:["ara_√∂ƒü√ºn","y√ºksek_protein","ma√ß_sonrasƒ±"]},
            {n:"Protein Bar", c:200, p:20, type:["ara_√∂ƒü√ºn","ofis_kolay","y√ºksek_protein"]},
            {n:"Ton Balƒ±ƒüƒ± (100g)", c:130, p:25, type:["ana_√∂ƒü√ºn","y√ºksek_protein","ofis_kolay"]},
            {n:"Lor Peyniri (100g)", c:90, p:15, type:["kahvaltƒ±","ara_√∂ƒü√ºn","y√ºksek_protein"]},
            {n:"Hindi F√ºme (2 Dilim)", c:60, p:10, type:["ara_√∂ƒü√ºn","sandvi√ß","y√ºksek_protein"]},
            {n:"Patates Ha≈ülama (Orta)", c:160, p:4, type:["ana_√∂ƒü√ºn","ma√ß_oncesi_guvenli","kompleks_karbon"]},
            {n:"Ayran + Galeta", c:150, p:7, type:["ara_√∂ƒü√ºn","ofis_kolay"]},
            {n:"Fit S√ºtla√ß (Light)", c:180, p:8, type:["fit_tatlƒ±","ak≈üam","ara_√∂ƒü√ºn"]},
            {n:"Kuru Fasulye (1 Tabak)", c:260, p:15, type:["ana_√∂ƒü√ºn","lifli","bitkisel_protein"]},
            {n:"Sebzeli Tavuk Sote", c:280, p:30, type:["ana_√∂ƒü√ºn","d√º≈ü√ºk_yaƒü"]},
            {n:"Karƒ±≈üƒ±k Meyve Tabaƒüƒ±", c:140, p:2, type:["ara_√∂ƒü√ºn","fit_tatlƒ±"]}
        ];

        /* Isƒ±nma / sakatlƒ±k √∂nleme DB */
        const warmupDB = { 
            "Y√ºr√ºy√º≈ü": {d:"Kan akƒ±≈üƒ±nƒ± ba≈ülat, zihni antrenmana hazƒ±rla.", alt:"5‚Äì10 dk hafif tempo y√ºr√ºy√º≈ü."}, 
            "Rotator Cuff": {d:"Lastikle dƒ±≈üa/i√ße rotasyon. Omuz saƒülƒ±ƒüƒ± i√ßin kritik.", alt:"Band external/internal rotation."}, 
            "Tibialis": {d:"Duvara yaslanƒ±p parmak ucu kaldƒ±rma. Diz ve √∂n bacak aƒürƒ±sƒ±nƒ± azaltmaya yardƒ±mcƒ± olur.", alt:"Tibialis raise, toe raises."}, 
            "Patellar Tendon": {d:"Diz kapaƒüƒ± altƒ± izometrik bekleme (Spanish Squat).", alt:"Spanish squat ile 30‚Äì45 sn bekleme."}, 
            "Kal√ßa Flexor": {d:"Lunge pozisyonunda arka bacaƒüƒ± sƒ±kƒ±p esnet. Kal√ßa √∂n√ºn√º a√ß.", alt:"Hip flexor stretch, couch stretch."}, 
            "Omuz Mob.": {d:"Sopayla omuz √ßevirme (dislocates). Overhead hareketler √∂ncesi ≈üart.", alt:"PVC shoulder dislocates."}, 
            "Kal√ßa Akt.": {d:"Monster Walk veya Glute Bridge ile kal√ßayƒ± uyandƒ±r.", alt:"Band lateral walk, glute bridge."}, 
            "Dinamik Isƒ±nma": {d:"High Knees, Butt Kicks, kol ve bacak savurma ile nabzƒ± y√ºkselt.", alt:"Dynamic warm up 5‚Äì10 dk."}, 
            "Jacks": {d:"Nabzƒ± 120 √ºzerine √ßƒ±karmak i√ßin seri Jumping Jack.", alt:"30‚Äì60 sn Jumping Jack."}
        };

        /* Takvim ‚Äì sakatlƒ±k √∂nleme listeleri geni≈ületildi */
        const seasonSchedule = { 
            0: {
                t:"Dinlenme", s:"Recovery", j:false, 
                pre:["Y√ºr√ºy√º≈ü","Dinamik Isƒ±nma"], 
                i:[{n:"Meal Prep / Esneme",v:"rest",d:"Haftayƒ± planla, hafif esneme yap."}]
            }, 
            1: {
                t:"Chest & Triceps", s:"ƒ∞tme G√ºn√º", j:false, 
                pre:["Rotator Cuff","Omuz Mob."], 
                i:[...muscleDB.chest.i, {n:"Triceps Pushdown",v:"arm",d:"Dirsekleri kilitle.", alt:["Dips","Overhead Rope Extension"]}]
            }, 
            2: {
                t:"Pilates & Basket", s:"Yoƒüun G√ºn", j:false, 
                pre:["Tibialis","Kal√ßa Akt."], 
                i:[
                    {n:"Pilates (19:00)",v:"pilates",d:"Core ve mobilite odaklƒ± √ßalƒ±≈ü.", alt:["Mat Pilates","Reformer Pilates"]},
                    {n:"Basketbol (20:45)",v:"cardio",d:"≈ûut, oyun kurma ve kondisyon.", alt:["≈ûut Drilleri","Ko≈üu Antrenmanƒ±"]}
                ]
            }, 
            3: {
                t:"Ma√ß G√ºn√º", s:"Game Night", j:true, 
                pre:["Patellar Tendon","Tibialis","Dinamik Isƒ±nma"], 
                i:[{n:"Ma√ß (21:45)",v:"cardio", isGame:true, d:"Ma√ß √∂ncesi odaƒüƒ±nƒ± topla, nefesini ayarla.", alt:["Ma√ß √ñn√º Isƒ±nma Rutinleri"]}]
            }, 
            4: {
                t:"Pilates", s:"Toparlanma", j:false, 
                pre:["Kal√ßa Flexor","Omuz Mob."], 
                i:[{n:"Pilates (19:00)",v:"pilates",d:"Esneklik ve core kontrol√º.", alt:["Mat Pilates","Yoga"]}]
            }, 
            5: {
                t:"Back & Biceps", s:"√áekme G√ºn√º", j:true, 
                pre:["Omuz Mob.","Kal√ßa Akt."], 
                i:[...muscleDB.back.i, {n:"Biceps Curl",v:"arm",d:"Negatif faza odaklan.", alt:["Hammer Curl","Cable Curl"]}]
            }, 
            6: {
                t:"Legs & Shoulders", s:"Kuvvet G√ºn√º", j:false, 
                pre:["Kal√ßa Akt.","Tibialis","Patellar Tendon"], 
                i:[...muscleDB.legs.i, ...muscleDB.shoulders.i]
            }, 
            panic: {
                t:"Ev Modu", s:"Home", j:false, 
                pre:["Jacks","Dinamik Isƒ±nma"], 
                i:[
                    {n:"50 ≈ûƒ±nav",v:"push",d:"Formu bozma, setlere b√∂l.", alt:["Knee Push-Up","Incline Push-Up"]},
                    {n:"50 Squat",v:"legs",d:"Topuk yere basƒ±lƒ± kalsƒ±n, derin in.", alt:["Lunge","Step-Up"]}
                ]
            } 
        };

        const offSeasonSchedule = JSON.parse(JSON.stringify(seasonSchedule)); 
        offSeasonSchedule[3] = {
            t:"CANAVAR MODU", s:"Off-Season", j:true, 
            pre:["Dinamik Isƒ±nma","Kal√ßa Akt.","Omuz Mob."], 
            i:[
                {n:"Deadlift",v:"legs",d:"Aƒüƒ±r ama kontroll√º gir.", alt:["Trap Bar Deadlift","Romanian Deadlift"]},
                {n:"Heavy Row",v:"pull",d:"Sƒ±rt kaslarƒ±nƒ± patlat, formu bozma.", alt:["One Arm DB Row","Machine Row"]},
                {n:"HIIT Ko≈üu",v:"cardio",d:"Kƒ±sa sprintler + aktif dinlenme.", alt:["Bisiklet HIIT","Rope Skipping HIIT"]}
            ]
        };
        
        // --- GLOBAL STATE ---
        let today = new Date();
        let data, stats, settings;
        let timerInt = null, timerSec = 0;

        //FIXED: DATE LOGIC
        const getK = d => d.toLocaleDateString('fr-CA'); // YYYY-MM-DD Local Time

        function save() { localStorage.setItem('primeDataV21', JSON.stringify(data)); }
        function saveStats() { 
            stats.height = document.getElementById('userHeight').value; 
            localStorage.setItem('primeStatsV21', JSON.stringify(stats)); 
        }

        function applySeasonBadge() {
            document.getElementById('seasonBadge').innerText = settings.inSeason ? "SEZON ƒ∞√áƒ∞" : "OFF-SEASON";
        }

        // --- INITIALIZATION ---
        function init() {
            try {
                data = JSON.parse(localStorage.getItem('primeDataV21')) || {};
                stats = JSON.parse(localStorage.getItem('primeStatsV21')) || {
                    xp:0, 
                    height:0, 
                    challenge:{target:1000, current:0, title:"1000 ≈ûƒ±nav"}, 
                    streak:0, 
                    lastLogin:"", 
                    max:{}, 
                    games:[], 
                    heat:{}, 
                    history:{}, 
                    pain:[]
                };
                settings = JSON.parse(localStorage.getItem('primeSettingsV21')) || {
                    sound:false, 
                    inSeason:true,
                    theme:'default'
                };
                if(!settings.theme) settings.theme = 'default';
                applyTheme(settings.theme);

                const k = getK(today);
                if(!data[k]) data[k] = {
                    c:[],
                    s:{},
                    w:{},
                    rpe:{},
                    n:"",
                    wt:0,
                    bw:0,
                    nutri:{cal:0, pro:0, log:[], supps:[], timing:[]},
                    panic:false,
                    readiness:0
                };
                if(!stats.heat) stats.heat = {chest:0,back:0,legs:0,shoulders:0,arms:0,core:0};
                
                document.getElementById('dailyQuote').innerHTML = `"${quotes[today.getDate() % quotes.length]}"`;
                if(data[k].readiness === 0) openModal('readinessModal');
                document.getElementById('seasonToggle').checked = settings.inSeason;
                document.getElementById('soundToggle').checked = settings.sound;
                document.getElementById('userHeight').value = stats.height || "";
                
                updateChallengeUI(); 
                renderFoodList(); 
                render(); 
                renderXP(); 
                renderHeatmap(); 
                renderGameHistory(); 
                renderPainMap();
                applySeasonBadge();

            } catch (e) { 
                alert("Veri hatasƒ± algƒ±landƒ±. Uygulama sƒ±fƒ±rlanƒ±yor..."); 
                localStorage.clear(); 
                location.reload(); 
            }
        }

        function render() {
            const k = getK(today); 
            document.getElementById('dateDisplay').innerText = today.toLocaleDateString('tr-TR', {weekday:'long', day:'numeric'});
            const dd = data[k]; 
            const basePlan = settings.inSeason ? seasonSchedule[today.getDay()] : offSeasonSchedule[today.getDay()];
            const p = dd.panic ? seasonSchedule.panic : (dd.custom || basePlan);
            
            document.getElementById('progTitle').innerText = p.t; 
            document.getElementById('progSub').innerText = p.s;
            applySeasonBadge();
            document.getElementById('readinessBadge').innerText = "Enerji: " + (["?", "üò´", "ü•±", "üòê", "üôÇ", "üî•"][dd.readiness] || "?");
            
            const phList = document.getElementById('prehabList'); 
            phList.innerHTML = "";
            if(p.pre) p.pre.forEach(item => { 
                const meta = warmupDB[item] || {d: "Hazƒ±rlƒ±k."}; 
                const altText = meta.alt ? `<span class="prehab-alt">${meta.alt}</span>` : "";
                phList.innerHTML += `
                <div class="prehab-item">
                    <div>
                        <div style="font-weight:600">${item}</div>
                        <span class="prehab-desc">${meta.d}</span>
                        ${altText}
                    </div>
                    <a href="https://www.youtube.com/results?search_query=${encodeURIComponent(item + " exercise")}" target="_blank" class="yt-btn">‚ñ∂</a>
                </div>`; 
            });

            const list = document.getElementById('workoutList'); 
            list.innerHTML=''; 
            let vol=0;
            p.i.forEach((it,i) => {
                const chk = dd.c.includes(i); 
                const kg = parseInt(dd.w[i]||0); 
                if(chk) vol += kg * (parseInt(dd.s[i])||3);
                
                const name = it.n.split('(')[0].trim(); 
                const isPR = kg > (stats.max[name]||0) && kg > 0;
                const altBlock = it.alt ? `<div class="alt-text">Alternatif: ${it.alt.join(' / ')}</div>` : "";
                
                list.innerHTML += `
                <div class="task-item ${chk?'checked':''}" id="task-${i}">
                    <div class="task-top">
                        <div class="task-visual" onclick="toggleGuide(${i})">${visuals[it.v]||visuals.push}</div>
                        <div class="check-group" onclick="toggle(${i},'${it.isGame?'game':''}',${p.i.length})">
                            <div style="flex:1"><span class="task-name">${name}</span></div>
                            <div class="circle-check"></div>
                        </div>
                        <a href="https://www.youtube.com/results?search_query=${encodeURIComponent(name + " nasƒ±l yapƒ±lƒ±r")}" target="_blank" class="yt-btn">‚ñ∂</a>
                    </div>
                    <div class="guide-text">üí° ${it.d||"Kontroll√º."}</div>
                    ${altBlock}
                    ${it.v!=='rest' && it.v!=='pilates' && it.v!=='cardio' ? `
                    <div class="input-row">
                        <input class="mini-input" type="number" min="0" placeholder="Set" value="${dd.s[i]||''}" onchange="saveS(${i},this.value)">
                        <input class="mini-input ${isPR?'pr-active':''}" type="number" min="0" placeholder="Kg" value="${dd.w[i]||''}" onchange="saveW('${name}',${i},this.value,${dd.s[i]||3})">
                        <button class="tool-btn" onclick="openCalc(${kg||0})">üßÆ</button>
                        <button class="tool-btn" onclick="openHist('${name}')">üìú</button>
                    </div>` : ''}
                </div>`;
            });
            
            document.getElementById('totalVolume').innerText = vol + " kg"; 
            const percent = p.i.length ? Math.round((dd.c.length/p.i.length)*100) : 0;
            document.getElementById('progPercent').innerText = "%" + (percent || 0); 
            updateTrackers(dd);
        }

        function toggle(i,s,t){ 
            const k=getK(today); 
            const a=data[k].c; 
            if(a.includes(i)) {
                a.splice(a.indexOf(i),1); 
                addXP(-10); // XP farm √∂nlemi
            } else { 
                a.push(i); 
                startTimer(); 
                addXP(10); 
                updateHeatmap(i); 
                if(s==='game') openModal('gameLogModal'); 
                if(a.length===t) checkClutch(); 
            } 
            save(); 
            render(); 
        }

        function checkClutch(){ 
            if(Math.random()<0.3) { 
                document.getElementById('clutchTaskDisplay').innerText = clutchTasks[Math.floor(Math.random()*clutchTasks.length)]; 
                openModal('clutchModal'); 
            } else {
                showWrapUp(); 
            }
        }

        function completeClutch(){ 
            addXP(100); 
            closeModal('clutchModal'); 
            showWrapUp(); 
        }

        function showWrapUp(){ 
            const k=getK(today); 
            const dt=data[k]; 
            let vol=0; 
            Object.values(dt.w).forEach(v=>vol+=parseInt(v||0)); 
            document.getElementById('wrapVol').innerText=vol; 
            document.getElementById('wrapXP').innerText="+"+(dt.c.length*10); 
            openModal('wrapUpModal'); 
            fireConfetti(); 
        }

        function addJumpToToday(){ 
            const k=getK(today); 
            const idx=today.getDay(); 
            let cur=data[k].custom ? data[k].custom : (settings.inSeason ? seasonSchedule[idx] : offSeasonSchedule[idx]); 
            
            // Aynƒ± Jump paketini iki kere eklemeyi engelle
            if(cur.i.find(x => x.n === jumpR[0].n)) { 
                alert("Zƒ±plama √ßalƒ±≈ümasƒ± zaten eklendi!"); 
                return; 
            }

            data[k].custom = {
                t: cur.t+" + Jump",
                s: cur.s,
                j: true,
                pre: cur.pre,
                i: [...cur.i, ...jumpR]
            }; 
            save(); 
            render(); 
            alert("Zƒ±plama Eklendi!"); 
        }

        function saveW(n,i,v,s){ 
            const k=getK(today); 
            data[k].w[i]=v; 
            if(v>(stats.max[n]||0)){
                stats.max[n]=v; 
                alert("REKOR! üèÜ");
            } 
            stats.history[n]={w:v,s:s,d:k}; 
            save(); 
            render(); 
        }

        function saveS(i,v){ 
            data[getK(today)].s[i]=v; 
            save(); 
        }

        function addXP(x){ 
            stats.xp = Math.max(0, (stats.xp||0) + x); 
            saveStats(); 
            renderXP(); 
        }

        function renderXP(){ 
            const xp = stats.xp || 0;
            document.getElementById('xpBar').style.width = (xp%1000)/10+"%"; 
            document.getElementById('xpText').innerText = xp+" XP"; 
            document.getElementById('currentLvl').innerText = "Lvl "+Math.floor(xp/1000+1); 
        }

        function updateTrackers(dd){ 
            document.getElementById('waterCount').innerText = (dd.wt||0)+" lt"; 
            document.getElementById('journal').value = dd.n||""; 
            document.getElementById('dailyWeight').value = dd.bw||""; 
            
            const cal = dd.nutri?.cal||0; 
            const pro = dd.nutri?.pro||0; 
            document.getElementById('calStatus').innerText = cal+" kcal"; 
            document.getElementById('proStatus').innerText = pro+"g"; 
            
            const tCal=2500; 
            const tPro=160; 
            document.getElementById('targetCalDisplay').innerText = tCal; 
            document.getElementById('calText').innerText = `${cal} / ${tCal}`; 
            document.getElementById('proText').innerText = `${pro} / ${tPro}g`; 
            document.getElementById('calBar').style.width = Math.min((cal/tCal)*100,100)+"%"; 
            document.getElementById('proBar').style.width = Math.min((pro/tPro)*100,100)+"%"; 
            
            const l=document.getElementById('foodLog'); 
            l.innerHTML=""; 
            if(dd.nutri?.log) dd.nutri.log.forEach(f=>l.innerHTML+=`<div>‚Ä¢ ${f.n} (${f.c}kcal, ${f.p}g)</div>`); 
            
            if(seasonSchedule[today.getDay()].j) 
                document.getElementById('nutrientTimingBox').style.display='block'; 
            else 
                document.getElementById('nutrientTimingBox').style.display='none'; 
            
            document.querySelectorAll('.supp-icon').forEach(el=>el.classList.remove('active')); 
            if(dd.nutri?.supps) dd.nutri.supps.forEach(s => document.getElementById('supp-'+s)?.classList.add('active'));
            
            document.querySelectorAll('.timing-item').forEach(el=>el.classList.remove('timing-active')); 
            if(dd.nutri?.timing) dd.nutri.timing.forEach(t => document.getElementById('time-'+t)?.classList.add('timing-active'));
        }

        function renderFoodList(){ 
            const g=document.getElementById('foodGrid'); 
            g.innerHTML=""; 
            foodDB.forEach((f,i)=>{
                const tags = f.type ? `<div class="food-tags">${f.type.join(", ")}</div>` : "";
                g.innerHTML+=`
                    <div class="food-item" onclick="addFood(${i})">
                        <b>${f.n}</b>
                        <small>${f.c} kcal / ${f.p} g</small>
                        ${tags}
                    </div>`;
            }); 
        }

        function addFood(i){ 
            const f=foodDB[i]; 
            const k=getK(today); 
            if(!data[k].nutri) data[k].nutri={cal:0,pro:0,log:[],supps:[],timing:[]}; 
            data[k].nutri.cal+=f.c; 
            data[k].nutri.pro+=f.p; 
            if(!data[k].nutri.log) data[k].nutri.log=[]; 
            data[k].nutri.log.push(f); 
            save(); 
            render(); 
        }

        function addQuickMacros(){ 
            const c=parseInt(document.getElementById('quickCal').value)||0; 
            const p=parseInt(document.getElementById('quickPro').value)||0; 
            if(c>0||p>0){ 
                const k=getK(today); 
                if(!data[k].nutri) data[k].nutri={cal:0,pro:0,log:[],supps:[],timing:[]}; 
                data[k].nutri.cal+=c; 
                data[k].nutri.pro+=p; 
                if(!data[k].nutri.log) data[k].nutri.log=[]; 
                data[k].nutri.log.push({n:"Hƒ±zlƒ± Ekleme",c:c,p:p}); 
                document.getElementById('quickCal').value=""; 
                document.getElementById('quickPro').value=""; 
                save(); 
                render(); 
            } 
        }

        function clearNutrition(){ 
            if(confirm("Beslenme kaydƒ± silinsin mi?")){ 
                const k=getK(today); 
                const prevSupp = (data[k].nutri && data[k].nutri.supps) || [];
                const prevTiming = (data[k].nutri && data[k].nutri.timing) || [];
                data[k].nutri={cal:0,pro:0,log:[],supps:prevSupp,timing:prevTiming}; 
                save(); 
                render(); 
            } 
        }

        function renderHeatmap(){ 
            const c={low:'#333',med:'#ffd60a',high:'#ff453a'}; 
            const setFill=(id,val)=>{
                const el=document.getElementById(id);
                if(!el)return;
                if(val>20)el.style.fill=c.high;
                else if(val>5)el.style.fill=c.med;
                else el.style.fill=c.low;
            }; 
            setFill('svg-chest',stats.heat.chest||0); 
            setFill('svg-shoulders',stats.heat.shoulders||0); 
            setFill('svg-arms',stats.heat.arms||0); 
            setFill('svg-legs',stats.heat.legs||0); 
            setFill('svg-core',stats.heat.core||0); 
        }

        function updateHeatmap(i){ 
            const k=getK(today); 
            const dd=data[k]; 
            const basePlan = settings.inSeason ? seasonSchedule[today.getDay()] : offSeasonSchedule[today.getDay()];
            const p=dd.custom||basePlan; 
            const ex = p.i[i];
            const mbKey = ex.mb || ex.mainBody || "core";
            if(!stats.heat[mbKey]) stats.heat[mbKey]=0;
            stats.heat[mbKey]+=1; 
            saveStats(); 
            renderHeatmap(); 
        }

        function renderGameHistory(){ 
            const d=document.getElementById('gameHistory'); 
            d.innerHTML=""; 
            stats.games.slice(-5).reverse().forEach(g=>{
                const res = g.result ? (g.result==="W" ? "W" : "L") : "";
                const line1 = `${g.date} ${res ? " - " + res : ""}`;
                const pts = g.pts ?? 0;
                const ast = g.ast ?? 0;
                const reb = g.reb ?? 0;
                const stl = g.stl ?? 0;
                d.innerHTML+=`
                    <div style="background:#111; padding:10px; border-radius:8px; margin-bottom:5px; border:1px solid #333; font-size:0.8rem;">
                        <div style="font-weight:bold;">${line1}</div>
                        <div>${pts} Sayƒ± / ${ast} Asist / ${reb} Rib / ${stl} T√á</div>
                    </div>`;
            }); 
        }

        function openModal(id){document.getElementById(id).classList.add('open');} 
        function closeModal(id){document.getElementById(id).classList.remove('open');}
        
        function switchToolTab(t){ 
            document.querySelectorAll('.tool-content').forEach(e=>e.style.display='none'); 
            document.getElementById('tool-'+t).style.display='block'; 
            document.querySelectorAll('.n-tab').forEach(e=>e.classList.remove('active')); 
            event.target.classList.add('active'); 
        }

        function toggleGuide(i){ document.getElementById(`task-${i}`).classList.toggle('show-guide'); }

        function startTimer(){ 
            const el=document.getElementById('timerFloat'); 
            el.classList.add('active'); 
            if(timerInt) clearInterval(timerInt); 
            timerSec=90; 
            updT(); 
            timerInt=setInterval(()=>{ 
                timerSec--; 
                updT(); 
                if(timerSec<=0){ stopTimer(); notify(); } 
            },1000); 
        }

        function addTimer(secAdd){
            timerSec += secAdd;
            updT();
        }

        function stopTimer(){ 
            clearInterval(timerInt); 
            timerInt=null;
            document.getElementById('timerFloat').classList.remove('active'); 
        }
        function updT(){ 
            const m=Math.floor(timerSec/60), s=timerSec%60; 
            document.getElementById('timerDisplay').innerText=`0${m}:${s<10?'0'+s:s}`; 
        }
        
        function notify(){ 
            if(settings.sound && 'speechSynthesis' in window){ 
                const u=new SpeechSynthesisUtterance("S√ºre doldu!"); 
                u.lang='tr-TR'; 
                window.speechSynthesis.speak(u); 
            } else if (navigator.vibrate) {
                navigator.vibrate([200,100,200]); 
            }
        }

        function addWater(){ 
            const k=getK(today);
            if(!data[k]) return;
            data[k].wt=(data[k].wt||0)+0.5; 
            save(); 
            render(); 
        }

        function saveData(){
            const k = getK(today);
            if(!data[k]) return;
            data[k].n = document.getElementById('journal').value;
            data[k].bw = document.getElementById('dailyWeight').value;
            save();
        }

        function setReadiness(v){ 
            data[getK(today)].readiness=v; 
            save(); 
            closeModal('readinessModal'); 
            render(); 
        }

        function togglePanic(){ 
            const k=getK(today);
            data[k].panic=!data[k].panic; 
            save(); 
            render(); 
        }

        function changeDate(d){ 
            today.setDate(today.getDate()+d); 
            init(); 
        }
        
        function toggleSupp(s){ 
            const k=getK(today); 
            if(!data[k].nutri)data[k].nutri={cal:0,pro:0,log:[],supps:[],timing:[]}; 
            if(!data[k].nutri.supps)data[k].nutri.supps=[]; 
            if(data[k].nutri.supps.includes(s)) 
                data[k].nutri.supps=data[k].nutri.supps.filter(x=>x!==s); 
            else 
                data[k].nutri.supps.push(s); 
            save(); 
            render(); 
        }
        
        function toggleTiming(t){ 
            const k=getK(today); 
            if(!data[k].nutri)data[k].nutri={cal:0,pro:0,log:[],supps:[],timing:[]}; 
            if(!data[k].nutri.timing)data[k].nutri.timing=[]; 
            if(data[k].nutri.timing.includes(t)) 
                data[k].nutri.timing=data[k].nutri.timing.filter(x=>x!==t); 
            else 
                data[k].nutri.timing.push(t); 
            save(); 
            render(); 
        }

        function calc1RM(){ 
            const w=parseFloat(document.getElementById('rmWeight').value); 
            const r=parseFloat(document.getElementById('rmReps').value); 
            if(w&&r) 
                document.getElementById('rmResult').innerText=Math.round(w*(1+r/30))+" kg"; 
        }

        function openCalc(kg){ 
            document.getElementById('plateTarget').value=kg; 
            calcPlates(); 
            openModal('plateModal'); 
        }

        function calcPlates(){ 
            const t=parseFloat(document.getElementById('plateTarget').value); 
            const vis=document.getElementById('plateVisual'); 
            vis.innerHTML=''; 
            if(!t||t<=20)return; 
            let w=(t-20)/2; 
            [25,20,15,10,5,2.5,1.25].forEach(p=>{
                while(w>=p){
                    w-=p; 
                    vis.innerHTML+=`<div class="plate" style="width:${28+p}px; background:${p>=25?'#ff3b30':(p>=20?'#0a84ff':(p>=10?'#32d74b':'#ffd60a'))}">${p}</div>`;
                }
            }); 
        }

        function openHist(n){ 
            const h=stats.history[n];
            const max = stats.max[n] || 0; 
            document.getElementById('histTitle').innerText=n+" Ge√ßmi≈üi"; 
            document.getElementById('histList').innerHTML = 
                (max > 0 ? `<div style="color:var(--gold); font-weight:bold; margin-bottom:10px;">üèÜ PR: ${max} kg</div>` : "") +
                (h ? `<div>Son: ${h.w}kg x ${h.s} (${h.d})</div>` : "Hen√ºz veri yok."); 
            openModal('historyModal'); 
        }

        /* Men√º sihirbazƒ±: kahvaltƒ± / √∂ƒüle / ak≈üam / ara √∂ƒü√ºn */
        function generateMenu(){ 
            const r = a => a[Math.floor(Math.random()*a.length)];
            const bf = foodDB.filter(f=>f.type && f.type.includes("kahvaltƒ±"));
            const main = foodDB.filter(f=>f.type && f.type.includes("ana_√∂ƒü√ºn"));
            const snack = foodDB.filter(f=>f.type && f.type.includes("ara_√∂ƒü√ºn"));
            
            if(!bf.length || !main.length || !snack.length){
                document.getElementById('menuResult').innerHTML = "<div style='margin-top:15px;'>Yeterli veri yok.</div>";
                return;
            }

            const kahvalti = r(bf);
            const ogle = r(main);
            const aksam = r(main.filter(m=>m!==ogle) || main);
            const ara1 = r(snack);
            const ara2 = r(snack.filter(s=>s!==ara1) || snack);

            document.getElementById('menuResult').innerHTML=`
                <div style="background:#222; padding:15px; margin-top:15px; border-radius:12px;">
                    <b>Kahvaltƒ±:</b> ${kahvalti.n}<br>
                    <b>√ñƒüle:</b> ${ogle.n}<br>
                    <b>Ak≈üam:</b> ${aksam.n}<br>
                    <b>Ara √ñƒü√ºn 1:</b> ${ara1.n}<br>
                    <b>Ara √ñƒü√ºn 2:</b> ${ara2.n}
                </div>`; 
        }

        function togglePain(p){ 
            if(!stats.pain) stats.pain = []; 
            if(stats.pain.includes(p)) 
                stats.pain = stats.pain.filter(x => x !== p); 
            else 
                stats.pain.push(p); 
            saveStats(); 
            renderPainMap(); 
        }

        function renderPainMap(){ 
            document.querySelectorAll('.pain-part').forEach(el => el.classList.remove('active')); 
            if(stats.pain) stats.pain.forEach(p => { 
                const el = document.querySelector(`.pain-part[onclick="togglePain('${p}')"]`); 
                if(el) el.classList.add('active'); 
            }); 
        }

        function toggleSeason(){ 
            settings.inSeason = document.getElementById('seasonToggle').checked; 
            localStorage.setItem('primeSettingsV21', JSON.stringify(settings)); 
            render(); 
        }

        function toggleSound(){ 
            settings.sound = document.getElementById('soundToggle').checked; 
            localStorage.setItem('primeSettingsV21', JSON.stringify(settings)); 
        }

        function resetApp(){ 
            if(confirm("T√ºm veriler sƒ±fƒ±rlansƒ±n mƒ±?")){ 
                localStorage.clear(); 
                location.reload(); 
            } 
        }

        function startBreathing(){ 
            const el = document.getElementById('breathCircle'); 
            const txt = document.getElementById('breathText'); 
            let phase = 0; 
            const labels = ["AL","TUT","VER","TUT"];
            const cycle = () => { 
                const label = labels[phase];
                el.innerText = label;
                if(phase===0){ 
                    el.style.transform="scale(1.5)"; 
                    txt.innerText="Nefesi burundan al.";
                } 
                else if(phase===1){ 
                    txt.innerText="Nefesi tut, sakin kal.";
                } 
                else if(phase===2){ 
                    el.style.transform="scale(1)"; 
                    txt.innerText="Kontroll√º ver.";
                } 
                else if(phase===3){ 
                    txt.innerText="Bo≈üta bekle, tekrar ba≈ülayacak.";
                } 
                phase = (phase+1)%4; 
            }; 
            cycle(); 
            setInterval(cycle, 4000); 
        }

        function saveGameLog(){ 
            const p=document.getElementById('gamePoints').value; 
            const a=document.getElementById('gameAssists').value; 
            const rbd=document.getElementById('gameRebounds').value; 
            const st=document.getElementById('gameSteals').value; 
            const res=document.getElementById('gameResult').value; 
            const note=document.getElementById('gameNotes').value;
            if(p || a || rbd || st || res || note){ 
                stats.games.push({
                    date:getK(today), 
                    pts:parseInt(p||0), 
                    ast:parseInt(a||0),
                    reb:parseInt(rbd||0),
                    stl:parseInt(st||0),
                    result:res||"",
                    note:note||""
                }); 
                saveStats(); 
                closeModal('gameLogModal'); 
                renderGameHistory(); 
            } 
        }

        function fireConfetti(){
            const c=document.getElementById('confetti');
            const x=c.getContext('2d');
            c.width=window.innerWidth;
            c.height=window.innerHeight;
            let p=[];
            for(let i=0;i<60;i++)p.push({
                x:Math.random()*c.width,
                y:-10,
                v:Math.random()*5+2,
                c:'hsl('+Math.random()*360+',100%,50%)'
            });
            function l(){
                x.clearRect(0,0,c.width,c.height);
                let a=false;
                p.forEach(o=>{
                    o.y+=o.v;
                    if(o.y<c.height){
                        a=true;
                        x.fillStyle=o.c;
                        x.fillRect(o.x,o.y,5,5)
                    }
                });
                if(a)requestAnimationFrame(l);
            }
            l();
        }

        function exportData() { 
            const d = {data: data, stats: stats, settings: settings}; 
            const b = new Blob([JSON.stringify(d)], {type: 'application/json'}); 
            const u = URL.createObjectURL(b); 
            const a = document.createElement('a'); 
            a.href = u; 
            a.download = 'prime_backup.json'; 
            a.click(); 
        }

        function importData(input) { 
            const f = input.files[0]; 
            const r = new FileReader(); 
            r.onload = (e) => { 
                const d = JSON.parse(e.target.result); 
                localStorage.setItem('primeDataV21', JSON.stringify(d.data)); 
                localStorage.setItem('primeStatsV21', JSON.stringify(d.stats)); 
                localStorage.setItem('primeSettingsV21', JSON.stringify(d.settings)); 
                location.reload(); 
            }; 
            r.readAsText(f); 
        }

        function updateChallengeUI(){
            const ch = stats.challenge || {target:1000, current:0};
            const perc = Math.min(100, (ch.current / ch.target) * 100);
            document.getElementById('challengeShort').innerText = `${ch.current}/${ch.target}`;
            document.getElementById('challengeDisplay').innerText = `${ch.current} / ${ch.target}`;
            document.getElementById('challengeBarFill').style.width = perc + "%";
            document.getElementById('challengeTitle').innerText = ch.title || "Meydan Okuma";
        }

        function addChallenge(v){
            if(!stats.challenge) stats.challenge = {target:1000,current:0,title:"1000 ≈ûƒ±nav"};
            stats.challenge.current += v;
            saveStats();
            updateChallengeUI();
        }

        function setChallenge(){
            const yeni = prompt("Yeni hedef (√∂r: 500 ≈üƒ±nav):","1000 ≈ûƒ±nav");
            if(!yeni) return;
            const sayi = parseInt(prompt("Hedef tekrar sayƒ±sƒ±:","1000") || "1000");
            stats.challenge = {title:yeni, target:sayi, current:0};
            saveStats();
            updateChallengeUI();
        }

        function spinFinisher(){ 
            const type = [...document.getElementsByName('fType')].find(r=>r.checked).value; 
            const arr = finishers[type]; 
            const pick = arr[Math.floor(Math.random()*arr.length)]; 
            const el=document.getElementById('finisherResult'); 
            const q = encodeURIComponent(pick.q || pick.n);
            el.innerHTML = `
                ${pick.n}
                <div style="margin-top:6px;font-size:0.8rem;color:#aaa;">${pick.d}</div>
                <a class="yt-btn" style="margin-top:8px;justify-content:center;" target="_blank" href="https://www.youtube.com/results?search_query=${q}">‚ñ∂ YouTube'da izle</a>
            `;
            el.style.display = 'block'; 
        }

        window.onload = init;
    </script>
</body>
</html>
