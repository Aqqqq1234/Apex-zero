<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <title>ATLAS v2 Ultimate</title>

    <style>
        /* --- ATLAS v2 DESIGN SYSTEM --- */
        :root {
            --bg: #050505; --card: #121212; --text: #e5e5e5; --muted: #737373;
            --accent: #ef4444; /* Aggressive Red */
            --blue: #3b82f6; /* Tech Blue */
            --gold: #eab308; /* Champion Gold */
            --green: #22c55e; /* Success */
            --glass: rgba(18, 18, 18, 0.95); --radius: 16px;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif; }
        body { margin: 0; background: var(--bg); color: var(--text); padding-top: env(safe-area-inset-top); padding-bottom: 110px; user-select: none; }

        /* HEADER */
        header { position: sticky; top: 0; z-index: 100; background: var(--glass); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(255,255,255,0.08); padding: 15px 20px; }
        .header-row { display: flex; justify-content: space-between; align-items: center; }
        .app-logo { font-size: 1.5rem; font-weight: 900; font-style: italic; letter-spacing: -1px; background: linear-gradient(to right, #fff, var(--muted)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        /* XP & LEVEL */
        .xp-container { margin-top: 8px; display: flex; align-items: center; gap: 10px; font-size: 0.75rem; color: var(--muted); font-weight: bold; }
        .xp-track { flex: 1; height: 6px; background: #262626; border-radius: 3px; overflow: hidden; }
        .xp-fill { height: 100%; background: var(--accent); width: 0%; transition: width 0.5s ease; }

        /* CONTAINER */
        .container { padding: 15px; max-width: 600px; margin: 0 auto; }
        .card { background: var(--card); border-radius: var(--radius); padding: 20px; margin-bottom: 15px; border: 1px solid #262626; position: relative; }
        .box-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; text-transform: uppercase; font-size: 0.8rem; font-weight: 800; letter-spacing: 0.5px; color: var(--muted); }

        /* SENTINEL ALERT */
        .sentinel-box { background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); display: none; }
        .sentinel-active { color: var(--accent); font-weight: bold; display: flex; align-items: center; gap: 8px; font-size: 0.9rem; }

        /* WORKOUT ITEMS */
        .task-item { padding: 12px 0; border-bottom: 1px solid #262626; }
        .task-top { display: flex; align-items: center; gap: 12px; }
        .visual { width: 42px; height: 42px; background: #1f1f1f; border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; border: 1px solid #333; color: #fff; }
        .info { flex: 1; }
        .name { font-weight: 700; font-size: 0.95rem; }
        .meta { font-size: 0.75rem; color: var(--muted); display: flex; gap: 8px; align-items: center; }
        .auto-badge { background: rgba(59, 130, 246, 0.2); color: var(--blue); padding: 1px 4px; border-radius: 4px; font-size: 0.6rem; }
        .check { width: 24px; height: 24px; border: 2px solid #404040; border-radius: 6px; transition: 0.2s; display: flex; align-items: center; justify-content: center; }
        
        .checked .name { text-decoration: line-through; color: #525252; }
        .checked .check { background: var(--green); border-color: var(--green); color: #000; }
        .checked .visual { border-color: var(--green); color: var(--green); }

        .input-row { display: flex; gap: 8px; margin-top: 10px; padding-left: 54px; align-items: center; }
        .mini-inp { background: #000; border: 1px solid #333; color: #fff; width: 65px; padding: 8px; border-radius: 8px; text-align: center; font-weight: bold; }
        .btn-icon { background: transparent; border: 1px solid transparent; color: var(--muted); padding: 5px; cursor: pointer; border-radius: 6px; }
        .btn-icon:hover { background: #262626; color: #fff; }

        /* CLUTCH MODE */
        .clutch-section { text-align: center; padding-top: 10px; border-top: 1px dashed #333; margin-top: 10px; }
        .clutch-btn { background: linear-gradient(135deg, #b91c1c, #ef4444); color: white; border: none; padding: 10px 20px; border-radius: 20px; font-weight: bold; font-size: 0.85rem; cursor: pointer; display: inline-flex; align-items: center; gap: 6px; box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4); }
        .clutch-result { margin-top: 10px; font-weight: bold; color: var(--gold); display: none; animation: popIn 0.3s; }

        /* SWITCH TOGGLE */
        .switch-container { display: flex; background: #000; border-radius: 20px; padding: 2px; border: 1px solid #333; }
        .switch-opt { padding: 6px 12px; font-size: 0.75rem; color: #777; border-radius: 18px; cursor: pointer; font-weight: 600; flex: 1; text-align: center; transition: 0.2s; }
        .switch-opt.active { background: #262626; color: #fff; }
        
        /* BOTTOM NAV */
        .nav { position: fixed; bottom: 0; width: 100%; background: var(--glass); border-top: 1px solid #262626; display: flex; justify-content: space-around; padding: 15px 0; padding-bottom: max(15px, env(safe-area-inset-bottom)); z-index: 200; }
        .nav-item { font-size: 1.5rem; opacity: 0.4; transition: 0.2s; } .nav-item.active { opacity: 1; color: var(--text); transform: scale(1.1); }

        /* MODALS */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 300; align-items: flex-end; backdrop-filter: blur(5px); }
        .modal.open { display: flex; }
        .sheet { background: #171717; width: 100%; border-radius: 24px 24px 0 0; padding: 25px; max-height: 90vh; overflow-y: auto; border-top: 1px solid #333; animation: slideUp 0.3s; }
        .sheet-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .close-x { font-size: 1.5rem; padding: 5px; cursor: pointer; color: var(--muted); }

        /* PAIN GRID (SENTINEL) */
        .pain-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 15px; }
        .pain-btn { background: #262626; padding: 15px; border-radius: 10px; text-align: center; border: 1px solid #333; color: #888; font-size: 0.85rem; cursor: pointer; transition: 0.2s; }
        .pain-btn.active { background: rgba(239, 68, 68, 0.2); border-color: var(--accent); color: var(--accent); }

        /* GAME LEDGER */
        .stat-inp-row { display: flex; gap: 10px; margin-bottom: 10px; }
        .stat-inp { background: #000; border: 1px solid #333; color: #fff; padding: 12px; border-radius: 8px; flex: 1; text-align: center; }

        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body>

    <header>
        <div class="header-row">
            <div class="app-logo">ATLAS <span style="font-size:0.8rem; color:var(--muted); font-style:normal">v2 Ultimate</span></div>
            <div class="switch-container">
                <div class="switch-opt active" id="modeGym" onclick="setMode('gym')">SALON</div>
                <div class="switch-opt" id="modeHome" onclick="setMode('home')">EV</div>
            </div>
        </div>
        <div class="xp-container">
            <span>LVL 5</span>
            <div class="xp-track"><div class="xp-fill" id="xpBar" style="width:72%"></div></div>
            <span id="xpVal">720 XP</span>
        </div>
    </header>

    <div class="container">
        
        <div class="card sentinel-box" id="sentinelBox">
            <div class="sentinel-active">
                <span style="font-size:1.2rem">üõ°Ô∏è</span>
                <div>
                    <div>SENTINEL AKTƒ∞F</div>
                    <div style="font-size:0.75rem; color:#fca5a5; font-weight:normal" id="painMsg">Bel aƒürƒ±sƒ± nedeniyle Squat iptal edildi.</div>
                </div>
            </div>
            <button onclick="openModal('sentinelModal')" style="position:absolute; right:15px; top:15px; background:none; border:none; color:var(--accent); font-weight:bold; font-size:0.8rem">Deƒüi≈ütir</button>
        </div>

        <div class="card" id="jumpCard" style="background:rgba(59, 130, 246, 0.05); border-color:rgba(59, 130, 246, 0.2)">
            <div class="box-header" style="color:var(--blue); margin-bottom:10px">
                <span>üöÄ Patlayƒ±cƒ± G√º√ß</span>
                <span onclick="openModal('jumpModal')" style="cursor:pointer; font-size:1.2rem">+</span>
            </div>
            <div id="jumpList"></div>
        </div>

        <div class="card">
            <div class="box-header">
                <span id="workoutTitle">Y√ºkleniyor...</span>
                <span id="totalVol" style="color:#e5e5e5">0 KG</span>
            </div>
            <div id="workoutList"></div>
            
            <div class="clutch-section">
                <button class="clutch-btn" onclick="rollClutch()">
                    <span>üé≤ CLUTCH MODE</span>
                </button>
                <div class="clutch-result" id="clutchDisplay"></div>
            </div>
        </div>

        <div class="card" id="gameCard" style="background:rgba(234, 179, 8, 0.05); border-color:rgba(234, 179, 8, 0.2); display:none">
            <div class="box-header" style="color:var(--gold)">
                <span>üèÄ Ma√ß G√ºn√º</span>
                <button onclick="openModal('gameLogModal')" style="background:#222; color:var(--gold); border:1px solid #333; border-radius:6px; padding:4px 10px; cursor:pointer">Karne Gir</button>
            </div>
            <div style="font-size:0.85rem; color:#aaa; text-align:center">Son Ma√ß: <span id="lastGameStat" style="color:#fff; font-weight:bold">--</span></div>
        </div>

        <div class="card">
            <div class="box-header">
                <span>üî• Makro</span>
                <span style="font-size:0.8rem; cursor:pointer; color:var(--muted)" onclick="openModal('nutriModal')">Detay ‚Ä∫</span>
            </div>
            <div style="display:flex; justify-content:space-between; align-items:flex-end">
                <div>
                    <div style="font-size:1.5rem; font-weight:bold" id="calDisp">0</div>
                    <div style="font-size:0.7rem; color:var(--muted)">kcal / 2800</div>
                </div>
                <div style="text-align:right">
                    <div style="font-size:1.5rem; font-weight:bold; color:var(--blue)" id="proDisp">0</div>
                    <div style="font-size:0.7rem; color:var(--muted)">g Protein / 170</div>
                </div>
            </div>
        </div>
    </div>

    <div class="nav">
        <div class="nav-item active" onclick="openModal('sentinelModal')">üõ°Ô∏è</div>
        <div class="nav-item" onclick="openModal('nutriModal')">üçé</div>
        <div class="nav-item" onclick="openModal('gameLogModal')">üìä</div>
    </div>

    <div class="modal" id="sentinelModal">
        <div class="sheet">
            <div class="sheet-head">
                <div style="font-size:1.2rem; font-weight:900; color:var(--accent)">üõ°Ô∏è Sentinel Protokol√º</div>
                <div class="close-x" onclick="closeModal('sentinelModal')">‚úï</div>
            </div>
            <p style="color:#888; font-size:0.9rem; margin-bottom:15px">Aƒürƒ± hissettiƒüin b√∂lgeyi se√ß. Atlas, programƒ± otomatik revize edip riskli hareketleri silecek.</p>
            <div class="pain-grid">
                <div class="pain-btn" id="pain-bel" onclick="togglePain('bel')">Bel</div>
                <div class="pain-btn" id="pain-diz" onclick="togglePain('diz')">Diz</div>
                <div class="pain-btn" id="pain-omuz" onclick="togglePain('omuz')">Omuz</div>
                <div class="pain-btn" id="pain-bilek" onclick="togglePain('bilek')">El Bileƒüi</div>
                <div class="pain-btn" id="pain-dirsek" onclick="togglePain('dirsek')">Dirsek</div>
            </div>
            <button onclick="closeModal('sentinelModal')" style="width:100%; padding:15px; margin-top:20px; background:#262626; color:#fff; border:none; border-radius:12px; font-weight:bold">Tamam</button>
        </div>
    </div>

    <div class="modal" id="infoModal">
        <div class="sheet">
            <div class="sheet-head">
                <div style="font-size:1.2rem; font-weight:900" id="infoTitle">Hareket</div>
                <div class="close-x" onclick="closeModal('infoModal')">‚úï</div>
            </div>
            <div id="infoDesc" style="color:#ccc; line-height:1.5; font-size:0.95rem">...</div>
            <div style="margin-top:15px; background:rgba(234, 179, 8, 0.1); padding:15px; border-radius:8px; border-left:3px solid var(--gold); color:#fef08a" id="infoCue">...</div>
            <a href="#" id="ytLink" target="_blank" style="display:block; text-align:center; margin-top:15px; background:#cc0000; color:white; padding:12px; border-radius:10px; text-decoration:none; font-weight:bold">YouTube'da ƒ∞zle</a>
        </div>
    </div>

    <div class="modal" id="gameLogModal">
        <div class="sheet">
            <div class="sheet-head">
                <div style="font-size:1.2rem; font-weight:900; color:var(--gold)">üèÄ Game Ledger</div>
                <div class="close-x" onclick="closeModal('gameLogModal')">‚úï</div>
            </div>
            <div class="stat-inp-row">
                <input type="number" id="gPts" class="stat-inp" placeholder="Sayƒ±">
                <input type="number" id="gAst" class="stat-inp" placeholder="Asist">
            </div>
            <div class="stat-inp-row">
                <select id="gWin" class="stat-inp"><option value="W">Galibiyet (W)</option><option value="L">Maƒülubiyet (L)</option></select>
                <input type="number" id="gEnergy" class="stat-inp" placeholder="Enerji (1-10)">
            </div>
            <button onclick="saveGame()" style="width:100%; padding:15px; background:var(--gold); color:#000; font-weight:bold; border:none; border-radius:12px">Kaydet</button>
            <div style="margin-top:20px; border-top:1px solid #333; padding-top:10px">
                <div class="box-header">Son Ma√ßlar</div>
                <div id="gameHistoryList" style="font-size:0.85rem; color:#888"></div>
            </div>
        </div>
    </div>

    <div class="modal" id="nutriModal">
        <div class="sheet" style="height:90vh">
            <div class="sheet-head">
                <div style="font-size:1.2rem; font-weight:900">Beslenme</div>
                <div class="close-x" onclick="closeModal('nutriModal')">‚úï</div>
            </div>
            <input type="text" placeholder="Yiyecek Ara..." oninput="searchFood(this.value)" style="width:100%; padding:12px; background:#000; border:1px solid #333; color:#fff; border-radius:10px; margin-bottom:10px">
            <div id="foodResults" style="display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-bottom:20px"></div>
            <div class="box-header">Bug√ºn Yenilenler</div>
            <div id="eatenList" style="color:#aaa; font-size:0.9rem"></div>
        </div>
    </div>
    
    <div class="modal" id="jumpModal">
        <div class="sheet">
            <div class="sheet-head"><h3>Manuel Zƒ±plama</h3><span class="close-x" onclick="closeModal('jumpModal')">‚úï</span></div>
            <div id="jumpSelectGrid" style="display:grid; gap:10px"></div>
        </div>
    </div>

    <script>
        // --- DATA & CONFIG ---
        const icons = {
            push: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 14h16v2H4zM4 10h16v2H4zM8 6h8v2H8z"/></svg>`,
            pull: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M8 6l4-4 4 4M8 18l4 4 4-4"/></svg>`,
            leg: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 22h16M12 2v10M8 12l4 10 4-10"/></svg>`,
            cardio: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h9v8l10-12h-9l9-8z"/></svg>`
        };

        // EXERCISE DATABASE (Includes Sentinel & Tactical Switch Logic)
        const exerciseDB = {
            "Bench Press": { d:"Sƒ±rtƒ± kilitle, ayaklardan g√º√ß al.", c:"Dirsek 45¬∞.", yt:"bench press", type:"push", home:"Push Ups (Weighted)", pain_omuz:"Floor Press", pain_bilek:"Machine Press" },
            "Incline DB Press": { d:"√úst g√∂ƒü√ºs odaklƒ±.", c:"Omuzlarƒ± kulaktan uzakla≈ütƒ±r.", yt:"incline dumbbell press", type:"push", home:"Decline Push Ups", pain_omuz:"Neutral Grip Press" },
            "Squat": { d:"Kal√ßayƒ± geriye it.", c:"Dizler i√ße √ß√∂kmesin.", yt:"squat form", type:"leg", home:"Goblet Squat / Lunges", pain_diz:"Glute Bridge", pain_bel:"Leg Press / Extension" },
            "Deadlift": { d:"Bar kaval kemiƒüine yapƒ±≈üƒ±k.", c:"Barƒ± b√ºkerek koltuk altƒ±nƒ± sƒ±k.", yt:"deadlift form", type:"leg", home:"Single Leg RDL", pain_bel:"Chest Supported Row" },
            "OH Press": { d:"Karnƒ± sƒ±k, barƒ± dik it.", c:"Geriye yatma.", yt:"overhead press", type:"push", home:"Pike Push Ups", pain_omuz:"Lateral Raise", pain_bel:"Seated DB Press" },
            "Pull Up": { d:"√áeneyi barƒ±n √ºst√ºne √ßek.", c:"G√∂ƒüs√º deƒüdirmeye √ßalƒ±≈ü.", yt:"pull up", type:"pull", home:"Door Pull Ins", pain_omuz:"Lat Pulldown", pain_bilek:"Straps Lat Pulldown" },
            "Cable Row": { d:"K√ºrek kemiklerini sƒ±kƒ±≈ütƒ±r.", c:"G√∂vde sabit.", yt:"cable row", type:"pull", home:"Band Rows", pain_bel:"Chest Supported Row" },
            "Lateral Raise": { d:"Dirsekler hafif b√ºk√ºl√º.", c:"Ser√ße parmak tavanƒ± g√∂rs√ºn.", yt:"lateral raise", type:"push", home:"Band Lateral Raise", pain_omuz:"Front Raise" },
            "Plank": { d:"V√ºcut d√ºz √ßizgi.", c:"Dirsekleri ayaklara √ßek.", yt:"plank", type:"core", home:"Plank", pain_bel:"Dead Bug" },
            "Bicep Curl": { d:"Sallanmadan kaldƒ±r.", c:"Dirsekler sabit.", yt:"bicep curl", type:"pull", home:"Band Curl", pain_bilek:"Hammer Curl" },
            "Tricep Pushdown": { d:"Dirsekleri kilitle.", c:"Sadece √∂n kol hareket etsin.", yt:"tricep pushdown", type:"push", home:"Diamond Push Ups", pain_dirsek:"Cable Kickback" },
            "≈ûut Antrenmanƒ±": { d:"Ma√ß temposu.", c:"Mekanik tekrarƒ±.", yt:"basketball shooting", type:"cardio", home:"Form Shooting (Yatarak)", pain_bilek:"Sol El Turnike" }
        };

        const schedule = [
            {t:"Active Recovery", i:[], pre:["Y√ºr√ºy√º≈ü"]}, // Paz
            {t:"Chest & Back", i:[{n:"Bench Press",s:4},{n:"Pull Up",s:4},{n:"Incline DB Press",s:3},{n:"Cable Row",s:3}], pre:["Rotator Cuff"]}, // Pzt
            {t:"Core & Arms", i:[{n:"Plank",s:3},{n:"Bicep Curl",s:3},{n:"Tricep Pushdown",s:3}], pre:[]}, // Salƒ±
            {t:"Legs & Shoulders", i:[{n:"Squat",s:4},{n:"OH Press",s:4},{n:"Lateral Raise",s:3}], pre:["Tibialis Raise"]}, // √áar≈ü
            {t:"Recovery / Mobility", i:[], pre:["Stretching"]}, // Per≈ü
            {t:"Full Body Power", i:[{n:"Deadlift",s:3},{n:"Dips",s:3},{n:"Chin Up",s:3}], pre:["Pogo Hops"]}, // Cum
            {t:"GAME DAY üèÄ", i:[{n:"≈ûut Antrenmanƒ±",s:1}], pre:["Box Jump"], isGame:true} // Cmt
        ];

        const foodDB = [
            {n:"Yumurta",c:70,p:6}, {n:"Tavuk G√∂ƒüs√º (150g)",c:240,p:45}, {n:"Pilav (1 Kase)",c:200,p:4},
            {n:"Yulaf (50g)",c:180,p:6}, {n:"Muz",c:105,p:1}, {n:"Lor Peyniri (100g)",c:100,p:18},
            {n:"K√∂fte (3 Adet)",c:250,p:18}, {n:"Mercimek √áorbasƒ±",c:150,p:8}, {n:"Protein Shake",c:120,p:24}
        ];

        const clutchTasks = [
            "1 Dakika Plank yapmadan √ßƒ±kamazsƒ±n!", "50 ≈ûƒ±nav. Hemen. ≈ûimdi.", "Duvara yaslanƒ±p (Wall Sit) 2 dakika bekle.", "Maksimum tekrar Barfiks denemesi!"
        ];

        let state = {
            date: new Date().toISOString().split('T')[0],
            mode: 'gym', // gym or home
            pain: [], // areas: 'bel', 'diz', etc.
            workouts: {}, // { 'date-idx': {w:80, done:true} }
            nutrition: {c:0, p:0, l:[]},
            jumps: [],
            games: [],
            xp: 0
        };

        // --- CORE FUNCTIONS ---
        function init() {
            const saved = JSON.parse(localStorage.getItem('atlas_v2_ult'));
            if(saved) {
                if(saved.date === state.date) state = saved;
                else { 
                    state.xp = saved.xp; 
                    state.games = saved.games; 
                    // New day reset details but keep stats
                }
            }
            
            // Auto-detect Match Day
            if(new Date().getDay() === 6) document.getElementById('gameCard').style.display = 'block';

            renderHeader();
            renderSentinel();
            renderWorkout();
            renderNutrition();
            updateGameHistory();
        }

        function renderHeader() {
            document.getElementById('xpBar').style.width = (state.xp % 1000) / 10 + '%';
            document.getElementById('xpVal').innerText = state.xp + " XP";
            
            document.getElementById('modeGym').className = state.mode === 'gym' ? 'switch-opt active' : 'switch-opt';
            document.getElementById('modeHome').className = state.mode === 'home' ? 'switch-opt active' : 'switch-opt';
        }

        function setMode(m) {
            state.mode = m;
            save(); renderHeader(); renderWorkout();
        }

        // --- SENTINEL LOGIC ---
        function togglePain(area) {
            const btn = document.getElementById('pain-'+area);
            if(state.pain.includes(area)) {
                state.pain = state.pain.filter(x => x !== area);
                btn.classList.remove('active');
            } else {
                state.pain.push(area);
                btn.classList.add('active');
            }
            save(); renderSentinel(); renderWorkout();
        }

        function renderSentinel() {
            const box = document.getElementById('sentinelBox');
            if(state.pain.length > 0) {
                box.style.display = 'block';
                document.getElementById('painMsg').innerText = `${state.pain.join(', ').toUpperCase()} aƒürƒ±sƒ± i√ßin program revize edildi.`;
                // Keep buttons active in modal
                state.pain.forEach(p => document.getElementById('pain-'+p)?.classList.add('active'));
            } else {
                box.style.display = 'none';
            }
        }

        // --- WORKOUT RENDER (The Brain) ---
        function renderWorkout() {
            const d = new Date().getDay();
            const s = schedule[d];
            const list = document.getElementById('workoutList');
            document.getElementById('workoutTitle').innerText = s.t;

            // Render Jumps
            const jumpList = document.getElementById('jumpList');
            const dailyJumps = [...(s.pre || []), ...state.jumps];
            jumpList.innerHTML = dailyJumps.map(j => `<div style="padding:10px; border-bottom:1px solid rgba(59,130,246,0.1); font-size:0.9rem" onclick="showInfo('${j}')">üöÄ ${j}</div>`).join('');

            list.innerHTML = '';
            let totalV = 0;

            if(s.i.length === 0) {
                list.innerHTML = "<div style='text-align:center; color:#555; padding:20px'>Dinlenme G√ºn√º.</div>";
                return;
            }

            s.i.forEach((ex, idx) => {
                let name = ex.n;
                let isSubbed = false;
                let isAuto = false;
                const db = exerciseDB[ex.n] || {type:'push'};
                
                // 1. Sentinel Check (Pain Substitution)
                state.pain.forEach(p => {
                    if(db['pain_'+p]) { name = db['pain_'+p]; isSubbed = true; }
                });

                // 2. Tactical Switch Check (Home Mode)
                if(state.mode === 'home' && db.home) {
                    name = db.home; isSubbed = true;
                }

                // 3. Auto-Pilot (Weight Suggestion logic would go here via history lookup)
                // Simplified for this view:
                const uid = `${state.date}-${idx}`;
                const val = state.workouts[uid]?.w || "";
                const done = state.workouts[uid]?.done;
                
                if(val) totalV += parseInt(val) * ex.s;

                let icon = icons[db.type] || icons.push;

                list.innerHTML += `
                <div class="task-item ${done?'checked':''}">
                    <div class="task-top">
                        <div class="visual" onclick="showInfo('${name}')">${icon}</div>
                        <div class="info" onclick="toggleTask(${idx})">
                            <div class="name">${name}</div>
                            <div class="meta">
                                <span>${ex.s} Set</span>
                                ${isSubbed ? '<span style="color:var(--accent)">‚Ä¢ Deƒüi≈üti</span>' : ''}
                                ${isAuto ? '<span class="auto-badge">Auto</span>' : ''}
                            </div>
                        </div>
                        <div class="check" onclick="toggleTask(${idx})">‚úì</div>
                    </div>
                    ${!name.includes('≈ûut') ? `
                    <div class="input-row">
                        <input type="number" class="mini-inp" placeholder="KG" value="${val}" onchange="saveW(${idx}, this.value)">
                        <button class="btn-icon" onclick="showInfo('${name}')">‚ÑπÔ∏è</button>
                    </div>` : ''}
                </div>`;
            });
            document.getElementById('totalVol').innerText = totalV + " KG";
        }

        function toggleTask(idx) {
            const uid = `${state.date}-${idx}`;
            if(!state.workouts[uid]) state.workouts[uid]={};
            state.workouts[uid].done = !state.workouts[uid].done;
            if(state.workouts[uid].done) state.xp += 10; else state.xp -= 10;
            save(); renderWorkout(); renderHeader();
        }

        function saveW(idx, val) {
            const uid = `${state.date}-${idx}`;
            if(!state.workouts[uid]) state.workouts[uid]={};
            state.workouts[uid].w = val;
            save(); renderWorkout();
        }

        // --- INFO & EXTRAS ---
        function showInfo(n) {
            // strip variations
            let clean = n.split('(')[0].trim();
            // Reverse lookup if subbed
            const db = exerciseDB[clean] || {d:"Standart egzersiz.", c:"Formuna dikkat et.", yt:clean};
            
            document.getElementById('infoTitle').innerText = clean;
            document.getElementById('infoDesc').innerText = db.d;
            document.getElementById('infoCue').innerText = "üí° " + db.c;
            document.getElementById('ytLink').href = `https://www.youtube.com/results?search_query=${encodeURIComponent(db.yt)}`;
            openModal('infoModal');
        }

        function rollClutch() {
            const task = clutchTasks[Math.floor(Math.random() * clutchTasks.length)];
            const d = document.getElementById('clutchDisplay');
            d.innerText = task;
            d.style.display = 'block';
            state.xp += 50; // Bonus
            save(); renderHeader();
        }

        // --- NUTRITION ---
        function searchFood(q) {
            const r = document.getElementById('foodResults');
            r.innerHTML = '';
            if(q.length<2) return;
            foodDB.filter(f=>f.n.toLowerCase().includes(q.toLowerCase())).forEach(f=>{
                r.innerHTML += `<div style="background:#222; padding:10px; border-radius:8px; font-size:0.85rem; cursor:pointer" onclick="addFood('${f.n}',${f.c},${f.p})"><b>${f.n}</b><br><span style="color:#777">${f.c}kcal / ${f.p}g</span></div>`;
            });
        }
        function addFood(n,c,p) {
            state.nutrition.c += c; state.nutrition.p += p; state.nutrition.l.push({n,c,p});
            save(); renderNutrition();
        }
        function renderNutrition() {
            document.getElementById('calDisp').innerText = state.nutrition.c;
            document.getElementById('proDisp').innerText = state.nutrition.p;
            document.getElementById('eatenList').innerHTML = state.nutrition.l.map(x=>`‚Ä¢ ${x.n}`).join('<br>') || "Hen√ºz veri yok.";
        }

        // --- GAME LEDGER ---
        function saveGame() {
            const g = {
                date: state.date,
                pts: document.getElementById('gPts').value,
                ast: document.getElementById('gAst').value,
                win: document.getElementById('gWin').value,
                nrg: document.getElementById('gEnergy').value
            };
            state.games.push(g);
            save(); closeModal('gameLogModal'); updateGameHistory();
        }
        function updateGameHistory() {
            const l = document.getElementById('gameHistoryList');
            l.innerHTML = state.games.slice(-3).reverse().map(g => `<div>${g.date}: ${g.pts} Sayƒ±, ${g.ast} Asist (${g.win}) - Enerji: ${g.nrg}/10</div>`).join('');
            if(state.games.length>0) {
                const last = state.games[state.games.length-1];
                document.getElementById('lastGameStat').innerText = `${last.pts} Sayƒ± / ${last.ast} Asist`;
            }
        }

        // --- UTILS ---
        function openModal(id) { document.getElementById(id).classList.add('open'); }
        function closeModal(id) { document.getElementById(id).classList.remove('open'); }
        function save() { localStorage.setItem('atlas_v2_ult', JSON.stringify(state)); }

        // --- JUMP MANUAL ---
        function addJump(n){ state.jumps.push(n); save(); renderWorkout(); closeModal('jumpModal'); }
        // Populate Jump Modal
        const jumpGrid = document.getElementById('jumpSelectGrid');
        ["Pogo Hops", "Box Jump", "Depth Jump", "Tuck Jump"].forEach(j => {
            jumpGrid.innerHTML += `<button onclick="addJump('${j}')" style="padding:15px; background:#222; border:1px solid #333; color:#fff; border-radius:10px">${j}</button>`;
        });

        init();
    </script>
</body>
</html>
